!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},r=Object.keys,i=Array.isArray,a={}.toString,o=Object.getPrototypeOf,s={}.hasOwnProperty,c=s.toString,A=["type","replaced","iterateIn","iterateUnsetNumeric"];function isThenable(e,t){return Typeson.isObject(e)&&"function"==typeof e.then&&(!t||"function"==typeof e.catch)}function toStringTag(e){return a.call(e).slice(8,-1)}function hasConstructorOf(t,n){if(!t||"object"!==(void 0===t?"undefined":e(t)))return!1;var r=o(t);if(!r)return!1;var i=s.call(r,"constructor")&&r.constructor;return"function"!=typeof i?null===n:"function"==typeof i&&null!==n&&c.call(i)===c.call(n)}function isPlainObject(e){return!(!e||"Object"!==toStringTag(e))&&(!o(e)||hasConstructorOf(e,Object))}function isObject(t){return t&&"object"===(void 0===t?"undefined":e(t))}function Typeson(a){var o=[],s=[],c={},u=this.types={},l=this.stringify=function(e,t,n,r){r=Object.assign({},a,r,{stringification:!0});var o=f(e,null,r);return i(o)?JSON.stringify(o[0],t,n):o.then(function(e){return JSON.stringify(e,t,n)})};this.stringifySync=function(e,t,n,r){return l(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!0}))},this.stringifyAsync=function(e,t,n,r){return l(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!1}))};var p=this.parse=function(e,t,n){return n=Object.assign({},a,n,{parse:!0}),g(JSON.parse(e,t),n)};this.parseSync=function(e,t,n){return p(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.parseAsync=function(e,t,n){return p(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))},this.specialTypeNames=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.returnTypeNames=!0,this.encapsulate(e,t,n)},this.rootTypeName=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.iterateNone=!0,this.encapsulate(e,t,n)};var f=this.encapsulate=function(u,l,p){var f=(p=Object.assign({sync:!0},a,p)).sync,g={},y=[],d=[],w=[],b=!(p&&"cyclic"in p)||p.cyclic,v=p.encapsulateObserver,h=_encapsulate("",u,b,l||{},w);function finish(e){var t=Object.values(g);if(p.iterateNone)return t.length?t[0]:Typeson.getJSONType(e);if(t.length){if(p.returnTypeNames)return[].concat(n(new Set(t)));e&&isPlainObject(e)&&!e.hasOwnProperty("$types")?e.$types=g:e={$:e,$types:{$:g}}}else isObject(e)&&e.hasOwnProperty("$types")&&(e={$:e,$types:!0});return!p.returnTypeNames&&e}return w.length?f&&p.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(function checkPromises(e,n){return Promise.all(n.map(function(e){return e[1].p})).then(function(r){return Promise.all(r.map(function(r){var i=[],a=n.splice(0,1)[0],o=t(a,7),s=o[0],c=o[2],A=o[3],u=o[4],l=o[5],p=o[6],f=_encapsulate(s,r,c,A,i,!0,p),g=hasConstructorOf(f,TypesonPromise);return s&&g?f.p.then(function(t){return u[l]=t,checkPromises(e,i)}):(s?u[l]=f:e=g?f.p:f,checkPromises(e,i))}))}).then(function(){return e})}(h,w)).then(finish):!f&&p.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():p.stringification&&f?[finish(h)]:f?finish(h):Promise.resolve(finish(h));function _adaptBuiltinStateObjectProperties(e,t,n){Object.assign(e,t);var r=A.map(function(t){var n=e[t];return delete e[t],n});n(),A.forEach(function(t,n){e[t]=r[n]})}function _encapsulate(t,n,a,s,c,A,u){var l=void 0,f={},w=void 0===n?"undefined":e(n),b=v?function(e){var r=u||s.type||Typeson.getJSONType(n);v(Object.assign(e||f,{keypath:t,value:n,cyclic:a,stateObj:s,promisesData:c,resolvingTypesonPromise:A,awaitingTypesonPromise:hasConstructorOf(n,TypesonPromise)},void 0!==r?{type:r}:{}))}:null;if(w in{string:1,boolean:1,number:1,undefined:1})return void 0===n||"number"===w&&(isNaN(n)||n===-1/0||n===1/0)?(l=replace(t,n,s,c,!1,A,b))!==n&&(f={replaced:l}):l=n,b&&b(),l;if(null===n)return b&&b(),n;if(a&&!s.iterateIn&&!s.iterateUnsetNumeric){var h=y.indexOf(n);if(!(h<0))return g[t]="#",b&&b({cyclicKeypath:d[h]}),"#"+d[h];!0===a&&(y.push(n),d.push(t))}var m=isPlainObject(n),I=i(n),C=(m||I)&&(!o.length||s.replaced)||s.iterateIn?n:replace(t,n,s,c,m||I,null,b),D=void 0;if(C!==n?(l=C,f={replaced:C}):I||"array"===s.iterateIn?(D=new Array(n.length),f={clone:D}):m||"object"===s.iterateIn?f={clone:D={}}:""===t&&hasConstructorOf(n,TypesonPromise)?(c.push([t,n,a,s,void 0,void 0,s.type]),l=n):l=n,b&&b(),p.iterateNone)return D||l;if(!D)return l;if(s.iterateIn){var x=function _loop(e){var r={ownKeys:n.hasOwnProperty(e)};_adaptBuiltinStateObjectProperties(s,r,function(){var r=t+(t?".":"")+escapeKeyPathComponent(e),i=_encapsulate(r,n[e],!!a,s,c,A);hasConstructorOf(i,TypesonPromise)?c.push([r,i,!!a,s,D,e,s.type]):void 0!==i&&(D[e]=i)})};for(var B in n)x(B);b&&b({endIterateIn:!0,end:!0})}else r(n).forEach(function(e){var r=t+(t?".":"")+escapeKeyPathComponent(e);_adaptBuiltinStateObjectProperties(s,{ownKeys:!0},function(){var t=_encapsulate(r,n[e],!!a,s,c,A);hasConstructorOf(t,TypesonPromise)?c.push([r,t,!!a,s,D,e,s.type]):void 0!==t&&(D[e]=t)})}),b&&b({endIterateOwn:!0,end:!0});if(s.iterateUnsetNumeric){for(var M=n.length,E=function _loop2(e){if(!(e in n)){var r=t+(t?".":"")+e;_adaptBuiltinStateObjectProperties(s,{ownKeys:!1},function(){var t=_encapsulate(r,void 0,!!a,s,c,A);hasConstructorOf(t,TypesonPromise)?c.push([r,t,!!a,s,D,e,s.type]):void 0!==t&&(D[e]=t)})}},O=0;O<M;O++)E(O);b&&b({endIterateUnsetNumeric:!0,end:!0})}return D}function replace(e,t,n,r,i,a,A){for(var u=i?o:s,l=u.length;l--;){var p=u[l];if(p.test(t,n)){var y=p.type;if(c[y]){var d=g[e];g[e]=d?[y].concat(d):y}return Object.assign(n,{type:y,replaced:!0}),!f&&p.replaceAsync||p.replace?(A&&A({replacing:!0}),_encapsulate(e,p[f||!p.replaceAsync?"replace":"replaceAsync"](t,n),b&&"readonly",n,r,a,y)):(A&&A({typeDetected:!0}),_encapsulate(e,t,b&&"readonly",n,r,a,y))}}return t}};this.encapsulateSync=function(e,t,n){return f(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.encapsulateAsync=function(e,t,n){return f(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))};var g=this.revive=function(e,n){var o=(n=Object.assign({sync:!0},a,n)).sync,s=e&&e.$types,A=!0;if(!s)return e;if(!0===s)return e.$;s.$&&isPlainObject(s.$)&&(e=e.$,s=s.$,A=!1);var u=[],l={},p=function _revive(e,n,a,o,p,f){if(A&&"$types"===e)return;var g=s[e];if(i(n)||isPlainObject(n)){var y=i(n)?new Array(n.length):{};for(r(n).forEach(function(t){var r=_revive(e+(e?".":"")+escapeKeyPathComponent(t),n[t],a||y,o,y,t);hasConstructorOf(r,Undefined)?y[t]=void 0:void 0!==r&&(y[t]=r)}),n=y;u.length;){var d=t(u[0],4),w=d[0],b=d[1],v=d[2],h=d[3],m=getByKeyPath(w,b);if(hasConstructorOf(m,Undefined))v[h]=void 0;else{if(void 0===m)break;v[h]=m}u.splice(0,1)}}if(!g)return n;if("#"===g){var I=getByKeyPath(a,n.substr(1));return void 0===I&&u.push([a,n.substr(1),p,f]),I}var C=o.sync;return[].concat(g).reduce(function(e,t){var n=c[t];if(!n)throw new Error("Unregistered type: "+t);return n[C&&n.revive?"revive":!C&&n.reviveAsync?"reviveAsync":"revive"](e,l)},n)}("",e,null,n);return isThenable(p=hasConstructorOf(p,Undefined)?void 0:p)?o&&n.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():p:!o&&n.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():o?p:Promise.resolve(p)};this.reviveSync=function(e,t){return g(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!0}))},this.reviveAsync=function(e,t){return g(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!1}))},this.register=function(e,t){return t=t||{},[].concat(e).forEach(function R(e){if(i(e))return e.map(R);e&&r(e).forEach(function(n){if("#"===n)throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(Typeson.JSON_TYPES.includes(n))throw new TypeError("Plain JSON object types are reserved as type names");var r=e[n],a=r.testPlainObjects?o:s,A=a.filter(function(e){return e.type===n});if(A.length&&(a.splice(a.indexOf(A[0]),1),delete c[n],delete u[n]),r){if("function"==typeof r){var l=r;r={test:function test(e){return e&&e.constructor===l},replace:function replace(e){return assign({},e)},revive:function revive(e){return assign(Object.create(l.prototype),e)}}}else i(r)&&(r={test:r[0],replace:r[1],revive:r[2]});var p={type:n,test:r.test.bind(r)};r.replace&&(p.replace=r.replace.bind(r)),r.replaceAsync&&(p.replaceAsync=r.replaceAsync.bind(r));var f="number"==typeof t.fallback?t.fallback:t.fallback?0:1/0;if(r.testPlainObjects?o.splice(f,0,p):s.splice(f,0,p),r.revive||r.reviveAsync){var g={};r.revive&&(g.revive=r.revive.bind(r)),r.reviveAsync&&(g.reviveAsync=r.reviveAsync.bind(r)),c[n]=g}u[n]=r}})}),this}}function assign(e,t){return r(t).map(function(n){e[n]=t[n]}),e}function escapeKeyPathComponent(e){return e.replace(/~/g,"~0").replace(/\./g,"~1")}function unescapeKeyPathComponent(e){return e.replace(/~1/g,".").replace(/~0/g,"~")}function getByKeyPath(e,t){if(""===t)return e;var n=t.indexOf(".");if(n>-1){var r=e[unescapeKeyPathComponent(t.substr(0,n))];return void 0===r?void 0:getByKeyPath(r,t.substr(n+1))}return e[unescapeKeyPathComponent(t)]}function Undefined(){}function TypesonPromise(e){this.p=new Promise(e)}TypesonPromise.prototype.then=function(e,t){var n=this;return new TypesonPromise(function(r,i){n.p.then(function(t){r(e?e(t):t)},function(e){n.p.catch(function(e){return t?t(e):Promise.reject(e)}).then(r,i)})})},TypesonPromise.prototype.catch=function(e){return this.then(null,e)},TypesonPromise.resolve=function(e){return new TypesonPromise(function(t){t(e)})},TypesonPromise.reject=function(e){return new TypesonPromise(function(t,n){n(e)})},["all","race"].map(function(e){TypesonPromise[e]=function(t){return new TypesonPromise(function(n,r){Promise[e](t.map(function(e){return e.p})).then(n,r)})}}),Typeson.Undefined=Undefined,Typeson.Promise=TypesonPromise,Typeson.isThenable=isThenable,Typeson.toStringTag=toStringTag,Typeson.hasConstructorOf=hasConstructorOf,Typeson.isObject=isObject,Typeson.isPlainObject=isPlainObject,Typeson.isUserObject=function isUserObject(e){if(!e||"Object"!==toStringTag(e))return!1;var t=o(e);return!t||hasConstructorOf(e,Object)||isUserObject(t)},Typeson.escapeKeyPathComponent=escapeKeyPathComponent,Typeson.unescapeKeyPathComponent=unescapeKeyPathComponent,Typeson.getByKeyPath=getByKeyPath,Typeson.getJSONType=function(t){return null===t?"null":i(t)?"array":void 0===t?"undefined":e(t)},Typeson.JSON_TYPES=["null","boolean","number","string","array","object"];for(var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256),p=0;p<u.length;p++)l[u.charCodeAt(p)]=p;var f=function encode(e,t,n){for(var r=new Uint8Array(e,t,n),i=r.length,a="",o=0;o<i;o+=3)a+=u[r[o]>>2],a+=u[(3&r[o])<<4|r[o+1]>>4],a+=u[(15&r[o+1])<<2|r[o+2]>>6],a+=u[63&r[o+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},g=function decode(e){var t=e.length,n=.75*e.length,r=0,i=void 0,a=void 0,o=void 0,s=void 0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);for(var c=new ArrayBuffer(n),A=new Uint8Array(c),u=0;u<t;u+=4)i=l[e.charCodeAt(u)],a=l[e.charCodeAt(u+1)],o=l[e.charCodeAt(u+2)],s=l[e.charCodeAt(u+3)],A[r++]=i<<2|a>>4,A[r++]=(15&a)<<4|o>>2,A[r++]=(3&o)<<6|63&s;return c},y={arraybuffer:{test:function test(e){return"ArrayBuffer"===Typeson.toStringTag(e)},replace:function replace(e,t){t.buffers||(t.buffers=[]);var n=t.buffers.indexOf(e);return n>-1?{index:n}:(t.buffers.push(e),f(e))},revive:function revive(t,n){if(n.buffers||(n.buffers=[]),"object"===(void 0===t?"undefined":e(t)))return n.buffers[t.index];var r=g(t);return n.buffers.push(r),r}}};function string2arraybuffer(e){for(var t=new Uint16Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer}var d={blob:{test:function test(e){return"Blob"===Typeson.toStringTag(e)},replace:function replace(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),"undefined"!=typeof TextEncoder&&t.overrideMimeType("text/plain; charset=utf-16le"),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText}},revive:function revive(e){var t=e.type,n=e.stringContents;return new Blob([string2arraybuffer(n)],{type:t})},replaceAsync:function replaceAsync(e){return new Typeson.Promise(function(t,n){if(e.isClosed)n(new Error("The Blob is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e,"UTF-16")}})}}},w={};var b={cloneable:{test:function test(t){return t&&"object"===(void 0===t?"undefined":e(t))&&"function"==typeof t[Symbol.for("cloneEncapsulate")]},replace:function replace(e){var t=e[Symbol.for("cloneEncapsulate")](),n=function generateUUID(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return w[n]=e,{uuid:n,encapsulated:t}},revive:function revive(e){var t=e.uuid,n=e.encapsulated;return w[t][Symbol.for("cloneRevive")](n)}}},v={dataview:{test:function test(e){return"DataView"===Typeson.toStringTag(e)},replace:function replace(e,t){var n=e.buffer,r=e.byteOffset,i=e.byteLength;t.buffers||(t.buffers=[]);var a=t.buffers.indexOf(n);return a>-1?{index:a,byteOffset:r,byteLength:i}:(t.buffers.push(n),{encoded:f(n),byteOffset:r,byteLength:i})},revive:function revive(e,t){t.buffers||(t.buffers=[]);var n=e.byteOffset,r=e.byteLength,i=e.encoded,a=e.index,o=void 0;return"index"in e?o=t.buffers[a]:(o=g(i),t.buffers.push(o)),new DataView(o,n,r)}}},h={date:{test:function test(e){return"Date"===Typeson.toStringTag(e)},replace:function replace(e){var t=e.getTime();return isNaN(t)?"NaN":t},revive:function revive(e){return"NaN"===e?new Date(NaN):new Date(e)}}},m={error:{test:function test(e){return"Error"===Typeson.toStringTag(e)},replace:function replace(e){return{name:e.name,message:e.message}},revive:function revive(e){var t=e.name,n=e.message,r=new Error(n);return r.name=t,r}}},I="undefined"==typeof self?global:self,C={};["TypeError","RangeError","SyntaxError","ReferenceError","EvalError","URIError","InternalError"].forEach(function(e){var t=I[e];t&&(C[e.toLowerCase()]={test:function test(e){return Typeson.hasConstructorOf(e,t)},replace:function replace(e){return e.message},revive:function revive(e){return new t(e)}})});var D={file:{test:function test(e){return"File"===Typeson.toStringTag(e)},replace:function replace(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),"undefined"!=typeof TextEncoder&&t.overrideMimeType("text/plain; charset=utf-16le"),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText,name:e.name,lastModified:e.lastModified}},revive:function revive(e){var t=e.name,n=e.type,r=e.stringContents,i=e.lastModified,a=string2arraybuffer(r);return new File([a],t,{type:n,lastModified:i})},replaceAsync:function replaceAsync(e){return new Typeson.Promise(function(t,n){if(e.isClosed)n(new Error("The File is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result,name:e.name,lastModified:e.lastModified})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e,"UTF-16")}})}}},x={file:D.file,filelist:{test:function test(e){return"FileList"===Typeson.toStringTag(e)},replace:function replace(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.item(n);return t},revive:function revive(e){function FileList(){this._files=arguments[0],this.length=this._files.length}return FileList.prototype.item=function(e){return this._files[e]},FileList.prototype[Symbol.toStringTag]="FileList",new FileList(e)}}},B={imagebitmap:{test:function test(e){return"ImageBitmap"===Typeson.toStringTag(e)||e&&e.dataset&&"ImageBitmap"===e.dataset.toStringTag},replace:function replace(e){var t=document.createElement("canvas");return t.getContext("2d").drawImage(e,0,0),t.toDataURL()},revive:function revive(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,t},reviveAsync:function reviveAsync(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,createImageBitmap(t)}}},M={imagedata:{test:function test(e){return"ImageData"===Typeson.toStringTag(e)},replace:function replace(e){return{array:Array.from(e.data),width:e.width,height:e.height}},revive:function revive(e){return new ImageData(new Uint8ClampedArray(e.array),e.width,e.height)}}},E={infinity:{test:function test(e){return e===1/0},replace:function replace(e){return"Infinity"},revive:function revive(e){return 1/0}}},O={IntlCollator:{test:function test(e){return Typeson.hasConstructorOf(e,Intl.Collator)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.Collator(e.locale,e)}},IntlDateTimeFormat:{test:function test(e){return Typeson.hasConstructorOf(e,Intl.DateTimeFormat)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.DateTimeFormat(e.locale,e)}},IntlNumberFormat:{test:function test(e){return Typeson.hasConstructorOf(e,Intl.NumberFormat)},replace:function replace(e){return e.resolvedOptions()},revive:function revive(e){return new Intl.NumberFormat(e.locale,e)}}},T={map:{test:function test(e){return"Map"===Typeson.toStringTag(e)},replace:function replace(e){return Array.from(e.entries())},revive:function revive(e){return new Map(e)}}},S={nan:{test:function test(e){return"number"==typeof e&&isNaN(e)},replace:function replace(e){return"NaN"},revive:function revive(e){return NaN}}},Q={negativeInfinity:{test:function test(e){return e===-1/0},replace:function replace(e){return"-Infinity"},revive:function revive(e){return-1/0}}},q={nonbuiltinIgnore:{test:function test(t){return t&&"object"===(void 0===t?"undefined":e(t))&&!Array.isArray(t)&&!["Object","Boolean","Number","String","Error","RegExp","Math","Date","Map","Set","JSON","ArrayBuffer","SharedArrayBuffer","DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","Promise","String Iterator","Array Iterator","Map Iterator","Set Iterator","WeakMap","WeakSet","Atomics","Module"].includes(Typeson.toStringTag(t))},replace:function replace(e){}}},U={StringObject:{test:function test(t){return"String"===Typeson.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return String(e)},revive:function revive(e){return new String(e)}},BooleanObject:{test:function test(t){return"Boolean"===Typeson.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return Boolean(e)},revive:function revive(e){return new Boolean(e)}},NumberObject:{test:function test(t){return"Number"===Typeson.toStringTag(t)&&"object"===(void 0===t?"undefined":e(t))},replace:function replace(e){return Number(e)},revive:function revive(e){return new Number(e)}}},j={regexp:{test:function test(e){return"RegExp"===Typeson.toStringTag(e)},replace:function replace(e){return{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")}},revive:function revive(e){var t=e.source,n=e.flags;return new RegExp(t,n)}}},L={};var P={resurrectable:{test:function test(t){return t&&!Array.isArray(t)&&["object","function","symbol"].includes(void 0===t?"undefined":e(t))},replace:function replace(e){var t=function generateUUID$1(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return L[t]=e,t},revive:function revive(e){return L[e]}}},V={set:{test:function test(e){return"Set"===Typeson.toStringTag(e)},replace:function replace(e){return Array.from(e.values())},revive:function revive(e){return new Set(e)}}},F="undefined"==typeof self?global:self,N={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=F[e];n&&(N[e.toLowerCase()]={test:function test(e){return Typeson.toStringTag(e)===t},replace:function replace(e){return(0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e:e.slice(0)).buffer},revive:function revive(e){return"ArrayBuffer"===Typeson.toStringTag(e)?new n(e):e}})});var k="undefined"==typeof self?global:self,J={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=k[t];n&&(J[e.toLowerCase()]={test:function test(e){return Typeson.toStringTag(e)===t},replace:function replace(e,t){var n=e.buffer,r=e.byteOffset,i=e.length;t.buffers||(t.buffers=[]);var a=t.buffers.indexOf(n);return a>-1?{index:a,byteOffset:r,length:i}:(t.buffers.push(n),{encoded:f(n),byteOffset:r,length:i})},revive:function revive(e,t){t.buffers||(t.buffers=[]);var r=e.byteOffset,i=e.length,a=e.encoded,o=e.index,s=void 0;return"index"in e?s=t.buffers[o]:(s=g(a),t.buffers.push(s)),new n(s,r,i)}})});var K={undef:{test:function test(e,t){return void 0===e&&(t.ownKeys||!("ownKeys"in t))},replace:function replace(e){return null},revive:function revive(e){return new Typeson.Undefined}}},Y={userObject:{test:function test(e,t){return Typeson.isUserObject(e)},replace:function replace(e){return Object.assign({},e)},revive:function revive(e){return e}}},G=[{sparseArrays:{testPlainObjects:!0,test:function test(e){return Array.isArray(e)},replace:function replace(e,t){return t.iterateUnsetNumeric=!0,e}}},{sparseUndefined:{test:function test(e,t){return void 0===e&&!1===t.ownKeys},replace:function replace(e){return null},revive:function revive(e){}}}],W=[G,K],Z=[S,E,Q],_=[W,U,Z,h,m,C,j].concat("function"==typeof Map?T:[],"function"==typeof Set?V:[],"function"==typeof ArrayBuffer?y:[],"function"==typeof Uint8Array?J:[],"function"==typeof DataView?v:[],"undefined"!=typeof Intl?O:[]),$=[m,C],z=[_,{ArrayBuffer:null},N],H=[Y,W,U,Z,h,j,M,B,D,x,d].concat("function"==typeof Map?T:[],"function"==typeof Set?V:[],"function"==typeof ArrayBuffer?y:[],"function"==typeof Uint8Array?J:[],"function"==typeof DataView?v:[],"undefined"!=typeof Intl?O:[]),X=H.concat({checkDataCloneException:[function(t){var n={}.toString.call(t).slice(8,-1);if(["symbol","function"].includes(void 0===t?"undefined":e(t))||["Arguments","Module","Error","Promise","WeakMap","WeakSet"].includes(n)||t===Object.prototype||("Blob"===n||"File"===n)&&t.isClosed||t&&"object"===(void 0===t?"undefined":e(t))&&"number"==typeof t.nodeType&&"function"==typeof t.insertBefore)throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}]}),ee=[_];Typeson.types={arraybuffer:y,blob:d,cloneable:b,dataview:v,date:h,error:m,errors:C,file:D,filelist:x,imagebitmap:B,imagedata:M,infinity:E,intlTypes:O,map:T,nan:S,negativeInfinity:Q,nonbuiltinIgnore:q,primitiveObjects:U,regexp:j,resurrectable:P,set:V,typedArraysSocketio:N,typedArrays:J,undef:K,userObject:Y},Typeson.presets={builtin:_,postMessage:$,socketio:z,sparseUndefined:G,specialNumbers:Z,structuredCloningThrowing:X,structuredCloning:H,undef:W,universal:ee};var te="undefined"!=typeof module,ne=te&&require("uuid/v4"),re=te&&require("whatwg-url")||{},ie=te&&require("jsdom/lib/jsdom/living/generated/utils")||{},ae=re.serializeURLOrigin,oe=re.parseURL,se={},ce=ie.implSymbol,Ae=XMLHttpRequest.prototype.open;URL.createObjectURL||(URL.createObjectURL=function createObjectURL(e){var t="blob:"+ae(oe(location.href))+"/"+ne();return se[t]=e,t},XMLHttpRequest.prototype.open=function xmlHttpRequestOpen(e,t,n){/^blob:/.test(t)&&(t="data:text/plain,"+se[t][ce]._buffer.toString("utf16le"));return Ae.call(this,e,t,n)}),mocha.setup({ui:"bdd",timeout:5e3});var ue="undefined"!=typeof module?global:window;function FileList$1(){this._files=arguments[0],this.length=this._files.length}function Person(e,t,n,r){e&&(this.name=e),t&&(this.age=t),n&&(this.dob=n),r&&(this.isMarried=r)}function SimulatedNonBuiltIn(){this.aaa=5}function MyCloneable(e){this.obj=e,this.nonpersistentStateInfo=Math.random()}FileList$1.prototype.item=function(e){return this._files[e]},FileList$1.prototype[Symbol.toStringTag]="FileList",Object.defineProperty(ue.HTMLInputElement.prototype,"files",{get:function get(){return new FileList$1(this._files)},set:function set(e){this._files=e}}),ue.FileList=FileList$1,ue.expect=chai.expect,ue.assert=chai.assert,Person.prototype.name="",Person.prototype.age=0,Person.prototype.dob=new Date(1900,0,1),Person.prototype.isMarried=!1,SimulatedNonBuiltIn.prototype.bbb=8,SimulatedNonBuiltIn.prototype[Symbol.toStringTag]="SimulatedNonBuiltIn",MyCloneable.prototype[Symbol.for("cloneEncapsulate")]=function(){return{obj:JSON.stringify(this.obj)}},MyCloneable.prototype[Symbol.for("cloneRevive")]=function(e){return new MyCloneable(JSON.parse(e.obj))},MyCloneable.prototype.prototypeProperty=10;var le={Person:Person,SimulatedNonBuiltIn:SimulatedNonBuiltIn,MyCloneable:MyCloneable,MyResurrectable:function MyResurrectable(){}},pe=Typeson.types,fe=pe.errors,ge=pe.typedArrays,ye=pe.intlTypes,de=pe.undef,we=pe.primitiveObjects,be=pe.nan,ve=pe.infinity,he=pe.negativeInfinity,me=pe.date,Ie=pe.error,Ce=pe.regexp,De=pe.map,xe=pe.set,Be=pe.arraybuffer,Me=pe.dataview,Ee=pe.imagedata,Oe=pe.imagebitmap,Te=pe.blob,Se=pe.file,Qe=pe.filelist,qe=pe.nonbuiltinIgnore,Ue=pe.userObject,je=pe.cloneable,Le=pe.resurrectable,Pe=Typeson.presets,Ve=Pe.builtin,Fe=Pe.universal,Ne=Pe.structuredCloningThrowing,ke=Pe.structuredCloning,Re=Pe.specialNumbers,Je=Pe.postMessage,Ke=Pe.undef,Ye=Pe.sparseUndefined;function ErrorAndErrors(e){describe("Error and Errors",function(){it("should get back real Error instances corresponding to their types and with the original name and message",function(){var t=(new Typeson).register(e||[Ie,fe]),n=t.stringify({e1:new Error("Error1"),e2:new TypeError("Error2"),e3:new RangeError("Error3"),e4:new SyntaxError("Error4"),e5:new ReferenceError("Error5")}),r=t.parse(n);expect(r.e1).to.be.an.instanceOf(Error),expect(r.e1.name).to.equal("Error"),expect(r.e2).to.be.an.instanceOf(TypeError),expect(r.e2.name).to.equal("TypeError"),expect(r.e3).to.be.an.instanceOf(RangeError),expect(r.e3.name).to.equal("RangeError"),expect(r.e4).to.be.an.instanceOf(SyntaxError),expect(r.e4.name).to.equal("SyntaxError"),expect(r.e5).to.be.an.instanceOf(ReferenceError),expect(r.e5.name).to.equal("ReferenceError")})})}function SpecialNumbers(e){describe("Special numbers",function(){it("NaN",function(){var t=(new Typeson).register(e||be),n=t.stringify(NaN,null,2),r=t.parse(n);expect(r).to.be.NaN}),it("Infinity",function(){var t=(new Typeson).register(e||ve),n=t.stringify(1/0,null,2),r=t.parse(n);expect(r).to.equal(1/0)}),it("-Infinity",function(){var t=(new Typeson).register(e||he),n=t.stringify(-1/0,null,2),r=t.parse(n);expect(r).to.equal(-1/0)}),it("should not mistake string forms of the special numbers",function(){var t=(new Typeson).register(e||[be,ve,he]),n=t.stringify("NaN",null,2),r=t.parse(n);expect(r).to.equal("NaN"),n=t.stringify("Infinity",null,2),r=t.parse(n),expect(r).to.equal("Infinity"),n=t.stringify("-Infinity",null,2),r=t.parse(n),expect(r).to.equal("-Infinity")}),it("should not disturb encoding of normal numbers",function(){var t=(new Typeson).register(e||[be,ve,he]),n=t.stringify(512,null,2),r=t.parse(n);expect(r).to.equal(512)})})}function Undefined$1(e){describe("undefined type",function(){it("should be possible to restore `undefined` properties",function(){var t=(new Typeson).register(e||de),n=[void 0,{b:void 0,c:[3,null,,void 0]}],r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(2),expect(i[0]).to.equal(void 0),expect(i[1].b).to.equal(void 0),expect("b"in i[1]).to.be.true,expect(i[1].c[0]).to.equal(3),expect(i[1].c[1]).to.equal(null),expect(i[1].c[3]).to.equal(void 0),expect("0"in i).to.be.true,expect("b"in i[1]).to.be.true,expect("1"in i[1].c).to.be.true,expect("3"in i[1].c).to.be.true,e?(expect(i[1].c[2]).to.equal(void 0),expect("2"in i[1].c).to.be.false):(expect(i[1].c[2]).to.not.equal(void 0),expect(i[1].c[2]).to.equal(null),expect("2"in i[1].c).to.be.true)}),it("should be possible to restore `undefined` at root",function(){var t=(new Typeson).register(e||de),n=t.stringify(void 0);expect(n).to.equal('{"$":null,"$types":{"$":{"":"undef"}}}');var r=t.parse(n);expect(r).to.be.undefined})})}function BuiltIn(e){Undefined$1(e),describe("Primitive objects",function(){it("String object",function(){var t=(new Typeson).register(e||we),n=new String("hello"),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(String),expect(i.valueOf()).to.equal("hello"),expect(i.length).to.equal(5)}),it("Boolean object",function(){var t=(new Typeson).register(e||we),n=new Boolean(!0),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Boolean),expect(i.valueOf()).to.equal(!0)}),it("Number object",function(){var t=(new Typeson).register(e||we),n=new Number(456),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Number),expect(i.valueOf()).to.equal(456)})}),SpecialNumbers(),describe("Date",function(){it("should get back a real Date instance with the original time milliseconds",function(){var t=(new Typeson).register(e||me),n=t.stringify(new Date(1234567)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.equal(1234567)}),it("should get back a real invalid Date instance",function(){var t=(new Typeson).register(e||me),n=t.stringify(new Date(NaN)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.be.NaN})}),ErrorAndErrors(e),describe("RegExp",function(){it("should return a RegExp",function(){var t=(new Typeson).register(e||[Ce]),n=new RegExp("ab?c","guy"),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof RegExp),expect(i.global).to.equal(!0),expect(i.unicode).to.equal(!0),expect(i.sticky).to.equal(!0),expect(i.ignoreCase).to.equal(!1),expect(i.multiline).to.equal(!1),expect(i.source).to.equal("ab?c"),n=/ab?c/im,r=t.stringify(n,null,2),i=t.parse(r),expect(i instanceof RegExp),expect(i.global).to.equal(!1),expect(i.unicode).to.equal(!1),expect(i.sticky).to.equal(!1),expect(i.ignoreCase).to.equal(!0),expect(i.multiline).to.equal(!0),expect(i.source).to.equal("ab?c")})}),describe("Map",function(){it("should get back a real Map instance with the original data and use complex types also in contained items",function(){var t=(new Typeson).register(e||De),n=new Map,r=new Error("Error here"),i=new Date(1e4);n.set(r,i);var a=t.stringify({m:n}),o=t.parse(a);expect(o.m).to.be.an.instanceOf(Map),e&&(expect(Array.from(o.m.keys())[0]).to.be.an.instanceOf(Error),expect(Array.from(o.m.values())[0]).to.be.an.instanceOf(Date))})}),describe("Set",function(){it("should get back a real Set instance with the original data and use complex types also in contained items",function(){var t=(new Typeson).register(e||xe),n=new Set,r=new Error("Error here"),i=new Date(1e4),a={a:r};n.add(a),n.add(i),n.add("");var o=t.stringify({s:n}),s=t.parse(o);expect(s.s).to.be.an.instanceOf(Set);var c=Array.from(s.s.values());e&&(expect(c[0].a).to.be.an.instanceOf(Error),expect(c[1]).to.be.an.instanceOf(Date)),expect(c[2]).to.be.a("string")})}),describe("ArrayBuffer",function(){it("should return an ArrayBuffer",function(){var t=(new Typeson).register(e||[Be]),n=new ArrayBuffer(16),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof ArrayBuffer),expect(i.byteLength).to.equal(16)}),it("should return the same ArrayBuffer instance",function(){var t=(new Typeson).register(e||[Be]),n=new ArrayBuffer(16),r={buf1:n,buf2:n},i=t.stringify(r,null,2),a=t.parse(i);expect(a.buf1 instanceof ArrayBuffer),expect(a.buf2 instanceof ArrayBuffer),expect(a.buf1).to.equal(a.buf2)})}),describe("TypedArrays",function(){describe("Float64Array",function(){it("should get back real Float64Array instance with original array content",function(){var t=(new Typeson).register(e||[Be,ge]),n=new Float64Array(3);n[0]=23.8,n[1]=-15,n[2]=99;var r=t.stringify({a:n}),i=t.parse(r);expect(i.a).to.be.an.instanceOf(Float64Array),expect(i.a.length).to.equal(3),expect(i.a[0]).to.equal(23.8),expect(i.a[1]).to.equal(-15),expect(i.a[2]).to.equal(99)})}),describe("Uint16 arrays over invalid unicode range",function(){it("should work to use any 16-bit number no matter whether it is invalid unicode or not",function(){for(var t=(new Typeson).register(e||[Be,ge]),n=new Uint16Array(2304),r=n.length;r--;)n[r]=r+55168;var i=t.stringify({a:n});r=i.length;for(var a=new Uint16Array(r);r--;){var o=i.charCodeAt(r);a[r]=o>=55296&&o<57344?65533:o}i=String.fromCharCode.apply(null,a);var s=t.parse(i);expect(s.a).to.be.an.instanceOf(Uint16Array),expect(s.a.length).to.equal(n.length),s.a.forEach(function(e,t){expect(e).to.equal(t+55168)})})}),describe("Int8 arrays with odd length",function(){it("should be possible to use an odd length of an Int8Array",function(){var t=(new Typeson).register(e||[Be,ge]),n=new Int8Array(3);n[0]=0,n[1]=1,n[2]=2;var r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(3),expect(i[0]).to.equal(0),expect(i[1]).to.equal(1),expect(i[2]).to.equal(2)})}),describe("Uint8 arrays with shared buffer object",function(){it("should return the same buffer object from different wrappers (or data views or buffer itself)",function(){var t=(new Typeson).register(e||[Be,ge,Me]),n=new ArrayBuffer(7),r=new DataView(n,3,4),i={wrapper1:new Uint8Array(n),wrapper2:new Uint16Array(n,2,2),buffer:n,dataView:r};i.wrapper1[0]=1,i.wrapper2[1]=65535;var a=t.stringify(i),o=t.parse(a);expect(o.wrapper1.buffer).to.equal(o.wrapper2.buffer),expect(o.wrapper1.buffer).to.equal(o.buffer),expect(o.wrapper1.buffer).to.equal(o.dataView.buffer)})})}),describe("DataView",function(){it("should return a DataView",function(){var t=(new Typeson).register(e||[Me]),n=new Uint8Array([68,51,34,17,255,238,221,204]).buffer,r=new DataView(n,3,4);expect(r.byteLength).to.equal(4);var i=t.stringify(r,null,2),a=t.parse(i);expect(a).to.be.an.instanceOf(DataView),expect(a.byteLength).to.equal(4)}),it("should reproduce DataView with the same buffer",function(){var t=(new Typeson).register(e||[Me]),n=new Uint8Array([68,51,34,17,255,238,221,204]).buffer,r={dataView1:new DataView(n,3,4),dataView2:new DataView(n,3,4),dataView3:new DataView(n,3,4)},i=t.stringify(r,null,2),a=t.parse(i);expect(a.dataView1).to.be.an.instanceOf(DataView),expect(a.dataView2).to.be.an.instanceOf(DataView),expect(a.dataView3).to.be.an.instanceOf(DataView),expect(a.dataView1.byteLength).to.equal(4)})}),describe("Intl types",function(){it("should return a Intl.Collator",function(){var t=(new Typeson).register(e||[ye]),n={localeMatcher:"lookup",usage:"search",sensitivity:"base",ignorePunctuation:!0,numeric:!0,caseFirst:"upper"},r=JSON.parse(JSON.stringify(n)),i=new Intl.Collator(["en","hi","de-AT","de-DE-u-co-phonebk","en-US-u-kn-true","en-US-u-kf-upper"],n),a=i.resolvedOptions().locale,o=t.stringify(i,null,2),s=t.parse(o);expect(s instanceof Intl.Collator),expect(s.resolvedOptions().locale).to.deep.equal(a),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(s.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.DateTimeFormat",function(){var t=(new Typeson).register(e||[ye]),n={localeMatcher:"lookup",timeZone:"Asia/Shanghai",hour12:!1,formatMatcher:"basic"},r=JSON.parse(JSON.stringify(n)),i=new Intl.DateTimeFormat(["hi","de-AT","de-DE-u-nu-latn","en-US-u-ca-persian"],n),a=t.stringify(i,null,2),o=t.parse(a);expect(o instanceof Intl.DateTimeFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales","formatMatcher","hour12"].includes(e)}).forEach(function(e){expect(o.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.NumberFormat",function(){var t=(new Typeson).register(e||[ye]),n={localeMatcher:"lookup",style:"currency",currency:"EUR",currencyDisplay:"symbol",useGrouping:!1},r=JSON.parse(JSON.stringify(n)),i=new Intl.NumberFormat(["hi","de-AT","de-DE-u-nu-bali"],n),a=t.stringify(i,null,2),o=t.parse(a);expect(o instanceof Intl.NumberFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(o.resolvedOptions()[e]).to.deep.equal(r[e])})})})}describe("Built-in",BuiltIn),describe("ImageData",function(){it("should get back an ImageData instance with the original data",function(){var e=(new Typeson).register(Ee),t=new ImageData(1,3),n=e.stringify(t),r=e.parse(n);expect(r.width).to.equal(1),expect(r.height).to.equal(3),expect(r.data).to.deep.equal(new Uint8ClampedArray(12))})}),describe("ImageBitmap",function(){it("should get back an ImageBitmap instance with the original data",function(e){var t=(new Typeson).register(Oe),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parse(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"}),it("should get back an ImageBitmap instance with the original data asynchronously",function(e){var t=(new Typeson).register(Oe),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parseAsync(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"})}),describe("Blob",function(){it("should get back a Blob instance with the original data",function(e){this.timeout(1e4);var t=(new Typeson).register(Te),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"}),i=t.stringify(r),a=t.parse(i);expect(a.type).to.equal("application/json"),expect("name"in a).to.be.false,expect("lastModified"in a).to.be.false;var o=new FileReader;o.addEventListener("load",function(){expect(o.result).to.equal(n),e()}),o.addEventListener("error",function(){assert(!1,"FileReader should not err")}),o.readAsText(a)}),it("should get back a Blob instance with the original data asynchronously",function(e){var t=(new Typeson).register(Te),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"});t.stringifyAsync(r).then(function(r){var i=t.parse(r);expect(i.type).to.equal("application/json"),expect("name"in i).to.be.false,expect("lastModified"in i).to.be.false;var a=new FileReader;a.addEventListener("load",function(){expect(a.result).to.equal(n),e()}),a.addEventListener("error",function(){assert(!1,"FileReader should not err")}),a.readAsText(i)})}),it("Handle large (typed array) Blobs",function(e){function largeValue(e,t){for(var n=new Uint8Array(e),r=1e3+t,i=0;i<e;++i)r^=r<<13,r^=r>>17,r^=r<<5,n[i]=255&r;return n}this.timeout(1e4);var t=(new Typeson).register(Te),n=new Blob([largeValue(131072,1)],{type:"text/x-blink-1"}),r=t.stringify(n),i=t.parse(r);expect(i.size,"Sync large val").to.equal(131072);var a=new Blob([largeValue(131072,1)],{type:"text/x-blink-1"});t.stringifyAsync(a).then(function(n){var r=t.parse(n);expect(r.size,"Async large val").to.equal(131072),e()})})}),describe("File",function(){this.timeout(1e4),it("should get back a File instance with the original data",function(e){var t=(new Typeson).register(Se),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n}),a=t.stringify(i),o=t.parse(a);expect(o.lastModified).to.equal(n.getTime()),expect(o.type).to.equal("application/json"),expect(o.name).to.equal("aName");var s=new FileReader;s.addEventListener("load",function(){expect(s.result).to.equal(r),e()}),s.addEventListener("error",function(){assert(!1,"FileReader should not err")}),s.readAsText(o)}),it("should get back a File instance with the original data asynchronously",function(e){var t=(new Typeson).register(Se),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n});t.stringifyAsync(i).then(function(i){var a=t.parse(i);expect(a.lastModified).to.equal(n.getTime()),expect(a.type).to.equal("application/json"),expect(a.name).to.equal("aName");var o=new FileReader;o.addEventListener("load",function(){expect(o.result).to.equal(r),e()}),o.addEventListener("error",function(){assert(!1,"FileReader should not err")}),o.readAsText(a)})})}),describe("FileList",function(){this.timeout(1e4),it("should get back a FileList instance with the original data",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new Typeson).register(Qe),i=r.stringify(n.files),a=r.parse(i);expect(a.item(0)).to.be.an.instanceOf(File),expect(a.item(0).lastModified).to.equal(e.getTime()),expect(a.item(0).type).to.equal("text/plain"),expect(a.item(0).name).to.equal("abc"),expect(a.item(1)).to.be.an.instanceOf(File),expect(a.item(1).lastModified).to.equal(t.getTime()),expect(a.item(1).type).to.equal("text/html"),expect(a.item(1).name).to.equal("def")}),it("should get back a FileList instance with the original data asynchronously",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new Typeson).register(Qe);r.stringifyAsync(n.files).then(function(n){var i=r.parse(n);expect(i.item(0)).to.be.an.instanceOf(File),expect(i.item(0).lastModified).to.equal(e.getTime()),expect(i.item(0).type).to.equal("text/plain"),expect(i.item(0).name).to.equal("abc"),expect(i.item(1)).to.be.an.instanceOf(File),expect(i.item(1).lastModified).to.equal(t.getTime()),expect(i.item(1).type).to.equal("text/html"),expect(i.item(1).name).to.equal("def")})})}),describe("Non-built-in object ignoring",function(){it("should ignore non-built-in objects (simulated)",function(){var e=(new Typeson).register(qe),t=new le.Person("John Doe"),n=new le.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"John Doe"}});var a=e.encapsulate(["a",n,5,null]);expect("0"in a).to.be.true,expect("1"in a).to.be.false,expect("2"in a).to.be.true,expect("3"in a).to.be.true})}),describe("User objects",function(){it("should do recursive type checking on user instantiated objects",function(){var e=(new Typeson).register([Ue,me]),t=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0),n=new le.SimulatedNonBuiltIn;n.prop=500;var r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,dob:new Date(2e3,5,20),isMarried:!0},b:{aaa:5,prop:500}}),expect("dob"in i.a).to.be.true}),it("should work with nonbuiltin-ignore",function(){var e=(new Typeson).register([Ue,qe]),t=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0);t.nonbuiltin=new le.SimulatedNonBuiltIn;var n=new le.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,isMarried:!0,dob:new Date(2e3,5,20).toJSON()}}),expect("nonbuiltin"in i.a).to.be.false})}),describe("Cloneables",function(){it("Should work with custom cloneable objects",function(){var e=(new Typeson).register(je),t={a:1,b:2},n=new le.MyCloneable(t),r=n.nonpersistentStateInfo,i=e.encapsulate(n);expect(n[Symbol.for("cloneEncapsulate")]()).to.deep.equal({obj:JSON.stringify(t)}),expect("nonpersistentStateInfo"in i).to.be.false,expect("prototypeProperty"in i).to.be.false;var a=JSON.stringify(i),o=e.parse(a);expect(o).to.be.an.instanceOf(le.MyCloneable),expect(o).to.not.equal(n),expect(o.obj).to.deep.equal(t),expect(o.hasOwnProperty("nonpersistentStateInfo")).to.be.true,expect(o.nonpersistentStateInfo).to.not.equal(r),expect("prototypeProperty"in o).to.be.true,expect(o.hasOwnProperty("prototypeProperty")).to.be.false})}),describe("Resurrectables",function(){it("Should work with custom resurrectable objects",function(){var e=(new Typeson).register(Le),t=new le.MyResurrectable,n=function resurrectableFunction(){},r=Symbol("resurrectable"),i={},a=[3,4,5],o=e.encapsulate([t,n,r,i,a]),s=JSON.stringify(o),c=e.parse(s);expect(c[0]).to.equal(t),expect(c[1]).to.equal(n),expect(c[2]).to.equal(r),expect(c[3]).to.not.equal(i),expect(c[4]).to.not.equal(a)})}),describe("Presets",function(){describe("Built-in (as preset)",function(){BuiltIn([Ve])}),describe("postMessage",function(){ErrorAndErrors([Je])}),describe("Universal",function(){BuiltIn([Fe])}),describe("Structured cloning",function(){it("should work with Structured cloning with throwing",function(){var e=(new Typeson).register([Ne]),t=!1;try{e.stringify(new Error("test"))}catch(e){t=!0}assert(t,"Caught error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should work with Structured cloning without throwing",function(){var e=(new Typeson).register([ke]),t=!1;try{e.stringify(new Error("test"))}catch(e){console.log(e),t=!0}assert(!t,"Did not catch error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should allow recursive type checking on user instantiated objects",function(){var e=(new Typeson).register([ke]),t=new le.Person("John Doe"),n=new le.Person("Bob Smith",30,new Date(2e3,5,20),!0),r=e.parse(e.stringify([t,n]));expect(r).to.have.same.deep.members([{name:"John Doe"},{name:"Bob Smith",dob:new Date(2e3,5,20),age:30,isMarried:!0}])}),it("should work with recursive structures",function(){var e=(new Typeson).register(Ne),t=[];t.push(t);var n=e.parse(e.stringify(t));expect(n[0]).to.equal(n)})}),describe("Special Numbers (as preset)",function(){SpecialNumbers([Re])}),describe("Undefined (as preset)",function(){Undefined$1([Ke])}),describe("Sparse undefined",function(){it("should be possible to restore `undefined` properties",function(){var e=(new Typeson).register([Ye]),t=[void 0,{b:void 0,c:[3,null,,void 0]}],n=e.stringify(t),r=e.parse(n);expect(r.length).to.equal(2),expect(r[0]).to.equal(null),expect("b"in r[1]).to.be.false,expect(r[1].c[0]).to.equal(3),expect(r[1].c[1]).to.equal(null),expect(r[1].c[2]).to.equal(void 0),expect("2"in r[1].c).to.be.false,expect(r[1].c[3]).to.equal(null)})})}),mocha.run()});
//# sourceMappingURL=test-polyglot.js.map
