!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t){return o.isObject(e)&&"function"==typeof e.then&&(!t||"function"==typeof e.catch)}function t(e){return B.call(e).slice(8,-1)}function n(e,t){if(!e||"object"!==(void 0===e?"undefined":I(e)))return!1;var n=E(e);if(!n)return!1;var r=O.call(n,"constructor")&&n.constructor;return"function"!=typeof r?null===t:"function"==typeof r&&null!==t&&S.call(r)===S.call(t)}function r(e){if(!e||"Object"!==t(e))return!1;return!E(e)||n(e,Object)}function i(e){if(!e||"Object"!==t(e))return!1;var r=E(e);return!r||(n(e,Object)||i(r))}function a(e){return e&&"object"===(void 0===e?"undefined":I(e))}function o(t){var i=[],s=[],g={},p=this.types={},y=this.stringify=function(e,n,r,i){i=Object.assign({},t,i,{stringification:!0});var a=w(e,null,i);return M(a)?JSON.stringify(a[0],n,r):a.then(function(e){return JSON.stringify(e,n,r)})};this.stringifySync=function(e,t,n,r){return y(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!0}))},this.stringifyAsync=function(e,t,n,r){return y(e,t,n,Object.assign({},{throwOnBadSyncType:!0},r,{sync:!1}))};var d=this.parse=function(e,n,r){return r=Object.assign({},t,r,{parse:!0}),b(JSON.parse(e,n),r)};this.parseSync=function(e,t,n){return d(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.parseAsync=function(e,t,n){return d(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))},this.specialTypeNames=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.returnTypeNames=!0,this.encapsulate(e,t,n)},this.rootTypeName=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.iterateNone=!0,this.encapsulate(e,t,n)};var w=this.encapsulate=function(e,A,u){function l(e){if(u.iterateNone){var t=Object.values(b);return t.length?t[0]:o.getJSONType(e)}var n=Object.values(b);if(n.length){if(u.returnTypeNames)return[].concat(D(new Set(n)));e&&r(e)&&!e.hasOwnProperty("$types")?e.$types=b:e={$:e,$types:{$:b}}}else a(e)&&e.hasOwnProperty("$types")&&(e={$:e,$types:!0});return!u.returnTypeNames&&e}function p(e,t){return Promise.all(t.map(function(e){return e[1].p})).then(function(r){return Promise.all(r.map(function(r){var i=[],a=t.splice(0,1)[0],o=C(a,7),A=o[0],c=o[2],s=o[3],u=o[4],l=o[5],g=o[6],d=y(A,r,c,s,i,!0,g),w=n(d,f);return A&&w?d.p.then(function(t){return u[l]=t,p(e,i)}):(A?u[l]=d:e=w?d.p:d,p(e,i))}))}).then(function(){return e})}function y(e,t,a,A,s,l,g){var p=void 0,w={},h=void 0===t?"undefined":I(t),C=E?function(r){var i=g||A.type||o.getJSONType(t);E(Object.assign(r||w,{keypath:e,value:t,cyclic:a,stateObj:A,promisesData:s,resolvingTypesonPromise:l,awaitingTypesonPromise:n(t,f)},void 0!==i?{type:i}:{}))}:null;if(h in{string:1,boolean:1,number:1,undefined:1})return void 0===t||"number"===h&&(isNaN(t)||t===-1/0||t===1/0)?(p=d(e,t,A,s,!1,l,C))!==t&&(w={replaced:p}):p=t,C&&C(),p;if(null===t)return C&&C(),t;if(a&&!A.iterateIn&&!A.iterateUnsetNumeric){var D=v.indexOf(t);if(!(D<0))return b[e]="#",C&&C({cyclicKeypath:m[D]}),"#"+m[D];!0===a&&(v.push(t),m.push(e))}var B=r(t),O=M(t),S=(B||O)&&(!i.length||A.replaced)||A.iterateIn?t:d(e,t,A,s,B||O,null,C),Q=void 0;if(S!==t?(p=S,w={replaced:S}):O||"array"===A.iterateIn?(Q=new Array(t.length),w={clone:Q}):B||"object"===A.iterateIn?w={clone:Q={}}:""===e&&n(t,f)?(s.push([e,t,a,A,void 0,void 0,A.type]),p=t):p=t,C&&C(),u.iterateNone)return Q||p;if(!Q)return p;if(A.iterateIn){for(var q in t){var L={ownKeys:t.hasOwnProperty(q)},j=e+(e?".":"")+c(q),U=y(j,t[q],!!a,L,s,l);n(U,f)?s.push([j,U,!!a,L,Q,q,L.type]):void 0!==U&&(Q[q]=U)}C&&C({endIterateIn:!0,end:!0})}else x(t).forEach(function(r){var i=e+(e?".":"")+c(r),o={ownKeys:!0},A=y(i,t[r],!!a,o,s,l);n(A,f)?s.push([i,A,!!a,o,Q,r,o.type]):void 0!==A&&(Q[r]=A)}),C&&C({endIterateOwn:!0,end:!0});if(A.iterateUnsetNumeric){for(var T=t.length,N=0;N<T;N++)if(!(N in t)){var F=e+(e?".":"")+N,k={ownKeys:!1},V=y(F,void 0,!!a,k,s,l);n(V,f)?s.push([F,V,!!a,k,Q,N,k.type]):void 0!==V&&(Q[N]=V)}C&&C({endIterateUnsetNumeric:!0,end:!0})}return Q}function d(e,t,n,r,a,o,A){for(var c=a?i:s,u=c.length;u--;){var l=c[u];if(l.test(t,n)){var f=l.type;if(g[f]){var p=b[e];b[e]=p?[f].concat(p):f}if(n=Object.assign(n,{type:f,replaced:!0}),(w||!l.replaceAsync)&&!l.replace)return A&&A({typeDetected:!0}),y(e,t,B&&"readonly",n,r,o,f);A&&A({replacing:!0});return y(e,l[w||!l.replaceAsync?"replace":"replaceAsync"](t,n),B&&"readonly",n,r,o,f)}}return t}var w=(u=Object.assign({sync:!0},t,u)).sync,b={},v=[],m=[],h=[],B=!(u&&"cyclic"in u)||u.cyclic,E=u.encapsulateObserver,O=y("",e,B,A||{},h);return h.length?w&&u.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(p(O,h)).then(l):!w&&u.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():u.stringification&&w?[l(O)]:w?l(O):Promise.resolve(l(O))};this.encapsulateSync=function(e,t,n){return w(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!0}))},this.encapsulateAsync=function(e,t,n){return w(e,t,Object.assign({},{throwOnBadSyncType:!0},n,{sync:!1}))};var b=this.revive=function(i,a){function o(e,t,i,a,A,y){if(!f||"$types"!==e){var d=s[e];if(M(t)||r(t)){var w=M(t)?new Array(t.length):{};for(x(t).forEach(function(r){var A=o(e+(e?".":"")+c(r),t[r],i||w,a,w,r);n(A,l)?w[r]=void 0:void 0!==A&&(w[r]=A)}),t=w;p.length;){var b=C(p[0],4),v=b[0],m=b[1],h=b[2],I=b[3],D=u(v,m);if(n(D,l))h[I]=void 0;else{if(void 0===D)break;h[I]=D}p.splice(0,1)}}if(!d)return t;if("#"===d){var B=u(i,t.substr(1));return void 0===B&&p.push([i,t.substr(1),A,y]),B}var E=a.sync;return[].concat(d).reduce(function(e,t){var n=g[t];if(!n)throw new Error("Unregistered type: "+t);return n[E&&n.revive?"revive":!E&&n.reviveAsync?"reviveAsync":"revive"](e)},t)}}var A=(a=Object.assign({sync:!0},t,a)).sync,s=i&&i.$types,f=!0;if(!s)return i;if(!0===s)return i.$;s.$&&r(s.$)&&(i=i.$,s=s.$,f=!1);var p=[],y=o("",i,null,a);return y=n(y,l)?void 0:y,e(y)?A&&a.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():y:!A&&a.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():A?y:Promise.resolve(y)};this.reviveSync=function(e,t){return b(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!0}))},this.reviveAsync=function(e,t){return b(e,Object.assign({},{throwOnBadSyncType:!0},t,{sync:!1}))},this.register=function(e,t){return t=t||{},[].concat(e).forEach(function e(n){if(M(n))return n.map(e);n&&x(n).forEach(function(e){if("#"===e)throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(o.JSON_TYPES.includes(e))throw new TypeError("Plain JSON object types are reserved as type names");var r=n[e],a=r.testPlainObjects?i:s,c=a.filter(function(t){return t.type===e});if(c.length&&(a.splice(a.indexOf(c[0]),1),delete g[e],delete p[e]),r){if("function"==typeof r){var u=r;r={test:function(e){return e&&e.constructor===u},replace:function(e){return A({},e)},revive:function(e){return A(Object.create(u.prototype),e)}}}else M(r)&&(r={test:r[0],replace:r[1],revive:r[2]});var l={type:e,test:r.test.bind(r)};r.replace&&(l.replace=r.replace.bind(r)),r.replaceAsync&&(l.replaceAsync=r.replaceAsync.bind(r));var f="number"==typeof t.fallback?t.fallback:t.fallback?0:1/0;if(r.testPlainObjects?i.splice(f,0,l):s.splice(f,0,l),r.revive||r.reviveAsync){var y={};r.revive&&(y.revive=r.revive.bind(r)),r.reviveAsync&&(y.reviveAsync=r.reviveAsync.bind(r)),g[e]=y}p[e]=r}})}),this}}function A(e,t){return x(t).map(function(n){e[n]=t[n]}),e}function c(e){return e.replace(/~/g,"~0").replace(/\./g,"~1")}function s(e){return e.replace(/~1/g,".").replace(/~0/g,"~")}function u(e,t){if(""===t)return e;var n=t.indexOf(".");if(n>-1){var r=e[s(t.substr(0,n))];return void 0===r?void 0:u(r,t.substr(n+1))}return e[s(t)]}function l(){}function f(e){this.p=new Promise(e)}function g(e,t,n){if(/^blob:/.test(t)){var r=Be[t];t="data:"+r.type+";base64,"+r[Oe]._buffer.toString("base64")}return Se.call(this,e,t,n)}function p(){this._files=arguments[0],this.length=this._files.length}function y(e,t,n,r){e&&(this.name=e),t&&(this.age=t),n&&(this.dob=n),r&&(this.isMarried=r)}function d(){this.aaa=5}function w(e){this.obj=e,this.nonpersistentStateInfo=Math.random()}function b(e){describe("Error and Errors",function(){it("should get back real Error instances corresponding to their types and with the original name and message",function(){var t=(new o).register(e||[Ye,je]),n=t.stringify({e1:new Error("Error1"),e2:new TypeError("Error2"),e3:new RangeError("Error3"),e4:new SyntaxError("Error4"),e5:new ReferenceError("Error5")}),r=t.parse(n);expect(r.e1).to.be.an.instanceOf(Error),expect(r.e1.name).to.equal("Error"),expect(r.e2).to.be.an.instanceOf(TypeError),expect(r.e2.name).to.equal("TypeError"),expect(r.e3).to.be.an.instanceOf(RangeError),expect(r.e3.name).to.equal("RangeError"),expect(r.e4).to.be.an.instanceOf(SyntaxError),expect(r.e4.name).to.equal("SyntaxError"),expect(r.e5).to.be.an.instanceOf(ReferenceError),expect(r.e5.name).to.equal("ReferenceError")})})}function v(e){describe("Special numbers",function(){it("NaN",function(){var t=(new o).register(e||ke),n=t.stringify(NaN,null,2),r=t.parse(n);expect(r).to.be.NaN}),it("Infinity",function(){var t=(new o).register(e||Ve),n=t.stringify(1/0,null,2),r=t.parse(n);expect(r).to.equal(1/0)}),it("-Infinity",function(){var t=(new o).register(e||Je),n=t.stringify(-1/0,null,2),r=t.parse(n);expect(r).to.equal(-1/0)}),it("should not mistake string forms of the special numbers",function(){var t=(new o).register(e||[ke,Ve,Je]),n=t.stringify("NaN",null,2),r=t.parse(n);expect(r).to.equal("NaN"),n=t.stringify("Infinity",null,2),r=t.parse(n),expect(r).to.equal("Infinity"),n=t.stringify("-Infinity",null,2),r=t.parse(n),expect(r).to.equal("-Infinity")}),it("should not disturb encoding of normal numbers",function(){var t=(new o).register(e||[ke,Ve,Je]),n=t.stringify(512,null,2),r=t.parse(n);expect(r).to.equal(512)})})}function m(e){describe("undefined type",function(){it("should be possible to restore `undefined` properties",function(){var t=(new o).register(e||Ne),n=[void 0,{b:void 0,c:[3,null,,void 0]}],r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(2),expect(i[0]).to.equal(void 0),expect(i[1].b).to.equal(void 0),expect("b"in i[1]).to.be.true,expect(i[1].c[0]).to.equal(3),expect(i[1].c[1]).to.equal(null),expect(i[1].c[3]).to.equal(void 0),expect("0"in i).to.be.true,expect("b"in i[1]).to.be.true,expect("1"in i[1].c).to.be.true,expect("3"in i[1].c).to.be.true,e?(expect(i[1].c[2]).to.equal(void 0),expect("2"in i[1].c).to.be.false):(expect(i[1].c[2]).to.not.equal(void 0),expect(i[1].c[2]).to.equal(null),expect("2"in i[1].c).to.be.true)}),it("should be possible to restore `undefined` at root",function(){var t=(new o).register(e||Ne),n=t.stringify(void 0);expect(n).to.equal('{"$":null,"$types":{"$":{"":"undef"}}}');var r=t.parse(n);expect(r).to.be.undefined})})}function h(e){m(e),describe("Primitive objects",function(){it("String object",function(){var t=(new o).register(e||Fe),n=new String("hello"),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(String),expect(i.valueOf()).to.equal("hello"),expect(i.length).to.equal(5)}),it("Boolean object",function(){var t=(new o).register(e||Fe),n=new Boolean(!0),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Boolean),expect(i.valueOf()).to.equal(!0)}),it("Number object",function(){var t=(new o).register(e||Fe),n=new Number(456),r=t.stringify(n,null,2),i=t.parse(r);expect(i).to.be.an.instanceOf(Number),expect(i.valueOf()).to.equal(456)})}),v(),describe("Date",function(){it("should get back a real Date instance with the original time milliseconds",function(){var t=(new o).register(e||Re),n=t.stringify(new Date(1234567)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.equal(1234567)}),it("should get back a real invalid Date instance",function(){var t=(new o).register(e||Re),n=t.stringify(new Date(NaN)),r=t.parse(n);expect(r).to.be.an.instanceOf(Date),expect(r.getTime()).to.be.NaN})}),b(e),describe("RegExp",function(){it("should return a RegExp",function(){var t=(new o).register(e||[Ge]),n=new RegExp("ab?c","guy"),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof RegExp),expect(i.global).to.equal(!0),expect(i.unicode).to.equal(!0),expect(i.sticky).to.equal(!0),expect(i.ignoreCase).to.equal(!1),expect(i.multiline).to.equal(!1),expect(i.source).to.equal("ab?c"),n=/ab?c/im,r=t.stringify(n,null,2),i=t.parse(r),expect(i instanceof RegExp),expect(i.global).to.equal(!1),expect(i.unicode).to.equal(!1),expect(i.sticky).to.equal(!1),expect(i.ignoreCase).to.equal(!0),expect(i.multiline).to.equal(!0),expect(i.source).to.equal("ab?c")})}),describe("Map",function(){it("should get back a real Map instance with the original data and use complex types also in contained items",function(){var t=(new o).register(e||Ke),n=new Map,r=new Error("Error here"),i=new Date(1e4);n.set(r,i);var a=t.stringify({m:n}),A=t.parse(a);expect(A.m).to.be.an.instanceOf(Map),e&&(expect(Array.from(A.m.keys())[0]).to.be.an.instanceOf(Error),expect(Array.from(A.m.values())[0]).to.be.an.instanceOf(Date))})}),describe("Set",function(){it("should get back a real Set instance with the original data and use complex types also in contained items",function(){var t=(new o).register(e||Pe),n=new Set,r=new Error("Error here"),i=new Date(1e4),a={a:r};n.add(a),n.add(i),n.add("");var A=t.stringify({s:n}),c=t.parse(A);expect(c.s).to.be.an.instanceOf(Set);var s=Array.from(c.s.values());e&&(expect(s[0].a).to.be.an.instanceOf(Error),expect(s[1]).to.be.an.instanceOf(Date)),expect(s[2]).to.be.a("string")})}),describe("ArrayBuffer",function(){it("should return an ArrayBuffer",function(){var t=(new o).register(e||[We]),n=new ArrayBuffer(16),r=t.stringify(n,null,2),i=t.parse(r);expect(i instanceof ArrayBuffer),expect(i.byteLength).to.equal(16)})}),describe("TypedArrays",function(){describe("Float64Array",function(){it("should get back real Float64Array instance with original array content",function(){var t=(new o).register(e||[We,Ue]),n=new Float64Array(3);n[0]=23.8,n[1]=-15,n[2]=99;var r=t.stringify({a:n}),i=t.parse(r);expect(i.a).to.be.an.instanceOf(Float64Array),expect(i.a.length).to.equal(3),expect(i.a[0]).to.equal(23.8),expect(i.a[1]).to.equal(-15),expect(i.a[2]).to.equal(99)})}),describe("Uint16 arrays over invalid unicode range",function(){it("should work to use any 16-bit number no matter whether it is invalid unicode or not",function(){for(var t=(new o).register(e||[We,Ue]),n=new Uint16Array(2304),r=n.length;r--;)n[r]=r+55168;var i=t.stringify({a:n});r=i.length;for(var a=new Uint16Array(r);r--;){var A=i.charCodeAt(r);a[r]=A>=55296&&A<57344?65533:A}i=String.fromCharCode.apply(null,a);var c=t.parse(i);expect(c.a).to.be.an.instanceOf(Uint16Array),expect(c.a.length).to.equal(n.length),c.a.forEach(function(e,t){expect(e).to.equal(t+55168)})})}),describe("Int8 arrays with odd length",function(){it("should be possible to use an odd length of an Int8Array",function(){var t=(new o).register(e||[We,Ue]),n=new Int8Array(3);n[0]=0,n[1]=1,n[2]=2;var r=t.stringify(n),i=t.parse(r);expect(i.length).to.equal(3),expect(i[0]).to.equal(0),expect(i[1]).to.equal(1),expect(i[2]).to.equal(2)})})}),describe("DataView",function(){it("should return a DataView",function(){var t=(new o).register(e||[Ze]),n=new Uint8Array([68,51,34,17,255,238,221,204]).buffer,r=new DataView(n,3,4);expect(r.byteLength).to.equal(4);var i=t.stringify(r,null,2),a=t.parse(i);expect(a).to.be.an.instanceOf(DataView),expect(a.byteLength).to.equal(4)})}),describe("Intl types",function(){it("should return a Intl.Collator",function(){var t=(new o).register(e||[Te]),n={localeMatcher:"lookup",usage:"search",sensitivity:"base",ignorePunctuation:!0,numeric:!0,caseFirst:"upper"},r=JSON.parse(JSON.stringify(n)),i=new Intl.Collator(["en","hi","de-AT","de-DE-u-co-phonebk","en-US-u-kn-true","en-US-u-kf-upper"],n),a=i.resolvedOptions().locale,A=t.stringify(i,null,2),c=t.parse(A);expect(c instanceof Intl.Collator),expect(c.resolvedOptions().locale).to.deep.equal(a),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(c.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.DateTimeFormat",function(){var t=(new o).register(e||[Te]),n={localeMatcher:"lookup",timeZone:"Asia/Shanghai",hour12:!1,formatMatcher:"basic"},r=JSON.parse(JSON.stringify(n)),i=new Intl.DateTimeFormat(["hi","de-AT","de-DE-u-nu-latn","en-US-u-ca-persian"],n),a=t.stringify(i,null,2),A=t.parse(a);expect(A instanceof Intl.DateTimeFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales","formatMatcher","hour12"].includes(e)}).forEach(function(e){expect(A.resolvedOptions()[e]).to.deep.equal(r[e])})}),it("should return a Intl.NumberFormat",function(){var t=(new o).register(e||[Te]),n={localeMatcher:"lookup",style:"currency",currency:"EUR",currencyDisplay:"symbol",useGrouping:!1},r=JSON.parse(JSON.stringify(n)),i=new Intl.NumberFormat(["hi","de-AT","de-DE-u-nu-bali"],n),a=t.stringify(i,null,2),A=t.parse(a);expect(A instanceof Intl.NumberFormat),Object.keys(r).filter(function(e){return!["localeMatcher","locales"].includes(e)}).forEach(function(e){expect(A.resolvedOptions()[e]).to.deep.equal(r[e])})})})}var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,A=e[Symbol.iterator]();!(r=(o=A.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&A.return&&A.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),D=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},x=Object.keys,M=Array.isArray,B={}.toString,E=Object.getPrototypeOf,O={}.hasOwnProperty,S=O.toString;f.prototype.then=function(e,t){var n=this;return new f(function(r,i){n.p.then(function(t){r(e?e(t):t)},function(e){n.p.catch(function(e){return t?t(e):Promise.reject(e)}).then(r,i)})})},f.prototype.catch=function(e){return this.then(null,e)},f.resolve=function(e){return new f(function(t){t(e)})},f.reject=function(e){return new f(function(t,n){n(e)})},["all","race"].map(function(e){f[e]=function(t){return new f(function(n,r){Promise[e](t.map(function(e){return e.p})).then(n,r)})}}),o.Undefined=l,o.Promise=f,o.isThenable=e,o.toStringTag=t,o.hasConstructorOf=n,o.isObject=a,o.isPlainObject=r,o.isUserObject=i,o.escapeKeyPathComponent=c,o.unescapeKeyPathComponent=s,o.getByKeyPath=u,o.getJSONType=function(e){return null===e?"null":M(e)?"array":void 0===e?"undefined":I(e)},o.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=new Uint8Array(256),L=0;L<Q.length;L++)q[Q.charCodeAt(L)]=L;var j=function(e,t,n){for(var r=new Uint8Array(e,t,n),i=r.length,a="",o=0;o<i;o+=3)a+=Q[r[o]>>2],a+=Q[(3&r[o])<<4|r[o+1]>>4],a+=Q[(15&r[o+1])<<2|r[o+2]>>6],a+=Q[63&r[o+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},U=function(e){var t=e.length,n=.75*e.length,r=0,i=void 0,a=void 0,o=void 0,A=void 0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);for(var c=new ArrayBuffer(n),s=new Uint8Array(c),u=0;u<t;u+=4)i=q[e.charCodeAt(u)],a=q[e.charCodeAt(u+1)],o=q[e.charCodeAt(u+2)],A=q[e.charCodeAt(u+3)],s[r++]=i<<2|a>>4,s[r++]=(15&a)<<4|o>>2,s[r++]=(3&o)<<6|63&A;return c},T={arraybuffer:{test:function(e){return"ArrayBuffer"===o.toStringTag(e)},replace:function(e){return j(e)},revive:function(e){return U(e)}}},N={blob:{test:function(e){return"Blob"===o.toStringTag(e)},replace:function(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText}},revive:function(e){var t=e.type,n=e.stringContents;return new Blob([n],{type:t})},replaceAsync:function(e){return new o.Promise(function(t,n){if(e.isClosed)n(new Error("The Blob is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e)}})}}},F={},k={cloneable:{test:function(e){return e&&"object"===(void 0===e?"undefined":I(e))&&"function"==typeof e[Symbol.for("cloneEncapsulate")]},replace:function(e){var t=e[Symbol.for("cloneEncapsulate")](),n=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return F[n]=e,{uuid:n,encapsulated:t}},revive:function(e){var t=e.uuid,n=e.encapsulated;return F[t][Symbol.for("cloneRevive")](n)}}},V={dataview:{test:function(e){return"DataView"===o.toStringTag(e)},replace:function(e){var t=e.buffer,n=e.byteOffset,r=e.byteLength;return{buffer:j(t),byteOffset:n,byteLength:r}},revive:function(e){var t=e.buffer,n=e.byteOffset,r=e.byteLength;return new DataView(U(t),n,r)}}},J={date:{test:function(e){return"Date"===o.toStringTag(e)},replace:function(e){var t=e.getTime();return isNaN(t)?"NaN":t},revive:function(e){return"NaN"===e?new Date(NaN):new Date(e)}}},R={error:{test:function(e){return"Error"===o.toStringTag(e)},replace:function(e){return{name:e.name,message:e.message}},revive:function(e){var t=e.name,n=e.message,r=new Error(n);return r.name=t,r}}},Y="undefined"==typeof self?global:self,G={};["TypeError","RangeError","SyntaxError","ReferenceError","EvalError","URIError","InternalError"].forEach(function(e){var t=Y[e];t&&(G[e.toLowerCase()]={test:function(e){return o.hasConstructorOf(e,t)},replace:function(e){return e.message},revive:function(e){return new t(e)}})});var K={file:{test:function(e){return"File"===o.toStringTag(e)},replace:function(e){var t=new XMLHttpRequest;if(t.open("GET",URL.createObjectURL(e),!1),200!==t.status&&0!==t.status)throw new Error("Bad Blob access: "+t.status);return t.send(),{type:e.type,stringContents:t.responseText,name:e.name,lastModified:e.lastModified}},revive:function(e){var t=e.name,n=e.type,r=e.stringContents,i=e.lastModified;return new File([r],t,{type:n,lastModified:i})},replaceAsync:function(e){return new o.Promise(function(t,n){if(e.isClosed)n(new Error("The File is closed"));else{var r=new FileReader;r.addEventListener("load",function(){t({type:e.type,stringContents:r.result,name:e.name,lastModified:e.lastModified})}),r.addEventListener("error",function(){n(r.error)}),r.readAsText(e)}})}}},P={file:K.file,filelist:{test:function(e){return"FileList"===o.toStringTag(e)},replace:function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e.item(n);return t},revive:function(e){function t(){this._files=arguments[0],this.length=this._files.length}return t.prototype.item=function(e){return this._files[e]},t.prototype[Symbol.toStringTag]="FileList",new t(e)}}},W={imagebitmap:{test:function(e){return"ImageBitmap"===o.toStringTag(e)||e&&e.dataset&&"ImageBitmap"===e.dataset.toStringTag},replace:function(e){var t=document.createElement("canvas");return t.getContext("2d").drawImage(e,0,0),t.toDataURL()},revive:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,t},reviveAsync:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=document.createElement("img");return r.onload=function(){n.drawImage(r,0,0)},r.src=e,createImageBitmap(t)}}},Z={imagedata:{test:function(e){return"ImageData"===o.toStringTag(e)},replace:function(e){return{array:Array.from(e.data),width:e.width,height:e.height}},revive:function(e){return new ImageData(new Uint8ClampedArray(e.array),e.width,e.height)}}},z={infinity:{test:function(e){return e===1/0},replace:function(e){return"Infinity"},revive:function(e){return 1/0}}},H={IntlCollator:{test:function(e){return o.hasConstructorOf(e,Intl.Collator)},replace:function(e){return e.resolvedOptions()},revive:function(e){return new Intl.Collator(e.locale,e)}},IntlDateTimeFormat:{test:function(e){return o.hasConstructorOf(e,Intl.DateTimeFormat)},replace:function(e){return e.resolvedOptions()},revive:function(e){return new Intl.DateTimeFormat(e.locale,e)}},IntlNumberFormat:{test:function(e){return o.hasConstructorOf(e,Intl.NumberFormat)},replace:function(e){return e.resolvedOptions()},revive:function(e){return new Intl.NumberFormat(e.locale,e)}}},$={map:{test:function(e){return"Map"===o.toStringTag(e)},replace:function(e){return Array.from(e.entries())},revive:function(e){return new Map(e)}}},_={nan:{test:function(e){return"number"==typeof e&&isNaN(e)},replace:function(e){return"NaN"},revive:function(e){return NaN}}},X={negativeInfinity:{test:function(e){return e===-1/0},replace:function(e){return"-Infinity"},revive:function(e){return-1/0}}},ee={nonbuiltinIgnore:{test:function(e){return e&&"object"===(void 0===e?"undefined":I(e))&&!Array.isArray(e)&&!["Object","Boolean","Number","String","Error","RegExp","Math","Date","Map","Set","JSON","ArrayBuffer","SharedArrayBuffer","DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","Promise","String Iterator","Array Iterator","Map Iterator","Set Iterator","WeakMap","WeakSet","Atomics","Module"].includes(o.toStringTag(e))},replace:function(e){}}},te={StringObject:{test:function(e){return"String"===o.toStringTag(e)&&"object"===(void 0===e?"undefined":I(e))},replace:function(e){return String(e)},revive:function(e){return new String(e)}},BooleanObject:{test:function(e){return"Boolean"===o.toStringTag(e)&&"object"===(void 0===e?"undefined":I(e))},replace:function(e){return Boolean(e)},revive:function(e){return new Boolean(e)}},NumberObject:{test:function(e){return"Number"===o.toStringTag(e)&&"object"===(void 0===e?"undefined":I(e))},replace:function(e){return Number(e)},revive:function(e){return new Number(e)}}},ne={regexp:{test:function(e){return"RegExp"===o.toStringTag(e)},replace:function(e){return{source:e.source,flags:(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":"")+(e.unicode?"u":"")}},revive:function(e){var t=e.source,n=e.flags;return new RegExp(t,n)}}},re={},ie={resurrectable:{test:function(e){return e&&!Array.isArray(e)&&["object","function","symbol"].includes(void 0===e?"undefined":I(e))},replace:function(e){var t=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})}();return re[t]=e,t},revive:function(e){return re[e]}}},ae={set:{test:function(e){return"Set"===o.toStringTag(e)},replace:function(e){return Array.from(e.values())},revive:function(e){return new Set(e)}}},oe="undefined"==typeof self?global:self,Ae={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=oe[e];n&&(Ae[e.toLowerCase()]={test:function(e){return o.toStringTag(e)===t},replace:function(e){return(0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e:e.slice(0)).buffer},revive:function(e){return"ArrayBuffer"===o.toStringTag(e)?new n(e):e}})});var ce="undefined"==typeof self?global:self,se={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(e){var t=e,n=ce[t];n&&(se[e.toLowerCase()]={test:function(e){return o.toStringTag(e)===t},replace:function(e){return j(e.buffer,e.byteOffset,e.byteLength)},revive:function(e){return new n(U(e))}})});var ue={undef:{test:function(e,t){return void 0===e&&(t.ownKeys||!("ownKeys"in t))},replace:function(e){return null},revive:function(e){return new o.Undefined}}},le={userObject:{test:function(e,t){return o.isUserObject(e)},replace:function(e){return Object.assign({},e)},revive:function(e){return e}}},fe=[{sparseArrays:{testPlainObjects:!0,test:function(e){return Array.isArray(e)},replace:function(e,t){return t.iterateUnsetNumeric=!0,e}}},{sparseUndefined:{test:function(e,t){return void 0===e&&!1===t.ownKeys},replace:function(e){return null},revive:function(e){}}}],ge=[fe,ue],pe=[_,z,X],ye=[ge,te,pe,J,R,G,ne].concat("function"==typeof Map?$:[],"function"==typeof Set?ae:[],"function"==typeof ArrayBuffer?T:[],"function"==typeof Uint8Array?se:[],"function"==typeof DataView?V:[],"undefined"!=typeof Intl?H:[]),de=[R,G],we=[ye,{ArrayBuffer:null},Ae],be=[le,ge,te,pe,J,ne,Z,W,K,P,N].concat("function"==typeof Map?$:[],"function"==typeof Set?ae:[],"function"==typeof ArrayBuffer?T:[],"function"==typeof Uint8Array?se:[],"function"==typeof DataView?V:[],"undefined"!=typeof Intl?H:[]),ve=be.concat({checkDataCloneException:[function(e){var t={}.toString.call(e).slice(8,-1);if(["symbol","function"].includes(void 0===e?"undefined":I(e))||["Arguments","Module","Error","Promise","WeakMap","WeakSet"].includes(t)||e===Object.prototype||("Blob"===t||"File"===t)&&e.isClosed||e&&"object"===(void 0===e?"undefined":I(e))&&"number"==typeof e.nodeType&&"function"==typeof e.insertBefore)throw new DOMException("The object cannot be cloned.","DataCloneError");return!1}]}),me=[ye];o.types={arraybuffer:T,blob:N,cloneable:k,dataview:V,date:J,error:R,errors:G,file:K,filelist:P,imagebitmap:W,imagedata:Z,infinity:z,intlTypes:H,map:$,nan:_,negativeInfinity:X,nonbuiltinIgnore:ee,primitiveObjects:te,regexp:ne,resurrectable:ie,set:ae,typedArraysSocketio:Ae,typedArrays:se,undef:ue,userObject:le},o.presets={builtin:ye,postMessage:de,socketio:we,sparseUndefined:fe,specialNumbers:pe,structuredCloningThrowing:ve,structuredCloning:be,undef:ge,universal:me};var he="undefined"!=typeof module,Ie=he&&require("uuid/v4"),Ce=he&&require("whatwg-url")||{},De=he&&require("jsdom/lib/jsdom/living/generated/utils")||{},xe=Ce.serializeURLOrigin,Me=Ce.parseURL,Be={},Ee=function(e){var t="blob:"+xe(Me(location.href))+"/"+Ie();return Be[t]=e,t},Oe=De.implSymbol,Se=XMLHttpRequest.prototype.open;URL.createObjectURL||(URL.createObjectURL=Ee,XMLHttpRequest.prototype.open=g),mocha.setup({ui:"bdd",timeout:5e3});var Qe="undefined"!=typeof module?global:window;p.prototype.item=function(e){return this._files[e]},p.prototype[Symbol.toStringTag]="FileList",Object.defineProperty(Qe.HTMLInputElement.prototype,"files",{get:function(){return new p(this._files)},set:function(e){this._files=e}}),Qe.FileList=p,Qe.expect=chai.expect,Qe.assert=chai.assert,y.prototype.name="",y.prototype.age=0,y.prototype.dob=new Date(1900,0,1),y.prototype.isMarried=!1,d.prototype.bbb=8,d.prototype[Symbol.toStringTag]="SimulatedNonBuiltIn",w.prototype[Symbol.for("cloneEncapsulate")]=function(){return{obj:JSON.stringify(this.obj)}},w.prototype[Symbol.for("cloneRevive")]=function(e){return new w(JSON.parse(e.obj))},w.prototype.prototypeProperty=10;var qe={Person:y,SimulatedNonBuiltIn:d,MyCloneable:w,MyResurrectable:function(){}},Le=o.types,je=Le.errors,Ue=Le.typedArrays,Te=Le.intlTypes,Ne=Le.undef,Fe=Le.primitiveObjects,ke=Le.nan,Ve=Le.infinity,Je=Le.negativeInfinity,Re=Le.date,Ye=Le.error,Ge=Le.regexp,Ke=Le.map,Pe=Le.set,We=Le.arraybuffer,Ze=Le.dataview,ze=Le.imagedata,He=Le.imagebitmap,$e=Le.blob,_e=Le.file,Xe=Le.filelist,et=Le.nonbuiltinIgnore,tt=Le.userObject,nt=Le.cloneable,rt=Le.resurrectable,at=o.presets,ot=at.builtin,At=at.universal,ct=at.structuredCloningThrowing,st=at.structuredCloning,ut=at.specialNumbers,lt=at.postMessage,ft=at.undef,gt=at.sparseUndefined;describe("Built-in",h),describe("ImageData",function(){it("should get back an ImageData instance with the original data",function(){var e=(new o).register(ze),t=new ImageData(1,3),n=e.stringify(t),r=e.parse(n);expect(r.width).to.equal(1),expect(r.height).to.equal(3),expect(r.data).to.deep.equal(new Uint8ClampedArray(12))})}),describe("ImageBitmap",function(){it("should get back an ImageBitmap instance with the original data",function(e){var t=(new o).register(He),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parse(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"}),it("should get back an ImageBitmap instance with the original data asynchronously",function(e){var t=(new o).register(He),n=document.createElement("canvas"),r=n.getContext("2d"),i=document.createElement("img");i.onload=function(){r.drawImage(i,0,0),createImageBitmap(n).then(function(e){var n=t.stringify(e);return t.parseAsync(n)}).then(function(t){expect(t.width).to.equal(300),expect(t.height).to.equal(150);var n=document.createElement("canvas");n.getContext("2d").drawImage(t,0,0);try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg==")}catch(e){try{expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC")}catch(e){expect(n.toDataURL()).to.equal("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=")}}e()})},i.src="undefined"!=typeof imageTestFileNode?imageTestFileNode:"../test/Flag_of_the_United_Nations.png"})}),describe("Blob",function(){it("should get back a Blob instance with the original data",function(e){this.timeout(1e4);var t=(new o).register($e),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"}),i=t.stringify(r),a=t.parse(i);expect(a.type).to.equal("application/json"),expect("name"in a).to.be.false,expect("lastModified"in a).to.be.false;var A=new FileReader;A.addEventListener("load",function(){expect(A.result).to.equal(n),e()}),A.addEventListener("error",function(){assert(!1,"FileReader should not err")}),A.readAsText(a)}),it("should get back a Blob instance with the original data asynchronously",function(e){var t=(new o).register($e),n=JSON.stringify("abcሴ"),r=new Blob([n],{type:"application/json"});t.stringifyAsync(r).then(function(r){var i=t.parse(r);expect(i.type).to.equal("application/json"),expect("name"in i).to.be.false,expect("lastModified"in i).to.be.false;var a=new FileReader;a.addEventListener("load",function(){expect(a.result).to.equal(n),e()}),a.addEventListener("error",function(){assert(!1,"FileReader should not err")}),a.readAsText(i)})})}),describe("File",function(){this.timeout(1e4),it("should get back a File instance with the original data",function(e){var t=(new o).register(_e),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n}),a=t.stringify(i),A=t.parse(a);expect(A.lastModified).to.equal(n.getTime()),expect(A.type).to.equal("application/json"),expect(A.name).to.equal("aName");var c=new FileReader;c.addEventListener("load",function(){expect(c.result).to.equal(r),e()}),c.addEventListener("error",function(){assert(!1,"FileReader should not err")}),c.readAsText(A)}),it("should get back a File instance with the original data asynchronously",function(e){var t=(new o).register(_e),n=new Date,r=JSON.stringify("abcሴ"),i=new File([r],"aName",{type:"application/json",lastModified:n});t.stringifyAsync(i).then(function(i){var a=t.parse(i);expect(a.lastModified).to.equal(n.getTime()),expect(a.type).to.equal("application/json"),expect(a.name).to.equal("aName");var o=new FileReader;o.addEventListener("load",function(){expect(o.result).to.equal(r),e()}),o.addEventListener("error",function(){assert(!1,"FileReader should not err")}),o.readAsText(a)})})}),describe("FileList",function(){this.timeout(1e4),it("should get back a FileList instance with the original data",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new o).register(Xe),i=r.stringify(n.files),a=r.parse(i);expect(a.item(0)).to.be.an.instanceOf(File),expect(a.item(0).lastModified).to.equal(e.getTime()),expect(a.item(0).type).to.equal("text/plain"),expect(a.item(0).name).to.equal("abc"),expect(a.item(1)).to.be.an.instanceOf(File),expect(a.item(1).lastModified).to.equal(t.getTime()),expect(a.item(1).type).to.equal("text/html"),expect(a.item(1).name).to.equal("def")}),it("should get back a FileList instance with the original data asynchronously",function(){var e=new Date,t=new Date("1985"),n=document.createElement("input");n.type="file",n.files=[new File(["content1"],"abc",{type:"text/plain",lastModified:e}),new File(["content2"],"def",{type:"text/html",lastModified:t})],expect(n.files).to.be.an.instanceOf(FileList);var r=(new o).register(Xe);r.stringifyAsync(n.files).then(function(n){var i=r.parse(n);expect(i.item(0)).to.be.an.instanceOf(File),expect(i.item(0).lastModified).to.equal(e.getTime()),expect(i.item(0).type).to.equal("text/plain"),expect(i.item(0).name).to.equal("abc"),expect(i.item(1)).to.be.an.instanceOf(File),expect(i.item(1).lastModified).to.equal(t.getTime()),expect(i.item(1).type).to.equal("text/html"),expect(i.item(1).name).to.equal("def")})})}),describe("Non-built-in object ignoring",function(){it("should ignore non-built-in objects (simulated)",function(){var e=(new o).register(et),t=new qe.Person("John Doe"),n=new qe.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"John Doe"}});var a=e.encapsulate(["a",n,5,null]);expect("0"in a).to.be.true,expect("1"in a).to.be.false,expect("2"in a).to.be.true,expect("3"in a).to.be.true})}),describe("User objects",function(){it("should do recursive type checking on user instantiated objects",function(){var e=(new o).register([tt,Re]),t=new qe.Person("Bob Smith",30,new Date(2e3,5,20),!0),n=new qe.SimulatedNonBuiltIn;n.prop=500;var r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,dob:new Date(2e3,5,20),isMarried:!0},b:{aaa:5,prop:500}}),expect("dob"in i.a).to.be.true}),it("should work with nonbuiltin-ignore",function(){var e=(new o).register([tt,et]),t=new qe.Person("Bob Smith",30,new Date(2e3,5,20),!0);t.nonbuiltin=new qe.SimulatedNonBuiltIn;var n=new qe.SimulatedNonBuiltIn,r=e.stringify({a:t,b:n}),i=e.parse(r);expect(i).to.deep.equal({a:{name:"Bob Smith",age:30,isMarried:!0,dob:new Date(2e3,5,20).toJSON()}}),expect("nonbuiltin"in i.a).to.be.false})}),describe("Cloneables",function(){it("Should work with custom cloneable objects",function(){var e=(new o).register(nt),t={a:1,b:2},n=new qe.MyCloneable(t),r=n.nonpersistentStateInfo,i=e.encapsulate(n);expect(n[Symbol.for("cloneEncapsulate")]()).to.deep.equal({obj:JSON.stringify(t)}),expect("nonpersistentStateInfo"in i).to.be.false,expect("prototypeProperty"in i).to.be.false;var a=JSON.stringify(i),A=e.parse(a);expect(A).to.be.an.instanceOf(qe.MyCloneable),expect(A).to.not.equal(n),expect(A.obj).to.deep.equal(t),expect(A.hasOwnProperty("nonpersistentStateInfo")).to.be.true,expect(A.nonpersistentStateInfo).to.not.equal(r),expect("prototypeProperty"in A).to.be.true,expect(A.hasOwnProperty("prototypeProperty")).to.be.false})}),describe("Resurrectables",function(){it("Should work with custom resurrectable objects",function(){var e=(new o).register(rt),t=new qe.MyResurrectable,n=function(){},r=Symbol("resurrectable"),i={},a=[3,4,5],A=e.encapsulate([t,n,r,i,a]),c=JSON.stringify(A),s=e.parse(c);expect(s[0]).to.equal(t),expect(s[1]).to.equal(n),expect(s[2]).to.equal(r),expect(s[3]).to.not.equal(i),expect(s[4]).to.not.equal(a)})}),describe("Presets",function(){describe("Built-in (as preset)",function(){h([ot])}),describe("postMessage",function(){b([lt])}),describe("Universal",function(){h([At])}),describe("Structured cloning",function(){it("should work with Structured cloning with throwing",function(){var e=(new o).register([ct]),t=!1;try{e.stringify(new Error("test"))}catch(e){t=!0}assert(t,"Caught error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should work with Structured cloning without throwing",function(){var e=(new o).register([st]),t=!1;try{e.stringify(new Error("test"))}catch(e){console.log(e),t=!0}assert(!t,"Did not catch error");var n=e.stringify(new Date(123456789e4));expect(n).to.deep.equal('{"$":1234567890000,"$types":{"$":{"":"date"}}}')}),it("should allow recursive type checking on user instantiated objects",function(){var e=(new o).register([st]),t=new qe.Person("John Doe"),n=new qe.Person("Bob Smith",30,new Date(2e3,5,20),!0),r=e.parse(e.stringify([t,n]));expect(r).to.have.same.deep.members([{name:"John Doe"},{name:"Bob Smith",dob:new Date(2e3,5,20),age:30,isMarried:!0}])})}),describe("Special Numbers (as preset)",function(){v([ut])}),describe("Undefined (as preset)",function(){m([ft])}),describe("Sparse undefined",function(){it("should be possible to restore `undefined` properties",function(){var e=(new o).register([gt]),t=[void 0,{b:void 0,c:[3,null,,void 0]}],n=e.stringify(t),r=e.parse(n);expect(r.length).to.equal(2),expect(r[0]).to.equal(null),expect("b"in r[1]).to.be.false,expect(r[1].c[0]).to.equal(3),expect(r[1].c[1]).to.equal(null),expect(r[1].c[2]).to.equal(void 0),expect("2"in r[1].c).to.be.false,expect(r[1].c[3]).to.equal(null)})})}),mocha.run()});
//# sourceMappingURL=test-polyglot.js.map
