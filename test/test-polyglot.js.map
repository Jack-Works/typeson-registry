{"version":3,"file":"test-polyglot.js","sources":["../node_modules/typeson/typeson.js","../node_modules/base64-arraybuffer-es6/src/base64-arraybuffer.js","../types/arraybuffer.js","../utils/stringArrayBuffer.js","../types/blob.js","../types/cloneable.js","../types/dataview.js","../types/date.js","../types/error.js","../types/errors.js","../types/file.js","../types/filelist.js","../types/imagebitmap.js","../types/imagedata.js","../types/infinity.js","../types/intl-types.js","../types/map.js","../types/nan.js","../types/negative-infinity.js","../types/nonbuiltin-ignore.js","../types/primitive-objects.js","../types/regexp.js","../types/resurrectable.js","../types/set.js","../types/typed-arrays-socketio.js","../types/typed-arrays.js","../types/undef.js","../types/user-object.js","../presets/sparse-undefined.js","../presets/undef.js","../presets/builtin.js","../presets/post-message.js","../presets/socketio.js","../presets/structured-cloning.js","../presets/structured-cloning-throwing.js","../presets/universal.js","../index.js","../polyfills/createObjectURL.js","test-environment.js","test-utils.js","test.js"],"sourcesContent":["const keys = Object.keys,\n    isArray = Array.isArray,\n    toString = ({}.toString),\n    getProto = Object.getPrototypeOf,\n    hasOwn = ({}.hasOwnProperty),\n    fnToString = hasOwn.toString,\n    internalStateObjPropsToIgnore = ['type', 'replaced', 'iterateIn', 'iterateUnsetNumeric'];\n\nfunction isThenable (v, catchCheck) {\n    return Typeson.isObject(v) && typeof v.then === 'function' && (!catchCheck || typeof v.catch === 'function');\n}\n\nfunction toStringTag (val) {\n    return toString.call(val).slice(8, -1);\n}\n\n// This function is dependent on both constructors\n//   being identical so any minimization is expected of both\nfunction hasConstructorOf (a, b) {\n    if (!a || typeof a !== 'object') {\n        return false;\n    }\n    const proto = getProto(a);\n    if (!proto) {\n        return false;\n    }\n    const Ctor = hasOwn.call(proto, 'constructor') && proto.constructor;\n    if (typeof Ctor !== 'function') {\n        return b === null;\n    }\n    return typeof Ctor === 'function' && b !== null && fnToString.call(Ctor) === fnToString.call(b);\n}\n\nfunction isPlainObject (val) { // Mirrors jQuery's\n    if (!val || toStringTag(val) !== 'Object') {\n        return false;\n    }\n\n    const proto = getProto(val);\n    if (!proto) { // `Object.create(null)`\n        return true;\n    }\n\n    return hasConstructorOf(val, Object);\n}\n\nfunction isUserObject (val) {\n    if (!val || toStringTag(val) !== 'Object') {\n        return false;\n    }\n\n    const proto = getProto(val);\n    if (!proto) { // `Object.create(null)`\n        return true;\n    }\n    return hasConstructorOf(val, Object) || isUserObject(proto);\n}\n\nfunction isObject (v) {\n    return v && typeof v === 'object';\n}\n\n/* Typeson - JSON with types\n    * License: The MIT License (MIT)\n    * Copyright (c) 2016 David Fahlander\n    */\n\n/** An instance of this class can be used to call stringify() and parse().\n * Typeson resolves cyclic references by default. Can also be extended to\n * support custom types using the register() method.\n *\n * @constructor\n * @param {{cyclic: boolean}} [options] - if cyclic (default true), cyclic references will be handled gracefully.\n */\nfunction Typeson (options) {\n    // Replacers signature: replace (value). Returns falsy if not replacing. Otherwise ['Date', value.getTime()]\n    const plainObjectReplacers = [];\n    const nonplainObjectReplacers = [];\n    // Revivers: map {type => reviver}. Sample: {'Date': value => new Date(value)}\n    const revivers = {};\n\n    /** Types registered via register() */\n    const regTypes = this.types = {};\n\n    /** Serialize given object to Typeson.\n     *\n     * Arguments works identical to those of JSON.stringify().\n     */\n    const stringify = this.stringify = function (obj, replacer, space, opts) { // replacer here has nothing to do with our replacers.\n        opts = Object.assign({}, options, opts, {stringification: true});\n        const encapsulated = encapsulate(obj, null, opts);\n        if (isArray(encapsulated)) {\n            return JSON.stringify(encapsulated[0], replacer, space);\n        }\n        return encapsulated.then((res) => {\n            return JSON.stringify(res, replacer, space);\n        });\n    };\n\n    // Also sync but throws on non-sync result\n    this.stringifySync = function (obj, replacer, space, opts) {\n        return stringify(obj, replacer, space, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: true}));\n    };\n    this.stringifyAsync = function (obj, replacer, space, opts) {\n        return stringify(obj, replacer, space, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: false}));\n    };\n\n    /** Parse Typeson back into an obejct.\n     *\n     * Arguments works identical to those of JSON.parse().\n     */\n    const parse = this.parse = function (text, reviver, opts) {\n        opts = Object.assign({}, options, opts, {parse: true});\n        return revive(JSON.parse(text, reviver), opts); // This reviver has nothing to do with our revivers.\n    };\n\n    // Also sync but throws on non-sync result\n    this.parseSync = function (text, reviver, opts) {\n        return parse(text, reviver, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: true})); // This reviver has nothing to do with our revivers.\n    };\n    this.parseAsync = function (text, reviver, opts) {\n        return parse(text, reviver, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: false})); // This reviver has nothing to do with our revivers.\n    };\n\n    this.specialTypeNames = function (obj, stateObj, opts = {}) {\n        opts.returnTypeNames = true;\n        return this.encapsulate(obj, stateObj, opts);\n    };\n    this.rootTypeName = function (obj, stateObj, opts = {}) {\n        opts.iterateNone = true;\n        return this.encapsulate(obj, stateObj, opts);\n    };\n\n    /** Encapsulate a complex object into a plain Object by replacing registered types with\n     * plain objects representing the types data.\n     *\n     * This method is used internally by Typeson.stringify().\n     * @param {Object} obj - Object to encapsulate.\n     */\n    const encapsulate = this.encapsulate = function (obj, stateObj, opts) {\n        opts = Object.assign({sync: true}, options, opts);\n        const sync = opts.sync;\n        const types = {},\n            refObjs = [], // For checking cyclic references\n            refKeys = [], // For checking cyclic references\n            promisesDataRoot = [];\n        // Clone the object deeply while at the same time replacing any special types or cyclic reference:\n        const cyclic = opts && ('cyclic' in opts) ? opts.cyclic : true;\n        const encapsulateObserver = opts.encapsulateObserver;\n        const ret = _encapsulate('', obj, cyclic, stateObj || {}, promisesDataRoot);\n        function finish (ret) {\n            // Add $types to result only if we ever bumped into a special type (or special case where object has own `$types`)\n            const typeNames = Object.values(types);\n            if (opts.iterateNone) {\n                if (typeNames.length) {\n                    return typeNames[0];\n                }\n                return Typeson.getJSONType(ret);\n            }\n            if (typeNames.length) {\n                if (opts.returnTypeNames) {\n                    return [...new Set(typeNames)];\n                }\n                if (!ret || !isPlainObject(ret) || // Special if array (or a primitive) was serialized because JSON would ignore custom `$types` prop on it\n                    ret.hasOwnProperty('$types') // Also need to handle if this is an object with its own `$types` property (to avoid ambiguity)\n                ) {\n                    ret = {$: ret, $types: {$: types}};\n                } else {\n                    ret.$types = types;\n                }\n            } else if (isObject(ret) && ret.hasOwnProperty('$types')) { // No special types\n                ret = {$: ret, $types: true};\n            }\n            if (opts.returnTypeNames) {\n                return false;\n            }\n            return ret;\n        }\n        function checkPromises (ret, promisesData) {\n            return Promise.all(\n                promisesData.map((pd) => { return pd[1].p; })\n            ).then(function (promResults) {\n                return Promise.all(\n                    promResults.map(function (promResult) {\n                        const newPromisesData = [];\n                        const prData = promisesData.splice(0, 1)[0];\n                        const [keyPath, , cyclic, stateObj, parentObj, key, detectedType] = prData;\n\n                        const encaps = _encapsulate(keyPath, promResult, cyclic, stateObj, newPromisesData, true, detectedType);\n                        const isTypesonPromise = hasConstructorOf(encaps, TypesonPromise);\n                        if (keyPath && isTypesonPromise) { // Handle case where an embedded custom type itself returns a `Typeson.Promise`\n                            return encaps.p.then(function (encaps2) {\n                                parentObj[key] = encaps2;\n                                return checkPromises(ret, newPromisesData);\n                            });\n                        }\n                        if (keyPath) parentObj[key] = encaps;\n                        else if (isTypesonPromise) {\n                            ret = encaps.p;\n                        } else ret = encaps; // If this is itself a `Typeson.Promise` (because the original value supplied was a promise or because the supplied custom type value resolved to one), returning it below will be fine since a promise is expected anyways given current config (and if not a promise, it will be ready as the resolve value)\n                        return checkPromises(ret, newPromisesData);\n                    })\n                );\n            }).then(() => ret);\n        };\n        return promisesDataRoot.length\n            ? sync && opts.throwOnBadSyncType\n                ? (() => {\n                    throw new TypeError('Sync method requested but async result obtained');\n                })()\n                : Promise.resolve(checkPromises(ret, promisesDataRoot)).then(finish)\n            : !sync && opts.throwOnBadSyncType\n                ? (() => {\n                    throw new TypeError('Async method requested but sync result obtained');\n                })()\n                : (opts.stringification && sync // If this is a synchronous request for stringification, yet a promise is the result, we don't want to resolve leading to an async result, so we return an array to avoid ambiguity\n                    ? [finish(ret)]\n                    : (sync\n                        ? finish(ret)\n                        : Promise.resolve(finish(ret))\n                    ));\n\n        function _adaptBuiltinStateObjectProperties (stateObj, ownKeysObj, cb) {\n            Object.assign(stateObj, ownKeysObj);\n            const vals = internalStateObjPropsToIgnore.map((prop) => {\n                const tmp = stateObj[prop];\n                delete stateObj[prop];\n                return tmp;\n            });\n            cb();\n            internalStateObjPropsToIgnore.forEach((prop, i) => {\n                stateObj[prop] = vals[i];\n            });\n        }\n        function _encapsulate (keypath, value, cyclic, stateObj, promisesData, resolvingTypesonPromise, detectedType) {\n            let ret;\n            let observerData = {};\n            const $typeof = typeof value;\n            const runObserver = encapsulateObserver ? function (obj) {\n                const type = detectedType || stateObj.type || (\n                    Typeson.getJSONType(value)\n                );\n                encapsulateObserver(Object.assign(obj || observerData, {\n                    keypath,\n                    value,\n                    cyclic,\n                    stateObj,\n                    promisesData,\n                    resolvingTypesonPromise,\n                    awaitingTypesonPromise: hasConstructorOf(value, TypesonPromise)\n                }, type !== undefined ? {type} : {}));\n            } : null;\n            if ($typeof in {string: 1, boolean: 1, number: 1, undefined: 1}) {\n                if (value === undefined || ($typeof === 'number' &&\n                    (isNaN(value) || value === -Infinity || value === Infinity))) {\n                    ret = replace(keypath, value, stateObj, promisesData, false, resolvingTypesonPromise, runObserver);\n                    if (ret !== value) {\n                        observerData = {replaced: ret};\n                    }\n                } else {\n                    ret = value;\n                }\n                if (runObserver) runObserver();\n                return ret;\n            }\n            if (value === null) {\n                if (runObserver) runObserver();\n                return value;\n            }\n            if (cyclic && !stateObj.iterateIn && !stateObj.iterateUnsetNumeric) {\n                // Options set to detect cyclic references and be able to rewrite them.\n                const refIndex = refObjs.indexOf(value);\n                if (refIndex < 0) {\n                    if (cyclic === true) {\n                        refObjs.push(value);\n                        refKeys.push(keypath);\n                    }\n                } else {\n                    types[keypath] = '#';\n                    if (runObserver) {\n                        runObserver({\n                            cyclicKeypath: refKeys[refIndex]\n                        });\n                    }\n                    return '#' + refKeys[refIndex];\n                }\n            }\n            const isPlainObj = isPlainObject(value);\n            const isArr = isArray(value);\n            const replaced = (\n                ((isPlainObj || isArr) && (!plainObjectReplacers.length || stateObj.replaced)) ||\n                stateObj.iterateIn // Running replace will cause infinite loop as will test positive again\n            )\n                // Optimization: if plain object and no plain-object replacers, don't try finding a replacer\n                ? value\n                : replace(keypath, value, stateObj, promisesData, isPlainObj || isArr, null, runObserver);\n            let clone;\n            if (replaced !== value) {\n                ret = replaced;\n                observerData = {replaced: replaced};\n            } else {\n                if (isArr || stateObj.iterateIn === 'array') {\n                    clone = new Array(value.length);\n                    observerData = {clone: clone};\n                } else if (isPlainObj || stateObj.iterateIn === 'object') {\n                    clone = {};\n                    observerData = {clone: clone};\n                } else if (keypath === '' && hasConstructorOf(value, TypesonPromise)) {\n                    promisesData.push([keypath, value, cyclic, stateObj, undefined, undefined, stateObj.type]);\n                    ret = value;\n                } else {\n                    ret = value; // Only clone vanilla objects and arrays\n                }\n            }\n            if (runObserver) runObserver();\n\n            if (opts.iterateNone) {\n                return clone || ret;\n            }\n\n            if (!clone) {\n                return ret;\n            }\n\n            // Iterate object or array\n            if (stateObj.iterateIn) {\n                for (const key in value) {\n                    const ownKeysObj = {ownKeys: value.hasOwnProperty(key)};\n                    _adaptBuiltinStateObjectProperties(stateObj, ownKeysObj, () => {\n                        const kp = keypath + (keypath ? '.' : '') + escapeKeyPathComponent(key);\n                        const val = _encapsulate(kp, value[key], !!cyclic, stateObj, promisesData, resolvingTypesonPromise);\n                        if (hasConstructorOf(val, TypesonPromise)) {\n                            promisesData.push([kp, val, !!cyclic, stateObj, clone, key, stateObj.type]);\n                        } else if (val !== undefined) clone[key] = val;\n                    });\n                }\n                if (runObserver) runObserver({endIterateIn: true, end: true});\n            } else { // Note: Non-indexes on arrays won't survive stringify so somewhat wasteful for arrays, but so too is iterating all numeric indexes on sparse arrays when not wanted or filtering own keys for positive integers\n                keys(value).forEach(function (key) {\n                    const kp = keypath + (keypath ? '.' : '') + escapeKeyPathComponent(key);\n                    const ownKeysObj = {ownKeys: true};\n                    _adaptBuiltinStateObjectProperties(stateObj, ownKeysObj, () => {\n                        const val = _encapsulate(kp, value[key], !!cyclic, stateObj, promisesData, resolvingTypesonPromise);\n                        if (hasConstructorOf(val, TypesonPromise)) {\n                            promisesData.push([kp, val, !!cyclic, stateObj, clone, key, stateObj.type]);\n                        } else if (val !== undefined) clone[key] = val;\n                    });\n                });\n                if (runObserver) runObserver({endIterateOwn: true, end: true});\n            }\n            // Iterate array for non-own numeric properties (we can't replace the prior loop though as it iterates non-integer keys)\n            if (stateObj.iterateUnsetNumeric) {\n                const vl = value.length;\n                for (let i = 0; i < vl; i++) {\n                    if (!(i in value)) {\n                        const kp = keypath + (keypath ? '.' : '') + i; // No need to escape numeric\n                        const ownKeysObj = {ownKeys: false};\n                        _adaptBuiltinStateObjectProperties(stateObj, ownKeysObj, () => {\n                            const val = _encapsulate(kp, undefined, !!cyclic, stateObj, promisesData, resolvingTypesonPromise);\n                            if (hasConstructorOf(val, TypesonPromise)) {\n                                promisesData.push([kp, val, !!cyclic, stateObj, clone, i, stateObj.type]);\n                            } else if (val !== undefined) clone[i] = val;\n                        });\n                    }\n                }\n                if (runObserver) runObserver({endIterateUnsetNumeric: true, end: true});\n            }\n            return clone;\n        }\n\n        function replace (keypath, value, stateObj, promisesData, plainObject, resolvingTypesonPromise, runObserver) {\n            // Encapsulate registered types\n            const replacers = plainObject ? plainObjectReplacers : nonplainObjectReplacers;\n            let i = replacers.length;\n            while (i--) {\n                const replacer = replacers[i];\n                if (replacer.test(value, stateObj)) {\n                    const type = replacer.type;\n                    if (revivers[type]) {\n                        // Record the type only if a corresponding reviver exists.\n                        // This is to support specs where only replacement is done.\n                        // For example ensuring deep cloning of the object, or\n                        // replacing a type to its equivalent without the need to revive it.\n                        const existing = types[keypath];\n                        // type can comprise an array of types (see test shouldSupportIntermediateTypes)\n                        types[keypath] = existing ? [type].concat(existing) : type;\n                    }\n                    // Now, also traverse the result in case it contains its own types to replace\n                    Object.assign(stateObj, {type, replaced: true});\n                    if ((sync || !replacer.replaceAsync) && !replacer.replace) {\n                        if (runObserver) runObserver({typeDetected: true});\n                        return _encapsulate(keypath, value, cyclic && 'readonly', stateObj, promisesData, resolvingTypesonPromise, type);\n                    }\n                    if (runObserver) runObserver({replacing: true});\n\n                    const replaceMethod = sync || !replacer.replaceAsync ? 'replace' : 'replaceAsync';\n                    return _encapsulate(keypath, replacer[replaceMethod](value, stateObj), cyclic && 'readonly', stateObj, promisesData, resolvingTypesonPromise, type);\n                }\n            }\n            return value;\n        }\n    };\n\n    // Also sync but throws on non-sync result\n    this.encapsulateSync = function (obj, stateObj, opts) {\n        return encapsulate(obj, stateObj, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: true}));\n    };\n    this.encapsulateAsync = function (obj, stateObj, opts) {\n        return encapsulate(obj, stateObj, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: false}));\n    };\n\n    /** Revive an encapsulated object.\n     * This method is used internally by Typeson.parse().\n     * @param {Object} obj - Object to revive. If it has $types member, the properties that are listed there\n     * will be replaced with its true type instead of just plain objects.\n     */\n    const revive = this.revive = function (obj, opts) {\n        opts = Object.assign({sync: true}, options, opts);\n        const sync = opts.sync;\n        let types = obj && obj.$types,\n            ignore$Types = true;\n        if (!types) return obj; // No type info added. Revival not needed.\n        if (types === true) return obj.$; // Object happened to have own `$types` property but with no actual types, so we unescape and return that object\n        if (types.$ && isPlainObject(types.$)) {\n            // Special when root object is not a trivial Object, it will be encapsulated in $. It will also be encapsulated in $ if it has its own `$` property to avoid ambiguity\n            obj = obj.$;\n            types = types.$;\n            ignore$Types = false;\n        }\n        const keyPathResolutions = [];\n        const stateObj = {};\n        let ret = _revive('', obj, null, opts);\n        ret = hasConstructorOf(ret, Undefined) ? undefined : ret;\n        return isThenable(ret)\n            ? sync && opts.throwOnBadSyncType\n                ? (() => {\n                    throw new TypeError('Sync method requested but async result obtained');\n                })()\n                : ret\n            : !sync && opts.throwOnBadSyncType\n                ? (() => {\n                    throw new TypeError('Async method requested but sync result obtained');\n                })()\n                : sync\n                    ? ret\n                    : Promise.resolve(ret);\n\n        function _revive (keypath, value, target, opts, clone, key) {\n            if (ignore$Types && keypath === '$types') return;\n            const type = types[keypath];\n            if (isArray(value) || isPlainObject(value)) {\n                const clone = isArray(value) ? new Array(value.length) : {};\n                // Iterate object or array\n                keys(value).forEach((key) => {\n                    const val = _revive(\n                        keypath + (keypath ? '.' : '') + escapeKeyPathComponent(key), value[key],\n                        target || clone,\n                        opts,\n                        clone,\n                        key\n                    );\n                    if (hasConstructorOf(val, Undefined)) clone[key] = undefined;\n                    else if (val !== undefined) clone[key] = val;\n                });\n                value = clone;\n                while (keyPathResolutions.length) { // Try to resolve cyclic reference as soon as available\n                    const [[target, keyPath, clone, key]] = keyPathResolutions;\n                    const val = getByKeyPath(target, keyPath);\n                    if (hasConstructorOf(val, Undefined)) clone[key] = undefined;\n                    else if (val !== undefined) clone[key] = val;\n                    else break;\n                    keyPathResolutions.splice(0, 1);\n                }\n            }\n            if (!type) return value;\n            if (type === '#') {\n                const ret = getByKeyPath(target, value.substr(1));\n                if (ret === undefined) { // Cyclic reference not yet available\n                    keyPathResolutions.push([target, value.substr(1), clone, key]);\n                }\n                return ret;\n            }\n            const sync = opts.sync;\n            return [].concat(type).reduce((val, type) => {\n                const reviver = revivers[type];\n                if (!reviver) throw new Error('Unregistered type: ' + type);\n                return reviver[ // eslint-disable-line standard/computed-property-even-spacing\n                    sync && reviver.revive\n                        ? 'revive'\n                        : !sync && reviver.reviveAsync\n                            ? 'reviveAsync'\n                            : 'revive'\n                ](val, stateObj);\n            }, value);\n        }\n    };\n\n    // Also sync but throws on non-sync result\n    this.reviveSync = function (obj, opts) {\n        return revive(obj, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: true}));\n    };\n    this.reviveAsync = function (obj, opts) {\n        return revive(obj, Object.assign({}, {throwOnBadSyncType: true}, opts, {sync: false}));\n    };\n\n    /** Register types.\n     * For examples how to use this method, see https://github.com/dfahlander/typeson-registry/tree/master/types\n     * @param {Array.<Object.<string,Function[]>>} typeSpec - Types and their functions [test, encapsulate, revive];\n     */\n    this.register = function (typeSpecSets, opts) {\n        opts = opts || {};\n        [].concat(typeSpecSets).forEach(function R (typeSpec) {\n            if (isArray(typeSpec)) return typeSpec.map(R); // Allow arrays of arrays of arrays...\n            typeSpec && keys(typeSpec).forEach(function (typeId) {\n                if (typeId === '#') {\n                    throw new TypeError('# cannot be used as a type name as it is reserved for cyclic objects');\n                } else if (Typeson.JSON_TYPES.includes(typeId)) {\n                    throw new TypeError('Plain JSON object types are reserved as type names');\n                }\n                let spec = typeSpec[typeId];\n                const replacers = spec.testPlainObjects ? plainObjectReplacers : nonplainObjectReplacers;\n                const existingReplacer = replacers.filter(function (r) { return r.type === typeId; });\n                if (existingReplacer.length) {\n                    // Remove existing spec and replace with this one.\n                    replacers.splice(replacers.indexOf(existingReplacer[0]), 1);\n                    delete revivers[typeId];\n                    delete regTypes[typeId];\n                }\n                if (spec) {\n                    if (typeof spec === 'function') {\n                        // Support registering just a class without replacer/reviver\n                        const Class = spec;\n                        spec = {\n                            test: (x) => x && x.constructor === Class,\n                            replace: (x) => assign({}, x),\n                            revive: (x) => assign(Object.create(Class.prototype), x)\n                        };\n                    } else if (isArray(spec)) {\n                        spec = {\n                            test: spec[0],\n                            replace: spec[1],\n                            revive: spec[2]\n                        };\n                    }\n                    const replacerObj = {\n                        type: typeId,\n                        test: spec.test.bind(spec)\n                    };\n                    if (spec.replace) {\n                        replacerObj.replace = spec.replace.bind(spec);\n                    }\n                    if (spec.replaceAsync) {\n                        replacerObj.replaceAsync = spec.replaceAsync.bind(spec);\n                    }\n                    const start = typeof opts.fallback === 'number' ? opts.fallback : (opts.fallback ? 0 : Infinity);\n                    if (spec.testPlainObjects) {\n                        plainObjectReplacers.splice(start, 0, replacerObj);\n                    } else {\n                        nonplainObjectReplacers.splice(start, 0, replacerObj);\n                    }\n                    // Todo: We might consider a testAsync type\n                    if (spec.revive || spec.reviveAsync) {\n                        const reviverObj = {};\n                        if (spec.revive) reviverObj.revive = spec.revive.bind(spec);\n                        if (spec.reviveAsync) reviverObj.reviveAsync = spec.reviveAsync.bind(spec);\n                        revivers[typeId] = reviverObj;\n                    }\n\n                    regTypes[typeId] = spec; // Record to be retrieved via public types property.\n                }\n            });\n        });\n        return this;\n    };\n}\n\nfunction assign (t, s) {\n    keys(s).map((k) => { t[k] = s[k]; });\n    return t;\n}\n\n/** escapeKeyPathComponent() utility */\nfunction escapeKeyPathComponent (keyPathComponent) {\n    return keyPathComponent.replace(/~/g, '~0').replace(/\\./g, '~1');\n}\n\n/** unescapeKeyPathComponent() utility */\nfunction unescapeKeyPathComponent (keyPathComponent) {\n    return keyPathComponent.replace(/~1/g, '.').replace(/~0/g, '~');\n}\n\n/** getByKeyPath() utility */\nfunction getByKeyPath (obj, keyPath) {\n    if (keyPath === '') return obj;\n    const period = keyPath.indexOf('.');\n    if (period > -1) {\n        const innerObj = obj[unescapeKeyPathComponent(keyPath.substr(0, period))];\n        return innerObj === undefined ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n    }\n    return obj[unescapeKeyPathComponent(keyPath)];\n}\n\n// We keep these two functions minimized so if using two instances of this\n//   library, where one is minimized and one is not, it will still work\nfunction Undefined(){} // eslint-disable-line space-before-function-paren, space-before-blocks\n// With ES6 classes, we may be able to simply use `class TypesonPromise extends Promise` and add a string tag for detection\nfunction TypesonPromise(f){this.p=new Promise(f)} // eslint-disable-line block-spacing, space-before-function-paren, space-before-blocks, space-infix-ops, semi\n\nTypesonPromise.prototype.then = function (onFulfilled, onRejected) {\n    return new TypesonPromise((typesonResolve, typesonReject) => {\n        this.p.then(function (res) {\n            typesonResolve(onFulfilled ? onFulfilled(res) : res);\n        }, (r) => {\n            this.p['catch'](function (res) {\n                return onRejected ? onRejected(res) : Promise.reject(res);\n            }).then(typesonResolve, typesonReject);\n        });\n    });\n};\nTypesonPromise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n};\nTypesonPromise.resolve = function (v) {\n    return new TypesonPromise((typesonResolve) => {\n        typesonResolve(v);\n    });\n};\nTypesonPromise.reject = function (v) {\n    return new TypesonPromise((typesonResolve, typesonReject) => {\n        typesonReject(v);\n    });\n};\n['all', 'race'].map(function (meth) {\n    TypesonPromise[meth] = function (promArr) {\n        return new TypesonPromise(function (typesonResolve, typesonReject) {\n            Promise[meth](promArr.map((prom) => { return prom.p; })).then(typesonResolve, typesonReject);\n        });\n    };\n});\n\n// The following provide classes meant to avoid clashes with other values\nTypeson.Undefined = Undefined; // To insist `undefined` should be added\nTypeson.Promise = TypesonPromise; // To support async encapsulation/stringification\n\n// Some fundamental type-checking utilities\nTypeson.isThenable = isThenable;\nTypeson.toStringTag = toStringTag;\nTypeson.hasConstructorOf = hasConstructorOf;\nTypeson.isObject = isObject;\nTypeson.isPlainObject = isPlainObject;\nTypeson.isUserObject = isUserObject;\n\nTypeson.escapeKeyPathComponent = escapeKeyPathComponent;\nTypeson.unescapeKeyPathComponent = unescapeKeyPathComponent;\nTypeson.getByKeyPath = getByKeyPath;\nTypeson.getJSONType = (value) =>\n    value === null ? 'null' : (\n        isArray(value)\n            ? 'array'\n            : typeof value);\nTypeson.JSON_TYPES = [\n    'null', 'boolean', 'number', 'string', 'array', 'object'\n];\n\nexport default Typeson;\n","/*\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2017 Brett Zamir, 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n// Use a lookup table to find the index.\nconst lookup = new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\n\nexport const encode = function (arraybuffer, byteOffset, length) {\n    const bytes = new Uint8Array(arraybuffer, byteOffset, length),\n        len = bytes.length;\n    let base64 = '';\n\n    for (let i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n\n    if ((len % 3) === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    } else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n\n    return base64;\n};\n\nexport const decode = function (base64) {\n    const len = base64.length;\n\n    let bufferLength = base64.length * 0.75;\n    let p = 0;\n    let encoded1, encoded2, encoded3, encoded4;\n\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    const arraybuffer = new ArrayBuffer(bufferLength),\n        bytes = new Uint8Array(arraybuffer);\n\n    for (let i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n\n    return arraybuffer;\n};\n","import Typeson from 'typeson';\nimport {encode, decode} from 'base64-arraybuffer-es6';\n\nexport default {\n    arraybuffer: {\n        test (x) { return Typeson.toStringTag(x) === 'ArrayBuffer'; },\n        replace (b, stateObj) {\n            if (!stateObj.buffers) {\n                stateObj.buffers = [];\n            }\n            const index = stateObj.buffers.indexOf(b);\n            if (index > -1) {\n                return {index};\n            }\n            stateObj.buffers.push(b);\n            return encode(b);\n        },\n        revive (b64, stateObj) {\n            if (!stateObj.buffers) {\n                stateObj.buffers = [];\n            }\n            if (typeof b64 === 'object') {\n                return stateObj.buffers[b64.index];\n            }\n            const buffer = decode(b64);\n            stateObj.buffers.push(buffer);\n            return buffer;\n        }\n    }\n};\n\n// See also typed-arrays!\n","function arraybuffer2string (buf) {\n    return new Uint16Array(buf).reduce((s, byte) => s + String.fromCharCode(byte), '');\n}\n\nfunction string2arraybuffer (str) {\n    /*\n    // UTF-8 approaches\n    const utf8 = unescape(encodeURIComponent(str));\n    const arr = new Uint8Array(utf8.length);\n    for (let i = 0; i < utf8.length; i++) {\n        arr[i] = utf8.charCodeAt(i);\n    }\n    return arr.buffer;\n\n    const utf8 = [];\n    for (let i = 0; i < str.length; i++) {\n        let charcode = str.charCodeAt(i);\n        if (charcode < 0x80) utf8.push(charcode);\n        else if (charcode < 0x800) {\n            utf8.push(0xc0 | (charcode >> 6),\n                0x80 | (charcode & 0x3f));\n        } else if (charcode < 0xd800 || charcode >= 0xe000) {\n            utf8.push(0xe0 | (charcode >> 12),\n                0x80 | ((charcode >> 6) & 0x3f),\n                0x80 | (charcode & 0x3f));\n        // surrogate pair\n        } else {\n            i++;\n            // UTF-16 encodes 0x10000-0x10FFFF by\n            // subtracting 0x10000 and splitting the\n            // 20 bits of 0x0-0xFFFFF into two halves\n            charcode = 0x10000 + (((charcode & 0x3ff) << 10) |\n                (str.charCodeAt(i) & 0x3ff));\n            utf8.push(0xf0 | (charcode >> 18),\n                0x80 | ((charcode >> 12) & 0x3f),\n                0x80 | ((charcode >> 6) & 0x3f),\n                0x80 | (charcode & 0x3f));\n        }\n    }\n    return utf8;\n    */\n    /*\n    // Working UTF-16 options (equivalents)\n    const buf = new ArrayBuffer(str.length * 2); // 2 bytes for each char\n    const bufView = new Uint16Array(buf);\n    for (let i = 0, strLen = str.length; i < strLen; i++) {\n        bufView[i] = str.charCodeAt(i);\n    }\n    return buf;\n    */\n\n    const array = new Uint16Array(str.length);\n    for (let i = 0; i < str.length; i++) {\n        array[i] = str.charCodeAt(i);\n    }\n    return array.buffer;\n}\nexport {arraybuffer2string, string2arraybuffer};\n","import Typeson from 'typeson';\n\nimport {string2arraybuffer} from '../utils/stringArrayBuffer.js';\n\nexport default {\n    blob: {\n        test (x) { return Typeson.toStringTag(x) === 'Blob'; },\n        replace (b) { // Sync\n            const req = new XMLHttpRequest();\n            req.open('GET', URL.createObjectURL(b), false); // Sync\n            if (typeof TextEncoder !== 'undefined') { // Using TextDecoder/TextEncoder used too much space\n                req.overrideMimeType('text/plain; charset=utf-16le');\n            }\n            if (req.status !== 200 && req.status !== 0) {\n                throw new Error('Bad Blob access: ' + req.status);\n            }\n            req.send();\n            return {\n                type: b.type,\n                stringContents: req.responseText\n            };\n        },\n        revive ({type, stringContents}) {\n            return new Blob([string2arraybuffer(stringContents)], {type});\n        },\n        replaceAsync (b) {\n            return new Typeson.Promise((resolve, reject) => {\n                if (b.isClosed) { // On MDN, but not in https://w3c.github.io/FileAPI/#dfn-Blob\n                    reject(new Error('The Blob is closed'));\n                    return;\n                }\n                const reader = new FileReader();\n                reader.addEventListener('load', () => {\n                    resolve({\n                        type: b.type,\n                        stringContents: reader.result\n                    });\n                });\n                reader.addEventListener('error', () => {\n                    reject(reader.error);\n                });\n                reader.readAsText(b, 'UTF-16');\n            });\n        }\n    }\n};\n","const cloneableObjectsByUUID = {};\n\n// TODO: We could use `import generateUUID from 'uuid/v4';` (but it needs crypto library, etc.)\nfunction generateUUID () { //  Adapted from original: public domain/MIT: http://stackoverflow.com/a/8809472/271577\n    let d = new Date().getTime();\n    if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n        d += performance.now(); // use high-precision timer if available\n    }\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = (d + Math.random() * 16) % 16 | 0;\n        d = Math.floor(d / 16);\n        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n    });\n}\n\nexport default {\n    cloneable: {\n        test (x) {\n            return x && typeof x === 'object' &&\n                typeof x[Symbol.for('cloneEncapsulate')] === 'function';\n        },\n        replace (cloneable) {\n            const encapsulated = cloneable[Symbol.for('cloneEncapsulate')]();\n            const uuid = generateUUID();\n            cloneableObjectsByUUID[uuid] = cloneable;\n            return {uuid, encapsulated};\n        },\n        revive ({uuid, encapsulated}) {\n            return cloneableObjectsByUUID[uuid][Symbol.for('cloneRevive')](encapsulated);\n        }\n    }\n};\n","import Typeson from 'typeson';\nimport {encode, decode} from 'base64-arraybuffer-es6';\nexport default {\n    dataview: {\n        test (x) { return Typeson.toStringTag(x) === 'DataView'; },\n        replace ({buffer, byteOffset, byteLength}, stateObj) {\n            if (!stateObj.buffers) {\n                stateObj.buffers = [];\n            }\n            const index = stateObj.buffers.indexOf(buffer);\n            if (index > -1) {\n                return {index, byteOffset, byteLength};\n            }\n            stateObj.buffers.push(buffer);\n            return {\n                encoded: encode(buffer),\n                byteOffset,\n                byteLength\n            };\n        },\n        revive (b64Obj, stateObj) {\n            if (!stateObj.buffers) {\n                stateObj.buffers = [];\n            }\n            const {byteOffset, byteLength, encoded, index} = b64Obj;\n            let buffer;\n            if ('index' in b64Obj) {\n                buffer = stateObj.buffers[index];\n            } else {\n                buffer = decode(encoded);\n                stateObj.buffers.push(buffer);\n            }\n            return new DataView(buffer, byteOffset, byteLength);\n        }\n    }\n};\n","import Typeson from 'typeson';\nexport default {\n    date: {\n        test (x) { return Typeson.toStringTag(x) === 'Date'; },\n        replace (date) {\n            const time = date.getTime();\n            if (isNaN(time)) {\n                return 'NaN';\n            }\n            return time;\n        },\n        revive (time) {\n            if (time === 'NaN') {\n                return new Date(NaN);\n            }\n            return new Date(time);\n        }\n    }\n};\n","import Typeson from 'typeson';\nexport default {\n    error: {\n        test (x) { return Typeson.toStringTag(x) === 'Error'; },\n        replace ({name, message}) {\n            return {name, message};\n        },\n        revive ({name, message}) {\n            const e = new Error(message);\n            e.name = name;\n            return e;\n        }\n    }\n};\n// See also errors.js that may be registered after having registered this type.\n","/* eslint-env browser, node */\nimport Typeson from 'typeson';\nconst _global = typeof self === 'undefined' ? global : self;\n\nconst exportObj = {};\n// Comprises all built-in errors.\n[\n    'TypeError',\n    'RangeError',\n    'SyntaxError',\n    'ReferenceError',\n    'EvalError',\n    'URIError',\n    'InternalError' // non-standard\n].forEach((errName) => {\n    const constructor = _global[errName];\n    if (constructor) {\n        exportObj[errName.toLowerCase()] = {\n            test (x) { return Typeson.hasConstructorOf(x, constructor); },\n            replace (e) { return e.message; },\n            revive (message) { return new constructor(message); }\n        };\n    }\n});\n\nexport default exportObj;\n","import Typeson from 'typeson';\n\nimport {string2arraybuffer} from '../utils/stringArrayBuffer.js';\n\nexport default {\n    file: {\n        test (x) { return Typeson.toStringTag(x) === 'File'; },\n        replace (f) { // Sync\n            const req = new XMLHttpRequest();\n            req.open('GET', URL.createObjectURL(f), false); // Sync\n            if (typeof TextEncoder !== 'undefined') { // Using TextDecoder/TextEncoder used too much space\n                req.overrideMimeType('text/plain; charset=utf-16le');\n            }\n            if (req.status !== 200 && req.status !== 0) {\n                throw new Error('Bad Blob access: ' + req.status);\n            }\n            req.send();\n            return {\n                type: f.type,\n                stringContents: req.responseText,\n                name: f.name,\n                lastModified: f.lastModified\n            };\n        },\n        revive ({name, type, stringContents, lastModified}) {\n            // stringContents = new TextEncoder().encode(stringContents);\n            const buffer = string2arraybuffer(stringContents);\n            // stringContents = new TextDecoder('utf-16le').decode(buffer);\n            return new File([buffer], name, {\n                type,\n                lastModified\n            });\n        },\n        replaceAsync (f) {\n            return new Typeson.Promise(function (resolve, reject) {\n                if (f.isClosed) { // On MDN, but not in https://w3c.github.io/FileAPI/#dfn-Blob\n                    reject(new Error('The File is closed'));\n                    return;\n                }\n                const reader = new FileReader();\n                reader.addEventListener('load', function () {\n                    resolve({\n                        type: f.type,\n                        stringContents: reader.result,\n                        name: f.name,\n                        lastModified: f.lastModified\n                    });\n                });\n                reader.addEventListener('error', function () {\n                    reject(reader.error);\n                });\n                reader.readAsText(f, 'UTF-16');\n            });\n        }\n    }\n};\n","import Typeson from 'typeson';\nimport file from './file.js';\nexport default {\n    file: file.file,\n    filelist: {\n        test (x) { return Typeson.toStringTag(x) === 'FileList'; },\n        replace (fl) {\n            const arr = [];\n            for (let i = 0; i < fl.length; i++) {\n                arr[i] = fl.item(i);\n            }\n            return arr;\n        },\n        revive (o) {\n            function FileList () {\n                this._files = arguments[0];\n                this.length = this._files.length;\n            }\n            FileList.prototype.item = function (index) {\n                return this._files[index];\n            };\n            FileList.prototype[Symbol.toStringTag] = 'FileList';\n            return new FileList(o);\n        }\n    }\n};\n","/** ImageBitmap is browser / DOM specific. It also can only work same-domain (or CORS)\n*/\nimport Typeson from 'typeson';\nexport default {\n    imagebitmap: {\n        test (x) {\n            return Typeson.toStringTag(x) === 'ImageBitmap' ||\n                // In Node, our polyfill sets the dataset on a canvas element as JSDom no longer allows overriding toStringTag\n                (x && x.dataset && x.dataset.toStringTag === 'ImageBitmap');\n        },\n        replace (bm) {\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            ctx.drawImage(bm, 0, 0);\n            // Although `width` and `height` are part of `ImageBitMap`, these will\n            //   be auto-created for us when reviving with the data URL (and they are\n            //   not settable even if they weren't)\n            // return {width: bm.width, height: bm.height, dataURL: canvas.toDataURL()};\n            return canvas.toDataURL();\n        },\n        revive (o) {\n            /*\n            var req = new XMLHttpRequest();\n            req.open('GET', o, false); // Sync\n            if (req.status !== 200 && req.status !== 0) throw new Error('Bad ImageBitmap access: ' + req.status);\n            req.send();\n            return req.responseText;\n            */\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            const img = document.createElement('img');\n            // The onload is needed by some browsers per http://stackoverflow.com/a/4776378/271577\n            img.onload = function () {\n                ctx.drawImage(img, 0, 0);\n            };\n            img.src = o;\n            return canvas; // Works in contexts allowing an ImageBitmap (We might use `OffscreenCanvas.transferToBitmap` when supported)\n        },\n        reviveAsync (o) {\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            const img = document.createElement('img');\n            // The onload is needed by some browsers per http://stackoverflow.com/a/4776378/271577\n            img.onload = function () {\n                ctx.drawImage(img, 0, 0);\n            };\n            img.src = o; // o.dataURL;\n            return createImageBitmap(canvas); // Returns a promise\n        }\n    }\n};\n","/** ImageData is browser / DOM specific (though `node-canvas` has it available on `Canvas`).\n*/\nimport Typeson from 'typeson';\nexport default {\n    imagedata: {\n        test (x) { return Typeson.toStringTag(x) === 'ImageData'; },\n        replace (d) {\n            return {\n                array: Array.from(d.data), // Ensure `length` gets preserved for revival\n                width: d.width,\n                height: d.height\n            };\n        },\n        revive (o) {\n            return new ImageData(new Uint8ClampedArray(o.array), o.width, o.height);\n        }\n    }\n};\n","export default {\n    infinity: {\n        test (x) { return x === Infinity; },\n        replace (n) { return 'Infinity'; },\n        revive (s) { return Infinity; }\n    }\n};\n","import Typeson from 'typeson';\n\nconst IntlCollator = {\n    test (x) { return Typeson.hasConstructorOf(x, Intl.Collator); },\n    replace (c) { return c.resolvedOptions(); },\n    revive (options) { return new Intl.Collator(options.locale, options); }\n};\n\nconst IntlDateTimeFormat = {\n    test (x) { return Typeson.hasConstructorOf(x, Intl.DateTimeFormat); },\n    replace (dtf) { return dtf.resolvedOptions(); },\n    revive (options) { return new Intl.DateTimeFormat(options.locale, options); }\n};\n\nconst IntlNumberFormat = {\n    test (x) { return Typeson.hasConstructorOf(x, Intl.NumberFormat); },\n    replace (nf) { return nf.resolvedOptions(); },\n    revive (options) { return new Intl.NumberFormat(options.locale, options); }\n};\n\nexport default {\n    IntlCollator,\n    IntlDateTimeFormat,\n    IntlNumberFormat\n};\n","import Typeson from 'typeson';\nexport default {\n    map: {\n        test (x) { return Typeson.toStringTag(x) === 'Map'; },\n        replace (map) { return Array.from(map.entries()); },\n        revive (entries) { return new Map(entries); }\n    }\n};\n","export default {\n    nan: {\n        test (x) { return typeof x === 'number' && isNaN(x); },\n        replace (n) { return 'NaN'; },\n        revive (s) { return NaN; }\n    }\n};\n","export default {\n    negativeInfinity: {\n        test (x) { return x === -Infinity; },\n        replace (n) { return '-Infinity'; },\n        revive (s) { return -Infinity; }\n    }\n};\n","import Typeson from 'typeson';\nexport default {\n    nonbuiltinIgnore: {\n        test (x) {\n            return x && typeof x === 'object' && !Array.isArray(x) && ![\n                'Object',\n                // `Proxy` and `Reflect`, two other built-in objects, will also\n                //   have a `toStringTag` of `Object`; we don't want built-in\n                //   function objects, however\n                'Boolean', 'Number', 'String',\n                'Error', 'RegExp', 'Math', 'Date',\n                'Map', 'Set',\n                'JSON',\n                'ArrayBuffer', 'SharedArrayBuffer', 'DataView',\n                'Int8Array', 'Uint8Array', 'Uint8ClampedArray', 'Int16Array',\n                'Uint16Array', 'Int32Array', 'Uint32Array', 'Float32Array', 'Float64Array',\n                'Promise',\n                'String Iterator', 'Array Iterator', 'Map Iterator', 'Set Iterator',\n                'WeakMap', 'WeakSet',\n                'Atomics', 'Module'\n            ].includes(Typeson.toStringTag(x));\n        },\n        replace (rexp) { }\n    }\n};\n","// This module is for objectified primitives (such as `new Number(3)` or\n//      `new String(\"foo\")`)\n/* eslint-disable no-new-wrappers */\nimport Typeson from 'typeson';\nexport default {\n    // String Object (not primitive string which need no type spec)\n    StringObject: {\n        test (x) { return Typeson.toStringTag(x) === 'String' && typeof x === 'object'; },\n        replace (s) { return String(s); }, // convert to primitive string\n        revive (s) { return new String(s); } // Revive to an objectified string\n    },\n    // Boolean Object (not primitive boolean which need no type spec)\n    BooleanObject: {\n        test (x) { return Typeson.toStringTag(x) === 'Boolean' && typeof x === 'object'; },\n        replace (b) { return Boolean(b); }, // convert to primitive boolean\n        revive (b) { return new Boolean(b); } // Revive to an objectified Boolean\n    },\n    // Number Object (not primitive number which need no type spec)\n    NumberObject: {\n        test (x) { return Typeson.toStringTag(x) === 'Number' && typeof x === 'object'; },\n        replace (n) { return Number(n); }, // convert to primitive number\n        revive (n) { return new Number(n); } // Revive to an objectified number\n    }\n};\n/* eslint-enable no-new-wrappers */\n","import Typeson from 'typeson';\nexport default {\n    regexp: {\n        test (x) { return Typeson.toStringTag(x) === 'RegExp'; },\n        replace (rexp) {\n            return {\n                source: rexp.source,\n                flags: (rexp.global ? 'g' : '') +\n                    (rexp.ignoreCase ? 'i' : '') +\n                    (rexp.multiline ? 'm' : '') +\n                    (rexp.sticky ? 'y' : '') +\n                    (rexp.unicode ? 'u' : '')\n            };\n        },\n        revive ({source, flags}) { return new RegExp(source, flags); }\n    }\n};\n","// Here we allow the exact same non-plain object, function, and symbol instances to\n//  be resurrected (assuming the same session/environment); plain objects are\n//  ignored by Typeson so not presently available and we consciously exclude arrays\n\nconst resurrectableObjectsByUUID = {};\n\n// TODO: We could use `import generateUUID from 'uuid/v4';` (but it needs crypto library, etc.)\nfunction generateUUID () { //  Adapted from original: public domain/MIT: http://stackoverflow.com/a/8809472/271577\n    let d = new Date().getTime();\n    if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n        d += performance.now(); // use high-precision timer if available\n    }\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = (d + Math.random() * 16) % 16 | 0;\n        d = Math.floor(d / 16);\n        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n    });\n}\n\nexport default {\n    resurrectable: {\n        test (x) {\n            return x &&\n                !Array.isArray(x) &&\n                ['object', 'function', 'symbol'].includes(typeof x);\n        },\n        replace (resurrectable) {\n            const uuid = generateUUID();\n            resurrectableObjectsByUUID[uuid] = resurrectable;\n            return uuid;\n        },\n        revive (serializedResurrectable) {\n            return resurrectableObjectsByUUID[serializedResurrectable];\n        }\n    }\n};\n","import Typeson from 'typeson';\nexport default {\n    set: {\n        test (x) { return Typeson.toStringTag(x) === 'Set'; },\n        replace (set) { return Array.from(set.values()); },\n        revive (values) { return new Set(values); }\n    }\n};\n","/* eslint-env browser, node */\nimport Typeson from 'typeson';\nconst _global = typeof self === 'undefined' ? global : self;\n\n// Support all kinds of typed arrays (views of ArrayBuffers)\nconst exportObj = {};\n[\n    'Int8Array',\n    'Uint8Array',\n    'Uint8ClampedArray',\n    'Int16Array',\n    'Uint16Array',\n    'Int32Array',\n    'Uint32Array',\n    'Float32Array',\n    'Float64Array'\n].forEach(function (typeName) {\n    const arrType = typeName;\n    const TypedArray = _global[typeName];\n    if (TypedArray) {\n        exportObj[typeName.toLowerCase()] = {\n            test (x) { return Typeson.toStringTag(x) === arrType; },\n            replace (a) {\n                return (a.byteOffset === 0 && a.byteLength === a.buffer.byteLength\n                    ? a\n                    // socket.io supports streaming ArrayBuffers. If we have a typed array\n                    // representing a portion of the buffer, we need to clone the buffer before leaving it\n                    // to socket.io.\n                    : a.slice(0)).buffer;\n            },\n            revive (buf) {\n                // One may configure socket.io to revive binary data as Buffer or Blob.\n                // We should therefore not rely on that the instance we get here is an ArrayBuffer\n                // If not, let's assume user wants to receive it as configured with socket.io.\n                return Typeson.toStringTag(buf) === 'ArrayBuffer'\n                    ? new TypedArray(buf)\n                    : buf;\n            }\n        };\n    }\n});\n\nexport default exportObj;\n","/* eslint-env browser, node */\nimport Typeson from 'typeson';\nimport {encode, decode} from 'base64-arraybuffer-es6';\n\nconst _global = typeof self === 'undefined' ? global : self;\n\nconst exportObj = {};\n[\n    'Int8Array',\n    'Uint8Array',\n    'Uint8ClampedArray',\n    'Int16Array',\n    'Uint16Array',\n    'Int32Array',\n    'Uint32Array',\n    'Float32Array',\n    'Float64Array'\n].forEach(function (typeName) {\n    const arrType = typeName;\n    const TypedArray = _global[arrType];\n    if (TypedArray) {\n        exportObj[typeName.toLowerCase()] = {\n            test (x) { return Typeson.toStringTag(x) === arrType; },\n            replace ({buffer, byteOffset, length}, stateObj) {\n                if (!stateObj.buffers) {\n                    stateObj.buffers = [];\n                }\n                const index = stateObj.buffers.indexOf(buffer);\n                if (index > -1) {\n                    return {index, byteOffset, length};\n                }\n                stateObj.buffers.push(buffer);\n                return {\n                    encoded: encode(buffer),\n                    byteOffset,\n                    length\n                };\n            },\n            revive (b64Obj, stateObj) {\n                if (!stateObj.buffers) {\n                    stateObj.buffers = [];\n                }\n                const {byteOffset, length, encoded, index} = b64Obj;\n                let buffer;\n                if ('index' in b64Obj) {\n                    buffer = stateObj.buffers[index];\n                } else {\n                    buffer = decode(encoded);\n                    stateObj.buffers.push(buffer);\n                }\n                return new TypedArray(buffer, byteOffset, length);\n            }\n        };\n    }\n});\n\nexport default exportObj;\n","// This does not preserve `undefined` in sparse arrays; see the `undefined` or `sparse-undefined` preset\nimport Typeson from 'typeson';\n\nexport default {\n    undef: {\n        test (x, stateObj) {\n            return typeof x === 'undefined' &&\n                (stateObj.ownKeys || !('ownKeys' in stateObj));\n        },\n        replace (n) { return null; },\n        revive (s) { return new Typeson.Undefined(); } // Will add `undefined` (returning `undefined` would instead avoid explicitly setting)\n    }\n};\n","import Typeson from 'typeson';\n\nexport default {\n    userObject: {\n        test (x, stateObj) { return Typeson.isUserObject(x); },\n        replace (n) { return Object.assign({}, n); },\n        revive (s) { return s; }\n    }\n};\n","export default [\n    {\n        sparseArrays: {\n            testPlainObjects: true,\n            test (x) { return Array.isArray(x); },\n            replace (a, stateObj) {\n                stateObj.iterateUnsetNumeric = true;\n                return a;\n            }\n        }\n    },\n    {\n        sparseUndefined: {\n            test (x, stateObj) {\n                return typeof x === 'undefined' && stateObj.ownKeys === false;\n            },\n            replace (n) { return null; },\n            revive (s) { return undefined; } // Will avoid adding anything\n        }\n    }\n];\n","import sparseUndefined from '../presets/sparse-undefined.js';\nimport undef from '../types/undef.js';\n\nexport default [\n    sparseUndefined,\n    undef\n];\n","/* This preset includes types that are built-in into the JavaScript language itself, this\n   should work universally. Types that were added in ES6 or beyond will be checked before inclusion\n   so that this module can be consumed by both ES5 and ES6 environments.\n   Some types cannot be encapsulated because their inner state is private: `WeakMap`, `WeakSet`.\n   The Function type is not included because their closures would not be serialized, so a revived\n   Function that uses closures would not behave as expected. Symbols are similarly not included.\n*/\n\nimport presetUndefined from '../presets/undef.js';\nimport primitiveObjects from '../types/primitive-objects.js';\nimport specialNumbers from '../presets/special-numbers.js';\nimport date from '../types/date.js';\nimport error from '../types/error.js';\nimport errors from '../types/errors.js';\nimport regexp from '../types/regexp.js';\nimport map from '../types/map.js';\nimport set from '../types/set.js';\nimport arraybuffer from '../types/arraybuffer.js';\nimport typedArrays from '../types/typed-arrays.js';\nimport dataview from '../types/dataview.js';\nimport intlTypes from '../types/intl-types.js';\n\nconst expObj = [\n    // ES5\n    presetUndefined, primitiveObjects, specialNumbers,\n    date, error, errors, regexp\n].concat(\n    // ES2015 (ES6)\n    typeof Map === 'function' ? map : [],\n    typeof Set === 'function' ? set : [],\n    typeof ArrayBuffer === 'function' ? arraybuffer : [],\n    typeof Uint8Array === 'function' ? typedArrays : [],\n    typeof DataView === 'function' ? dataview : [],\n    typeof Intl !== 'undefined' ? intlTypes : []\n);\nexport default expObj;\n","/** When communicating via postMessage() (Worker.postMessage() or window.postMessage()),\n * the browser will use a similar algorithm as Typeson does to encapsulate and revive all\n * items in the structure (aka the structured clone algorithm). This algorithm supports all\n * built-in types as well as many DOM types. Therefore, only types that\n * are not included in the structured clone algorithm need to be registered, which is:\n * * Error\n * * Specific Errors like SyntaxError, TypeError, etc.\n * * Any custom type you want to send across window- or worker boundraries\n * This preset will only include the Error types and you can register your custom types\n * after having registered these.\n */\n\nimport error from '../types/error.js';\nimport errors from '../types/errors.js';\n\nexport default [\n    error,\n    errors\n];\n","import builtin from './builtin.js';\nimport typedArraysSocketIO from '../types/typed-arrays-socketio.js';\nexport default [\n    builtin,\n    {ArrayBuffer: null}, // Leave ArrayBuffer as is, and let socket.io stream it instead.\n    typedArraysSocketIO // Encapsulate TypedArrays in ArrayBuffers instead of base64 strings.\n];\n","/* This preset includes types for the Structured Cloning Algorithm. */\n\nimport userObject from '../types/user-object.js';\nimport presetUndefined from '../presets/undef.js';\nimport primitiveObjects from '../types/primitive-objects.js';\nimport specialNumbers from '../presets/special-numbers.js';\nimport date from '../types/date.js';\nimport regexp from '../types/regexp.js';\nimport map from '../types/map.js';\nimport set from '../types/set.js';\nimport arraybuffer from '../types/arraybuffer.js';\nimport typedArrays from '../types/typed-arrays.js';\nimport dataview from '../types/dataview.js';\nimport intlTypes from '../types/intl-types.js';\n\nimport imagedata from '../types/imagedata.js';\nimport imagebitmap from '../types/imagebitmap.js'; // Async return\nimport file from '../types/file.js';\nimport filelist from '../types/filelist.js';\nimport blob from '../types/blob.js';\n\nconst expObj = [\n    // Todo: Might also register synchronous `ImageBitmap` and `Blob`/`File`/`FileList`?\n    // ES5\n    userObject, // Processed last (non-builtin)\n\n    presetUndefined, primitiveObjects, specialNumbers,\n    date, regexp,\n\n    // Non-built-ins\n    imagedata,\n    imagebitmap, // Async return\n    file,\n    filelist,\n    blob\n].concat(\n    // ES2015 (ES6)\n    typeof Map === 'function' ? map : [],\n    typeof Set === 'function' ? set : [],\n    typeof ArrayBuffer === 'function' ? arraybuffer : [],\n    typeof Uint8Array === 'function' ? typedArrays : [],\n    typeof DataView === 'function' ? dataview : [],\n    typeof Intl !== 'undefined' ? intlTypes : []\n);\nexport default expObj;\n","import structuredCloning from './structured-cloning.js';\n\nexport default structuredCloning.concat({checkDataCloneException: [function (val) {\n    // Should also throw with:\n    // 1. `IsDetachedBuffer` (a process not called within the ECMAScript spec)\n    // 2. `IsCallable` (covered by `typeof === 'function'` or a function's `toStringTag`)\n    // 3. internal slots besides [[Prototype]] or [[Extensible]] (e.g., [[PromiseState]] or [[WeakMapData]])\n    // 4. exotic object (e.g., `Proxy`) (which does not have default behavior for one or more of the\n    //      essential internal methods that are limited to the following for non-function objects (we auto-exclude functions):\n    //      [[GetPrototypeOf]],[[SetPrototypeOf]],[[IsExtensible]],[[PreventExtensions]],[[GetOwnProperty]],\n    //      [[DefineOwnProperty]],[[HasProperty]],[[Get]],[[Set]],[[Delete]],[[OwnPropertyKeys]]);\n    //      except for the standard, built-in exotic objects, we'd need to know whether these methods had distinct behaviors\n    // Note: There is no apparent way for us to detect a `Proxy` and reject (Chrome at least is not rejecting anyways)\n    const stringTag = ({}.toString.call(val).slice(8, -1));\n    if (\n        [\n            'symbol', // Symbol's `toStringTag` is only \"Symbol\" for its initial value, so we check `typeof`\n            'function' // All functions including bound function exotic objects\n        ].includes(typeof val) ||\n        [\n            'Arguments', // A non-array exotic object\n            'Module', // A non-array exotic object\n            'Error', // `Error` and other errors have the [[ErrorData]] internal slot and give \"Error\"\n            'Promise', // Promise instances have an extra slot ([[PromiseState]]) but not throwing in Chrome `postMessage`\n            'WeakMap', // WeakMap instances have an extra slot ([[WeakMapData]]) but not throwing in Chrome `postMessage`\n            'WeakSet' // WeakSet instances have an extra slot ([[WeakSetData]]) but not throwing in Chrome `postMessage`\n        ].includes(stringTag) ||\n        val === Object.prototype || // A non-array exotic object but not throwing in Chrome `postMessage`\n        ((stringTag === 'Blob' || stringTag === 'File') && val.isClosed) ||\n        (val && typeof val === 'object' &&\n            // Duck-type DOM node objects (non-array exotic? objects which\n            //    cannot be cloned by the SCA)\n            typeof val.nodeType === 'number' &&\n            typeof val.insertBefore === 'function')\n    ) {\n        throw new DOMException('The object cannot be cloned.', 'DataCloneError');\n    }\n    return false;\n}]});\n","import builtin from './builtin.js';\n\nexport default [\n    builtin\n    // TODO: Add types that are de-facto universal even though not built-in into ecmasript standard.\n];\n","// This file is auto-generated from `build.js`\nimport Typeson from 'typeson';\n\n// TYPES\nimport arraybuffer from './types/arraybuffer.js';\nimport blob from './types/blob.js';\nimport cloneable from './types/cloneable.js';\nimport dataview from './types/dataview.js';\nimport date from './types/date.js';\nimport error from './types/error.js';\nimport errors from './types/errors.js';\nimport file from './types/file.js';\nimport filelist from './types/filelist.js';\nimport imagebitmap from './types/imagebitmap.js';\nimport imagedata from './types/imagedata.js';\nimport infinity from './types/infinity.js';\nimport intlTypes from './types/intl-types.js';\nimport map from './types/map.js';\nimport nan from './types/nan.js';\nimport negativeInfinity from './types/negative-infinity.js';\nimport nonbuiltinIgnore from './types/nonbuiltin-ignore.js';\nimport primitiveObjects from './types/primitive-objects.js';\nimport regexp from './types/regexp.js';\nimport resurrectable from './types/resurrectable.js';\nimport set from './types/set.js';\nimport typedArraysSocketio from './types/typed-arrays-socketio.js';\nimport typedArrays from './types/typed-arrays.js';\nimport undef from './types/undef.js';\nimport userObject from './types/user-object.js';\n\n// PRESETS\nimport builtin from './presets/builtin.js';\nimport postMessage from './presets/post-message.js';\nimport socketio from './presets/socketio.js';\nimport sparseUndefined from './presets/sparse-undefined.js';\nimport specialNumbers from './presets/special-numbers.js';\nimport structuredCloningThrowing from './presets/structured-cloning-throwing.js';\nimport structuredCloning from './presets/structured-cloning.js';\nimport undef2 from './presets/undef.js';\nimport universal from './presets/universal.js';\n\nTypeson.types = {\n    arraybuffer, blob, cloneable, dataview, date, error, errors, file, filelist,\n    imagebitmap, imagedata, infinity, intlTypes, map, nan, negativeInfinity,\n    nonbuiltinIgnore, primitiveObjects, regexp, resurrectable, set,\n    typedArraysSocketio, typedArrays, undef, userObject\n};\nTypeson.presets = {\n    builtin, postMessage, socketio, sparseUndefined, specialNumbers,\n    structuredCloningThrowing, structuredCloning, undef: undef2, universal\n};\n\nexport default Typeson;\n","/* eslint-env node */\n// Imperfectly polyfill jsdom for testing `Blob`/`File`\n// Todo: This can be removed once `URL.createObjectURL` may\n//    be implemented in jsdom: https://github.com/tmpvar/jsdom/issues/1721\n\n// These are not working well with Rollup as imports\nconst mod = typeof module !== 'undefined';\nconst uuid = mod && require('uuid/v4');\nconst whatwgURL = (mod && require('whatwg-url')) || {};\n// We also need to tweak `XMLHttpRequest` which our types\n//    rely on to obtain the Blob/File content\nconst utils = (mod && require('jsdom/lib/jsdom/living/generated/utils')) || {};\n\nconst {serializeURLOrigin, parseURL} = whatwgURL;\n\nconst blobURLs = {};\nconst createObjectURL = function (blob) {\n    // https://github.com/tmpvar/jsdom/issues/1721#issuecomment-282465529\n    const blobURL = 'blob:' + serializeURLOrigin(parseURL(location.href)) + '/' + uuid();\n    blobURLs[blobURL] = blob;\n    return blobURL;\n};\n\nconst impl = utils.implSymbol;\nconst _xhropen = XMLHttpRequest.prototype.open;\n\n// Add to XMLHttpRequest.prototype.open\nfunction xmlHttpRequestOpen (method, url, async) {\n    if ((/^blob:/).test(url)) {\n        const blob = blobURLs[url];\n        const type = 'text/plain'; // blob.type;\n        const utf16 = blob[impl]._buffer.toString('utf16le');\n        url = 'data:' + type + ',' + utf16;\n    }\n    return _xhropen.call(this, method, url, async);\n};\n\nexport {createObjectURL, xmlHttpRequestOpen};\n","/* eslint-env mocha, node */\n/* globals chai */\n\n// For Node (we put here as this is exported and to be usable externally in ES6 module syntax\n//     whereas the `test-node.js` file has not been converted to ES6)\nimport {createObjectURL, xmlHttpRequestOpen} from '../polyfills/createObjectURL.js';\nif (!URL.createObjectURL) {\n    URL.createObjectURL = createObjectURL;\n    XMLHttpRequest.prototype.open = xmlHttpRequestOpen;\n}\n\n// Setup Mocha and Chai\nmocha.setup({ui: 'bdd', timeout: 5000});\n\n// No means to set a `FileList` currently in jsdom so we\n//   make our own `FileList`; Todo: jsdom should really support this:\n//   https://github.com/tmpvar/jsdom/issues/1272\nconst glob = typeof module !== 'undefined' ? global : window;\nfunction FileList () {\n    this._files = arguments[0];\n    this.length = this._files.length;\n}\nFileList.prototype.item = function (index) {\n    return this._files[index];\n};\nFileList.prototype[Symbol.toStringTag] = 'FileList';\nObject.defineProperty(glob.HTMLInputElement.prototype, 'files', {\n    get: function () {\n        return new FileList(this._files);\n    },\n    set: function (val) {\n        this._files = val;\n    }\n});\nglob.FileList = FileList;\n\nglob.expect = chai.expect;\nglob.assert = chai.assert;\n\nexport default null; // Just add a placeholder for tests.js\n","function Person (name, age, dob, isMarried) {\n    name && (this.name = name);\n    age && (this.age = age);\n    dob && (this.dob = dob);\n    isMarried && (this.isMarried = isMarried);\n}\nPerson.prototype.name = '';\nPerson.prototype.age = 0;\nPerson.prototype.dob = new Date(1900, 0, 1);\nPerson.prototype.isMarried = false;\n\nfunction SimulatedNonBuiltIn () { this.aaa = 5; }\nSimulatedNonBuiltIn.prototype.bbb = 8;\nSimulatedNonBuiltIn.prototype[Symbol.toStringTag] = 'SimulatedNonBuiltIn';\n\nfunction MyCloneable (obj) {\n    this.obj = obj;\n    this.nonpersistentStateInfo = Math.random();\n}\nMyCloneable.prototype[Symbol.for('cloneEncapsulate')] = function () {\n    return {obj: JSON.stringify(this.obj)};\n};\nMyCloneable.prototype[Symbol.for('cloneRevive')] = function (encapsulatedMyCloneable) {\n    return new MyCloneable(JSON.parse(encapsulatedMyCloneable.obj));\n};\nMyCloneable.prototype.prototypeProperty = 10;\n\nfunction MyResurrectable () {}\n\nexport default {\n    Person,\n    SimulatedNonBuiltIn,\n    MyCloneable,\n    MyResurrectable\n};\n","/* eslint-env mocha */\n/* globals expect, assert, imageTestFileNode */\n/* eslint-disable no-unused-expressions */\nimport Typeson from '../index.js';\nimport testEnvironment from '../test/test-environment.js'; // eslint-disable-line no-unused-vars\nimport util from './test-utils.js';\n\nconst {\n    types: {\n        errors, typedArrays, intlTypes,\n        undef, primitiveObjects, nan, infinity,\n        negativeInfinity, date, error,\n        regexp, map, set, arraybuffer,\n        dataview, imagedata, imagebitmap,\n        blob, file, filelist, nonbuiltinIgnore,\n        userObject, cloneable, resurrectable\n    },\n    presets: {\n        builtin, universal, structuredCloningThrowing,\n        structuredCloning, specialNumbers, postMessage,\n        undef: undefPreset, sparseUndefined\n    }\n} = Typeson;\n\nfunction ErrorAndErrors (preset) {\n    describe('Error and Errors', () => {\n        it('should get back real Error instances corresponding to their types and with the original name and message', () => {\n            const typeson = new Typeson().register(preset || [error, errors]);\n            const json = typeson.stringify({\n                e1: new Error('Error1'),\n                e2: new TypeError('Error2'),\n                e3: new RangeError('Error3'),\n                e4: new SyntaxError('Error4'),\n                e5: new ReferenceError('Error5')\n                // , e6: new InternalError('Error6')\n            });\n            const obj = typeson.parse(json);\n            expect(obj.e1).to.be.an.instanceOf(Error);\n            expect(obj.e1.name).to.equal('Error');\n            expect(obj.e2).to.be.an.instanceOf(TypeError);\n            expect(obj.e2.name).to.equal('TypeError');\n            expect(obj.e3).to.be.an.instanceOf(RangeError);\n            expect(obj.e3.name).to.equal('RangeError');\n            expect(obj.e4).to.be.an.instanceOf(SyntaxError);\n            expect(obj.e4.name).to.equal('SyntaxError');\n            expect(obj.e5).to.be.an.instanceOf(ReferenceError);\n            expect(obj.e5.name).to.equal('ReferenceError');\n            // Non-standard\n            // expect(obj.e6).to.be.an.instanceOf(InternalError);\n            // expect(obj.e6.name).to.equal('InternalError');\n        });\n    });\n}\n\nfunction SpecialNumbers (preset) {\n    describe('Special numbers', () => {\n        it('NaN', () => {\n            const typeson = new Typeson().register(preset || nan);\n            const tson = typeson.stringify(NaN, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.be.NaN;\n        });\n        it('Infinity', () => {\n            const typeson = new Typeson().register(preset || infinity);\n            const tson = typeson.stringify(Infinity, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.equal(Infinity);\n        });\n        it('-Infinity', () => {\n            const typeson = new Typeson().register(preset || negativeInfinity);\n            const tson = typeson.stringify(-Infinity, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.equal(-Infinity);\n        });\n        it('should not mistake string forms of the special numbers', () => {\n            const typeson = new Typeson().register(preset || [\n                nan, infinity, negativeInfinity\n            ]);\n            let tson = typeson.stringify('NaN', null, 2);\n            let back = typeson.parse(tson);\n            expect(back).to.equal('NaN');\n            tson = typeson.stringify('Infinity', null, 2);\n            back = typeson.parse(tson);\n            expect(back).to.equal('Infinity');\n            tson = typeson.stringify('-Infinity', null, 2);\n            back = typeson.parse(tson);\n            expect(back).to.equal('-Infinity');\n        });\n        it('should not disturb encoding of normal numbers', () => {\n            const typeson = new Typeson().register(preset || [\n                nan, infinity, negativeInfinity\n            ]);\n            const tson = typeson.stringify(512, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.equal(512);\n        });\n    });\n}\n\nfunction Undefined (preset) {\n    describe('undefined type', () => {\n        it('should be possible to restore `undefined` properties', () => {\n            const typeson = new Typeson().register(preset || undef);\n            const a = [undefined, {b: undefined, c: [3, null, , undefined]}]; // eslint-disable-line no-sparse-arrays\n            const json = typeson.stringify(a);\n            const a2 = typeson.parse(json);\n            expect(a2.length).to.equal(2);\n            expect(a2[0]).to.equal(undefined);\n            expect(a2[1].b).to.equal(undefined);\n            expect('b' in a2[1]).to.be.true;\n            expect(a2[1].c[0]).to.equal(3);\n            expect(a2[1].c[1]).to.equal(null);\n            expect(a2[1].c[3]).to.equal(undefined);\n\n            expect('0' in a2).to.be.true;\n            expect('b' in a2[1]).to.be.true;\n            expect('1' in a2[1].c).to.be.true;\n            expect('3' in a2[1].c).to.be.true;\n\n            if (preset) {\n                expect(a2[1].c[2]).to.equal(undefined);\n                expect('2' in a2[1].c).to.be.false;\n            } else {\n                expect(a2[1].c[2]).to.not.equal(undefined);\n                expect(a2[1].c[2]).to.equal(null);\n                expect('2' in a2[1].c).to.be.true;\n            }\n        });\n\n        it('should be possible to restore `undefined` at root', () => {\n            const typeson = new Typeson().register(preset || undef);\n            const tson = typeson.stringify(undefined);\n            expect(tson).to.equal('{\"$\":null,\"$types\":{\"$\":{\"\":\"undef\"}}}');\n            const back = typeson.parse(tson);\n            expect(back).to.be.undefined;\n        });\n    });\n}\n\nfunction BuiltIn (preset) {\n    Undefined(preset);\n\n    describe('Primitive objects', () => {\n        it('String object', () => {\n            const typeson = new Typeson().register(preset || primitiveObjects);\n            const strObj = new String('hello'); // eslint-disable-line no-new-wrappers\n            const tson = typeson.stringify(strObj, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.be.an.instanceOf(String);\n            expect(back.valueOf()).to.equal('hello');\n            expect(back.length).to.equal(5);\n        });\n        it('Boolean object', () => {\n            const typeson = new Typeson().register(preset || primitiveObjects);\n            const strObj = new Boolean(true); // eslint-disable-line no-new-wrappers\n            const tson = typeson.stringify(strObj, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.be.an.instanceOf(Boolean);\n            expect(back.valueOf()).to.equal(true);\n        });\n        it('Number object', () => {\n            const typeson = new Typeson().register(preset || primitiveObjects);\n            const strObj = new Number(456); // eslint-disable-line no-new-wrappers\n            const tson = typeson.stringify(strObj, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.be.an.instanceOf(Number);\n            expect(back.valueOf()).to.equal(456);\n        });\n    });\n\n    SpecialNumbers();\n\n    describe('Date', () => {\n        it('should get back a real Date instance with the original time milliseconds', () => {\n            const typeson = new Typeson().register(preset || date);\n            const json = typeson.stringify(new Date(1234567));\n            const obj = typeson.parse(json);\n            expect(obj).to.be.an.instanceOf(Date);\n            expect(obj.getTime()).to.equal(1234567);\n        });\n        it('should get back a real invalid Date instance', () => {\n            const typeson = new Typeson().register(preset || date);\n            const json = typeson.stringify(new Date(NaN));\n            const obj = typeson.parse(json);\n            expect(obj).to.be.an.instanceOf(Date);\n            expect(obj.getTime()).to.be.NaN;\n        });\n    });\n\n    ErrorAndErrors(preset);\n\n    describe('RegExp', () => {\n        it('should return a RegExp', () => {\n            const typeson = new Typeson().register(preset || [regexp]);\n            let regex = new RegExp('ab?c', 'guy');\n            let tson = typeson.stringify(regex, null, 2);\n            let back = typeson.parse(tson);\n            expect(back instanceof RegExp);\n            expect(back.global).to.equal(true);\n            expect(back.unicode).to.equal(true);\n            expect(back.sticky).to.equal(true);\n            expect(back.ignoreCase).to.equal(false);\n            expect(back.multiline).to.equal(false);\n            expect(back.source).to.equal('ab?c');\n\n            regex = /ab?c/im;\n            tson = typeson.stringify(regex, null, 2);\n            back = typeson.parse(tson);\n            expect(back instanceof RegExp);\n            expect(back.global).to.equal(false);\n            expect(back.unicode).to.equal(false);\n            expect(back.sticky).to.equal(false);\n            expect(back.ignoreCase).to.equal(true);\n            expect(back.multiline).to.equal(true);\n            expect(back.source).to.equal('ab?c');\n        });\n    });\n\n    describe('Map', () => {\n        it('should get back a real Map instance with the original data and use complex types also in contained items', () => {\n            const typeson = new Typeson().register(preset || map);\n            const map1 = new Map();\n            const error = new Error('Error here'),\n                date = new Date(10000);\n\n            map1.set(error, date);\n            const json = typeson.stringify({m: map1});\n            const obj = typeson.parse(json);\n            expect(obj.m).to.be.an.instanceOf(Map);\n            if (preset) {\n                expect(Array.from(obj.m.keys())[0]).to.be.an.instanceOf(Error);\n                expect(Array.from(obj.m.values())[0]).to.be.an.instanceOf(Date);\n            }\n        });\n    });\n\n    describe('Set', () => {\n        it('should get back a real Set instance with the original data and use complex types also in contained items', () => {\n            const typeson = new Typeson().register(preset || set);\n            const set1 = new Set();\n            const error = new Error('Error here'),\n                date = new Date(10000),\n                str = '',\n                o = {\n                    a: error\n                };\n\n            set1.add(o);\n            set1.add(date);\n            set1.add(str);\n\n            const json = typeson.stringify({s: set1});\n            const obj = typeson.parse(json);\n\n            expect(obj.s).to.be.an.instanceOf(Set);\n\n            const a = Array.from(obj.s.values());\n            if (preset) {\n                expect(a[0].a).to.be.an.instanceOf(Error);\n                expect(a[1]).to.be.an.instanceOf(Date);\n            }\n            expect(a[2]).to.be.a('string');\n        });\n    });\n\n    describe('ArrayBuffer', () => {\n        it('should return an ArrayBuffer', () => {\n            const typeson = new Typeson().register(preset || [arraybuffer]);\n            const buf = new ArrayBuffer(16);\n            const tson = typeson.stringify(buf, null, 2);\n            const back = typeson.parse(tson);\n            expect(back instanceof ArrayBuffer);\n            expect(back.byteLength).to.equal(16);\n        });\n        it('should return the same ArrayBuffer instance', () => {\n            const typeson = new Typeson().register(preset || [arraybuffer]);\n            const buf1 = new ArrayBuffer(16);\n            const buf2 = buf1;\n            const obj = {\n                buf1,\n                buf2\n            };\n            const tson = typeson.stringify(obj, null, 2);\n            const back = typeson.parse(tson);\n            expect(back.buf1 instanceof ArrayBuffer);\n            expect(back.buf2 instanceof ArrayBuffer);\n            expect(back.buf1).to.equal(back.buf2);\n        });\n    });\n\n    describe('TypedArrays', () => {\n        describe('Float64Array', () => {\n            it('should get back real Float64Array instance with original array content', () => {\n                const typeson = new Typeson().register(preset || [\n                    arraybuffer,\n                    typedArrays\n                ]);\n                const a = new Float64Array(3);\n                a[0] = 23.8;\n                a[1] = -15;\n                a[2] = 99;\n                const json = typeson.stringify({a: a});\n                const obj = typeson.parse(json);\n                expect(obj.a).to.be.an.instanceOf(Float64Array);\n                expect(obj.a.length).to.equal(3);\n                expect(obj.a[0]).to.equal(23.8);\n                expect(obj.a[1]).to.equal(-15);\n                expect(obj.a[2]).to.equal(99);\n            });\n        });\n\n        describe('Uint16 arrays over invalid unicode range', () => {\n            it('should work to use any 16-bit number no matter whether it is invalid unicode or not', () => {\n                const typeson = new Typeson().register(preset || [\n                    arraybuffer,\n                    typedArrays\n                ]);\n                const a = new Uint16Array(0x0900);\n                let i = a.length;\n                while (i--) a[i] = i + 0xd780;\n                let json = typeson.stringify({a: a});\n                // console.log(json);\n\n                // Emulate a textencoder that eliminates invalid UTF chars\n                i = json.length;\n                const copy = new Uint16Array(i);\n                while (i--) {\n                    const ch = json.charCodeAt(i);\n                    copy[i] = ch >= 0xd800 && ch < 0xe000 ? 0xfffd : ch;\n                }\n                json = String.fromCharCode.apply(null, copy);\n\n                const obj = typeson.parse(json);\n                expect(obj.a).to.be.an.instanceOf(Uint16Array);\n                expect(obj.a.length).to.equal(a.length);\n                obj.a.forEach((x, i) => {\n                    expect(x).to.equal(i + 0xd780);\n                });\n            });\n        });\n\n        describe('Int8 arrays with odd length', () => {\n            it('should be possible to use an odd length of an Int8Array', () => {\n                const typeson = new Typeson().register(preset || [\n                    arraybuffer,\n                    typedArrays\n                ]);\n                const a = new Int8Array(3);\n                a[0] = 0;\n                a[1] = 1;\n                a[2] = 2;\n                const json = typeson.stringify(a);\n                // console.log(json);\n                const a2 = typeson.parse(json);\n                expect(a2.length).to.equal(3);\n                expect(a2[0]).to.equal(0);\n                expect(a2[1]).to.equal(1);\n                expect(a2[2]).to.equal(2);\n            });\n        });\n\n        describe('Uint8 arrays with shared buffer object', () => {\n            it('should return the same buffer object from different wrappers (or data views or buffer itself)', () => {\n                const typeson = new Typeson().register(preset || [\n                    arraybuffer,\n                    typedArrays,\n                    dataview\n                ]);\n                const shared = new ArrayBuffer(7);\n                const dataView = new DataView(shared, 3, 4);\n                const obj = {\n                    wrapper1: new Uint8Array(shared),\n                    wrapper2: new Uint16Array(shared, 2, 2),\n                    buffer: shared,\n                    dataView\n                };\n                obj.wrapper1[0] = 1;\n                obj.wrapper2[1] = 0xffff;\n\n                const json = typeson.stringify(obj);\n                // console.log(json);\n                const obj2 = typeson.parse(json);\n                expect(obj2.wrapper1.buffer).to.equal(obj2.wrapper2.buffer);\n                expect(obj2.wrapper1.buffer).to.equal(obj2.buffer);\n                expect(obj2.wrapper1.buffer).to.equal(obj2.dataView.buffer);\n            });\n        });\n    });\n\n    /*\n    // TODO: Add for typed-arrays-socketio\n    describe('TypedArrays Socket-IO', () => {\n    });\n    */\n\n    describe('DataView', () => {\n        it('should return a DataView', () => {\n            const typeson = new Typeson().register(preset || [dataview]);\n            const sample = [0x44, 0x33, 0x22, 0x11, 0xFF, 0xEE, 0xDD, 0xCC];\n            const buffer = new Uint8Array(sample).buffer;\n            const dataView = new DataView(buffer, 3, 4);\n            expect(dataView.byteLength).to.equal(4);\n            const tson = typeson.stringify(dataView, null, 2);\n            const back = typeson.parse(tson);\n            expect(back).to.be.an.instanceOf(DataView);\n            expect(back.byteLength).to.equal(4);\n        });\n        it('should reproduce DataView with the same buffer', () => {\n            const typeson = new Typeson().register(preset || [dataview]);\n            const sample = [0x44, 0x33, 0x22, 0x11, 0xFF, 0xEE, 0xDD, 0xCC];\n            const buffer = new Uint8Array(sample).buffer;\n            const dataView1 = new DataView(buffer, 3, 4);\n            const dataView2 = new DataView(buffer, 3, 4);\n            const dataView3 = new DataView(buffer, 3, 4);\n\n            const obj = {\n                dataView1,\n                dataView2,\n                dataView3\n            };\n\n            const tson = typeson.stringify(obj, null, 2);\n            const back = typeson.parse(tson);\n            expect(back.dataView1).to.be.an.instanceOf(DataView);\n            expect(back.dataView2).to.be.an.instanceOf(DataView);\n            expect(back.dataView3).to.be.an.instanceOf(DataView);\n            expect(back.dataView1.byteLength).to.equal(4);\n        });\n    });\n\n    describe('Intl types', () => {\n        it('should return a Intl.Collator', () => {\n            const typeson = new Typeson().register(preset || [intlTypes]);\n            // After `-u-`, the values don't appear to be validated in Node or Chrome\n            const locales = ['en', 'hi', 'de-AT', 'de-DE-u-co-phonebk', 'en-US-u-kn-true', 'en-US-u-kf-upper'];\n            const opts = {\n                localeMatcher: 'lookup',\n                usage: 'search',\n                sensitivity: 'base',\n                ignorePunctuation: true,\n                numeric: true,\n                caseFirst: 'upper'\n            };\n            const optsClone = JSON.parse(JSON.stringify(opts));\n\n            const collator = new Intl.Collator(locales, opts);\n            const expectedLocale = collator.resolvedOptions().locale;\n            const tson = typeson.stringify(collator, null, 2);\n            const back = typeson.parse(tson);\n            expect(back instanceof Intl.Collator);\n            // console.log(Intl.Collator.supportedLocalesOf(Object.keys(optsClone.locales), optsClone.localeMatcher));\n\n            expect(back.resolvedOptions().locale).to.deep.equal(expectedLocale);\n\n            Object.keys(optsClone).filter(\n                (k) => ![\n                    // These would ideally be present but are not available for inspection\n                    'localeMatcher', 'locales'\n                ].includes(k)\n            ).forEach((prop) => {\n                expect(back.resolvedOptions()[prop]).to.deep.equal(optsClone[prop]);\n            });\n        });\n        it('should return a Intl.DateTimeFormat', () => {\n            const typeson = new Typeson().register(preset || [intlTypes]);\n            const locales = ['hi', 'de-AT', 'de-DE-u-nu-latn', 'en-US-u-ca-persian'];\n            const opts = {\n                localeMatcher: 'lookup',\n                timeZone: 'Asia/Shanghai',\n                hour12: false,\n                formatMatcher: 'basic'\n            };\n            const optsClone = JSON.parse(JSON.stringify(opts));\n\n            const dtf = new Intl.DateTimeFormat(locales, opts);\n            const tson = typeson.stringify(dtf, null, 2);\n            const back = typeson.parse(tson);\n            expect(back instanceof Intl.DateTimeFormat);\n            Object.keys(optsClone).filter(\n                (k) => ![\n                    // These would ideally be present but are not available for inspection\n                    'localeMatcher', 'locales', 'formatMatcher',\n                    'hour12' // Not currently working in Node or Chrome\n                ].includes(k)\n            ).forEach((prop) => {\n                expect(back.resolvedOptions()[prop]).to.deep.equal(optsClone[prop]);\n            });\n        });\n        it('should return a Intl.NumberFormat', () => {\n            const typeson = new Typeson().register(preset || [intlTypes]);\n            const locales = ['hi', 'de-AT', 'de-DE-u-nu-bali'];\n            const opts = {\n                localeMatcher: 'lookup',\n                style: 'currency',\n                currency: 'EUR',\n                currencyDisplay: 'symbol',\n                useGrouping: false\n            };\n            const optsClone = JSON.parse(JSON.stringify(opts));\n\n            const dtf = new Intl.NumberFormat(locales, opts);\n            const tson = typeson.stringify(dtf, null, 2);\n            const back = typeson.parse(tson);\n            expect(back instanceof Intl.NumberFormat);\n            Object.keys(optsClone).filter(\n                (k) => ![\n                    // These would ideally be present but are not available for inspection\n                    'localeMatcher', 'locales'\n                ].includes(k)\n            ).forEach((prop) => {\n                expect(back.resolvedOptions()[prop]).to.deep.equal(optsClone[prop]);\n            });\n        });\n    });\n}\ndescribe('Built-in', BuiltIn);\n\ndescribe('ImageData', () => {\n    it('should get back an ImageData instance with the original data', () => {\n        const typeson = new Typeson().register(imagedata);\n        const imageData = new ImageData(1, 3);\n        const tson = typeson.stringify(imageData);\n        const back = typeson.parse(tson);\n        expect(back.width).to.equal(1);\n        expect(back.height).to.equal(3);\n        expect(back.data).to.deep.equal(new Uint8ClampedArray(12));\n    });\n});\n\ndescribe('ImageBitmap', () => {\n    it('should get back an ImageBitmap instance with the original data', (done) => {\n        const typeson = new Typeson().register(imagebitmap);\n\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        const img = document.createElement('img');\n        // The onload is needed by some browsers per http://stackoverflow.com/a/4776378/271577\n        img.onload = () => {\n            ctx.drawImage(img, 0, 0);\n            createImageBitmap(canvas).then((imageBitmap) => {\n                const tson = typeson.stringify(imageBitmap);\n                return typeson.parse(tson);\n            }).then((back) => {\n                expect(back.width).to.equal(300 /* img.width */);\n                expect(back.height).to.equal(150 /* img.height */);\n\n                const canvas = document.createElement('canvas');\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(back, 0, 0);\n                // Not getting a URL that is displaying properly or exactly consistent between Node/browser\n                try { // Node\n                    expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg=='\n                    );\n                } catch (err) {\n                    try { // Chrome\n                        expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC');\n                    } catch (err) { // Firefox\n                        expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=');\n                    }\n                }\n                done();\n            });\n        };\n        // Didn't work with a relative path nor with an SVG file in node-canvas\n        img.src = typeof imageTestFileNode !== 'undefined' ? imageTestFileNode : '../test/Flag_of_the_United_Nations.png'; // browserify-test uses testem which assumes cwd() resolution (in `Config.prototype.resolvePath` of `node_modules/testem/lib/config.js`)\n    });\n    it('should get back an ImageBitmap instance with the original data asynchronously', (done) => {\n        const typeson = new Typeson().register(imagebitmap);\n\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n        const img = document.createElement('img');\n        // The onload is needed by some browsers per http://stackoverflow.com/a/4776378/271577\n        img.onload = () => {\n            ctx.drawImage(img, 0, 0);\n\n            createImageBitmap(canvas).then((imageBitmap) => {\n                const tson = typeson.stringify(imageBitmap);\n                return typeson.parseAsync(tson);\n            }).then((back) => {\n                expect(back.width).to.equal(300); // img.width\n                expect(back.height).to.equal(150); // img.height\n\n                const canvas = document.createElement('canvas');\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(back, 0, 0);\n                // Not getting a URL that is displaying properly or exactly consistent between Node/browser\n                try { // Node\n                    expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAABmJLR0QA/wD/AP+gvaeTAAACC0lEQVR4nO3UQQ3AIADAwDF7uMMeYpiF/UiTOwV9dcy1zwMQ8N4OAPjLsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwgw7CADMMCMgwLyDAsIMOwgAzDAjIMC8gwLCDDsIAMwwIyDAvIMCwg4wMLwgPj2swUCwAAAABJRU5ErkJggg=='\n                    );\n                } catch (err) {\n                    try { // Chrome\n                        expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAEYklEQVR4Xu3UAQkAAAwCwdm/9HI83BLIOdw5AgQIRAQWySkmAQIEzmB5AgIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlAABg+UHCBDICBisTFWCEiBgsPwAAQIZAYOVqUpQAgQMlh8gQCAjYLAyVQlKgIDB8gMECGQEDFamKkEJEDBYfoAAgYyAwcpUJSgBAgbLDxAgkBEwWJmqBCVAwGD5AQIEMgIGK1OVoAQIGCw/QIBARsBgZaoSlACBB1YxAJfjJb2jAAAAAElFTkSuQmCC');\n                    } catch (err) { // Firefox\n                        expect(canvas.toDataURL()).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAxUlEQVR4nO3BMQEAAADCoPVPbQhfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOA1v9QAATX68/0AAAAASUVORK5CYII=');\n                    }\n                }\n                done();\n            });\n        };\n        // Didn't work with a relative path nor with an SVG file in node-canvas\n        img.src = typeof imageTestFileNode !== 'undefined' ? imageTestFileNode : '../test/Flag_of_the_United_Nations.png'; // browserify-test uses testem which assumes cwd() resolution (in `Config.prototype.resolvePath` of `node_modules/testem/lib/config.js`)\n    });\n});\n\ndescribe('Blob', function () {\n    it('should get back a Blob instance with the original data', function (done) {\n        this.timeout(10000);\n        const typeson = new Typeson().register(blob);\n        const contentType = 'application/json';\n        const stringContents = JSON.stringify('abc\\u1234');\n\n        const blob1 = new Blob([\n            // BufferSource (ArrayBufferView (Int8Array, etc. or DataView) or ArrayBuffer), Blob, or USVString (strings without unpaired surrogates)\n            stringContents\n        ],\n        {\n            type: contentType // DOMString\n        });\n        const tson = typeson.stringify(blob1);\n        const back = typeson.parse(tson);\n\n        expect(back.type).to.equal(contentType);\n        expect('name' in back).to.be.false; // No file properties\n        expect('lastModified' in back).to.be.false; // No file properties\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n            expect(reader.result).to.equal(stringContents);\n            done();\n        });\n        reader.addEventListener('error', () => {\n            assert(false, 'FileReader should not err');\n        });\n        reader.readAsText(back);\n    });\n    it('should get back a Blob instance with the original data asynchronously', (done) => {\n        const typeson = new Typeson().register(blob);\n        const contentType = 'application/json';\n        const stringContents = JSON.stringify('abc\\u1234');\n\n        const blob1 = new Blob([\n            // BufferSource (ArrayBufferView (Int8Array, etc. or DataView) or ArrayBuffer), Blob, or USVString (strings without unpaired surrogates)\n            stringContents\n        ],\n        {\n            type: contentType // DOMString\n        });\n        typeson.stringifyAsync(blob1).then((tson) => {\n            const back = typeson.parse(tson);\n            expect(back.type).to.equal(contentType);\n            expect('name' in back).to.be.false; // No file properties\n            expect('lastModified' in back).to.be.false; // No file properties\n            const reader = new FileReader();\n            reader.addEventListener('load', () => {\n                expect(reader.result).to.equal(stringContents);\n                done();\n            });\n            reader.addEventListener('error', () => {\n                assert(false, 'FileReader should not err');\n            });\n            reader.readAsText(back);\n        });\n    });\n    it('Handle large (typed array) Blobs', function (done) {\n        this.timeout(10000);\n        function largeValue (size, seed) {\n            const buffer = new Uint8Array(size);\n            // 32-bit xorshift - must be non-zero seed\n            let state = 1000 + seed;\n            for (let i = 0; i < size; ++i) {\n                state ^= state << 13;\n                state ^= state >> 17;\n                state ^= state << 5;\n                buffer[i] = state & 0xff;\n            }\n            return buffer;\n        }\n\n        const typeson = new Typeson().register(blob);\n        const largeVal = 131072;\n        const b5 = new Blob([largeValue(largeVal, 1)], {type: 'text/x-blink-1'});\n        const t5 = typeson.stringify(b5);\n        const tback = typeson.parse(t5);\n        expect(tback.size, 'Sync large val').to.equal(largeVal);\n\n        const b6 = new Blob([largeValue(largeVal, 1)], {type: 'text/x-blink-1'});\n        typeson.stringifyAsync(b6).then((t6) => {\n            const tback = typeson.parse(t6);\n            expect(tback.size, 'Async large val').to.equal(largeVal);\n            done();\n        });\n    });\n});\n\ndescribe('File', function () {\n    this.timeout(10000);\n    it('should get back a File instance with the original data', (done) => {\n        const typeson = new Typeson().register(file);\n        const currTime = new Date();\n        const contentType = 'application/json';\n        const fileName = 'aName';\n        const stringContents = JSON.stringify('abc\\u1234');\n        const file1 = new File([\n            // BufferSource (ArrayBufferView (Int8Array, etc. or DataView) or ArrayBuffer), Blob, or USVString (strings without unpaired surrogates)\n            stringContents\n        ],\n        fileName, // USVString (strings without unpaired surrogates)\n        {\n            type: contentType, // DOMString\n            lastModified: currTime // Or number\n        });\n        const tson = typeson.stringify(file1);\n        const back = typeson.parse(tson);\n        expect(back.lastModified).to.equal(currTime.getTime());\n        expect(back.type).to.equal(contentType);\n        expect(back.name).to.equal(fileName);\n        const reader = new FileReader();\n        reader.addEventListener('load', () => {\n            expect(reader.result).to.equal(stringContents);\n            done();\n        });\n        reader.addEventListener('error', () => {\n            assert(false, 'FileReader should not err');\n        });\n        reader.readAsText(back);\n    });\n    it('should get back a File instance with the original data asynchronously', (done) => {\n        const typeson = new Typeson().register(file);\n        const currTime = new Date();\n        const contentType = 'application/json';\n        const fileName = 'aName';\n        const stringContents = JSON.stringify('abc\\u1234');\n        const file1 = new File([\n            // BufferSource (ArrayBufferView (Int8Array, etc. or DataView) or ArrayBuffer), Blob, or USVString (strings without unpaired surrogates)\n            stringContents\n        ],\n        fileName, // USVString (strings without unpaired surrogates)\n        {\n            type: contentType, // DOMString\n            lastModified: currTime // Or number\n        });\n        typeson.stringifyAsync(file1).then((tson) => {\n            const back = typeson.parse(tson);\n            expect(back.lastModified).to.equal(currTime.getTime());\n            expect(back.type).to.equal(contentType);\n            expect(back.name).to.equal(fileName);\n            const reader = new FileReader();\n            reader.addEventListener('load', () => {\n                expect(reader.result).to.equal(stringContents);\n                done();\n            });\n            reader.addEventListener('error', () => {\n                assert(false, 'FileReader should not err');\n            });\n            reader.readAsText(back);\n        });\n    });\n});\n\ndescribe('FileList', function () {\n    this.timeout(10000);\n    it('should get back a FileList instance with the original data', () => {\n        const currTime = new Date();\n        const anotherTime = new Date('1985');\n\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.files = [ // See the test-environment for our adapter to make this settable\n            new File([\n                'content1'\n            ],\n            'abc',\n            {\n                type: 'text/plain', // DOMString\n                lastModified: currTime // Or number\n            }),\n            new File([\n                'content2'\n            ],\n            'def',\n            {\n                type: 'text/html', // DOMString\n                lastModified: anotherTime // Or number\n            })\n        ];\n\n        expect(input.files).to.be.an.instanceOf(FileList);\n        const typeson = new Typeson().register(filelist);\n        const tson = typeson.stringify(input.files);\n        const back = typeson.parse(tson);\n        expect(back.item(0)).to.be.an.instanceOf(File);\n        expect(back.item(0).lastModified).to.equal(currTime.getTime());\n        expect(back.item(0).type).to.equal('text/plain');\n        expect(back.item(0).name).to.equal('abc');\n        expect(back.item(1)).to.be.an.instanceOf(File);\n        expect(back.item(1).lastModified).to.equal(anotherTime.getTime());\n        expect(back.item(1).type).to.equal('text/html');\n        expect(back.item(1).name).to.equal('def');\n    });\n    it('should get back a FileList instance with the original data asynchronously', () => {\n        const currTime = new Date();\n        const anotherTime = new Date('1985');\n\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.files = [ // See the test-environment for our adapter to make this settable\n            new File([\n                'content1'\n            ],\n            'abc',\n            {\n                type: 'text/plain', // DOMString\n                lastModified: currTime // Or number\n            }),\n            new File([\n                'content2'\n            ],\n            'def',\n            {\n                type: 'text/html', // DOMString\n                lastModified: anotherTime // Or number\n            })\n        ];\n\n        expect(input.files).to.be.an.instanceOf(FileList);\n        const typeson = new Typeson().register(filelist);\n        typeson.stringifyAsync(input.files).then((tson) => {\n            const back = typeson.parse(tson);\n            expect(back.item(0)).to.be.an.instanceOf(File);\n            expect(back.item(0).lastModified).to.equal(currTime.getTime());\n            expect(back.item(0).type).to.equal('text/plain');\n            expect(back.item(0).name).to.equal('abc');\n            expect(back.item(1)).to.be.an.instanceOf(File);\n            expect(back.item(1).lastModified).to.equal(anotherTime.getTime());\n            expect(back.item(1).type).to.equal('text/html');\n            expect(back.item(1).name).to.equal('def');\n        });\n    });\n});\n\ndescribe('Non-built-in object ignoring', () => {\n    it('should ignore non-built-in objects (simulated)', () => {\n        const typeson = new Typeson().register(nonbuiltinIgnore);\n        const john = new util.Person('John Doe');\n        const simulatedNonBuiltInObject = new util.SimulatedNonBuiltIn();\n        const tson = typeson.stringify({a: john, b: simulatedNonBuiltInObject});\n        const back = typeson.parse(tson);\n        expect(back).to.deep.equal({\n            a: {name: 'John Doe'}\n        });\n        const a = typeson.encapsulate(['a', simulatedNonBuiltInObject, 5, null]);\n        expect('0' in a).to.be.true;\n        expect('1' in a).to.be.false;\n        expect('2' in a).to.be.true;\n        expect('3' in a).to.be.true;\n    });\n});\n\ndescribe('User objects', () => {\n    it('should do recursive type checking on user instantiated objects', () => {\n        const typeson = new Typeson()\n            .register([userObject, date]);\n        const bob = new util.Person('Bob Smith', 30, new Date(2000, 5, 20), true);\n\n        const simulatedNonBuiltInObject = new util.SimulatedNonBuiltIn();\n        simulatedNonBuiltInObject.prop = 500;\n        const tson = typeson.stringify({a: bob, b: simulatedNonBuiltInObject});\n        const back = typeson.parse(tson);\n        expect(back).to.deep.equal({\n            a: {name: 'Bob Smith', age: 30, dob: new Date(2000, 5, 20), isMarried: true},\n            b: {aaa: 5, prop: 500}\n        });\n        expect('dob' in back.a).to.be.true;\n    });\n    it('should work with nonbuiltin-ignore', () => {\n        const typeson = new Typeson().register([\n            userObject,\n            nonbuiltinIgnore\n        ]);\n        const bob = new util.Person('Bob Smith', 30, new Date(2000, 5, 20), true);\n        bob.nonbuiltin = new util.SimulatedNonBuiltIn();\n        const simulatedNonBuiltInObject = new util.SimulatedNonBuiltIn();\n        const tson = typeson.stringify({a: bob, b: simulatedNonBuiltInObject});\n        const back = typeson.parse(tson);\n        expect(back).to.deep.equal({\n            a: {name: 'Bob Smith', age: 30, isMarried: true, dob: new Date(2000, 5, 20).toJSON()}\n        });\n        expect('nonbuiltin' in back.a).to.be.false;\n    });\n});\n\ndescribe('Cloneables', () => {\n    it('Should work with custom cloneable objects', () => {\n        const typeson = new Typeson().register(cloneable);\n        const objArg = {a: 1, b: 2};\n        const mc = new util.MyCloneable(objArg);\n        const originalNonpersistentStateInfo = mc.nonpersistentStateInfo;\n\n        const encapsulated = typeson.encapsulate(mc);\n        expect(mc[Symbol.for('cloneEncapsulate')]()).to.deep.equal({obj: JSON.stringify(objArg)});\n        expect('nonpersistentStateInfo' in encapsulated).to.be.false;\n        expect('prototypeProperty' in encapsulated).to.be.false;\n\n        const tson = JSON.stringify(encapsulated);\n        const back = typeson.parse(tson);\n\n        expect(back).to.be.an.instanceOf(util.MyCloneable);\n        expect(back).to.not.equal(mc);\n        expect(back.obj).to.deep.equal(objArg);\n        expect(back.hasOwnProperty('nonpersistentStateInfo')).to.be.true;\n        expect(back.nonpersistentStateInfo).to.not.equal(originalNonpersistentStateInfo);\n        expect('prototypeProperty' in back).to.be.true;\n        expect(back.hasOwnProperty('prototypeProperty')).to.be.false;\n    });\n});\n\ndescribe('Resurrectables', () => {\n    it('Should work with custom resurrectable objects', () => {\n        const typeson = new Typeson().register(resurrectable);\n        const mr = new util.MyResurrectable();\n        const mr2 = function resurrectableFunction () {};\n        const mr3 = Symbol('resurrectable');\n        const mr4 = {};\n        const mr5 = [3, 4, 5];\n\n        const encapsulated = typeson.encapsulate([mr, mr2, mr3, mr4, mr5]);\n        const tson = JSON.stringify(encapsulated);\n        const back = typeson.parse(tson);\n\n        expect(back[0]).to.equal(mr);\n        expect(back[1]).to.equal(mr2);\n        expect(back[2]).to.equal(mr3);\n        expect(back[3]).to.not.equal(mr4);\n        expect(back[4]).to.not.equal(mr5);\n    });\n});\n\ndescribe('Presets', () => {\n    describe('Built-in (as preset)', () => {\n        BuiltIn([builtin]);\n    });\n\n    // TODO: Could add a shimmed postMessage test though covered by worker test\n    describe('postMessage', () => {\n        ErrorAndErrors([postMessage]);\n    });\n\n    describe('Universal', () => {\n        BuiltIn([universal]);\n    });\n    describe('Structured cloning', () => {\n        it('should work with Structured cloning with throwing', () => {\n            const typeson = new Typeson().register([structuredCloningThrowing]);\n            let caught = false;\n            try {\n                typeson.stringify(new Error('test'));\n            } catch (err) {\n                caught = true;\n            }\n            assert(caught, 'Caught error');\n            const expected = '{\"$\":1234567890000,\"$types\":{\"$\":{\"\":\"date\"}}}';\n            const result = typeson.stringify(new Date(1234567890000));\n            expect(result).to.deep.equal(expected);\n        });\n        it('should work with Structured cloning without throwing', () => {\n            const typeson = new Typeson().register([structuredCloning]);\n            let caught = false;\n            try {\n                typeson.stringify(new Error('test'));\n            } catch (err) {\n                console.log(err);\n                caught = true;\n            }\n            assert(!caught, 'Did not catch error');\n            const expected = '{\"$\":1234567890000,\"$types\":{\"$\":{\"\":\"date\"}}}';\n            const result = typeson.stringify(new Date(1234567890000));\n            expect(result).to.deep.equal(expected);\n        });\n        it('should allow recursive type checking on user instantiated objects', () => {\n            const typeson = new Typeson().register([structuredCloning]);\n            const john = new util.Person('John Doe');\n            const bob = new util.Person('Bob Smith', 30, new Date(2000, 5, 20), true);\n\n            const clonedData = typeson.parse(typeson.stringify([john, bob]));\n            expect(clonedData).to.have.same.deep.members([\n                {name: 'John Doe'},\n                {name: 'Bob Smith', dob: new Date(2000, 5, 20), age: 30, isMarried: true}\n            ]);\n        });\n        it('should work with recursive structures', () => {\n            const typeson = new Typeson().register(structuredCloningThrowing);\n            const obj = [];\n            obj.push(obj);\n            const clonedData = typeson.parse(typeson.stringify(obj));\n            expect(clonedData[0]).to.equal(clonedData);\n        });\n    });\n    describe('Special Numbers (as preset)', () => {\n        SpecialNumbers([specialNumbers]);\n    });\n\n    // TODO: Add test for socketio\n\n    describe('Undefined (as preset)', () => {\n        Undefined([undefPreset]);\n    });\n\n    describe('Sparse undefined', () => {\n        it('should be possible to restore `undefined` properties', () => {\n            const typeson = new Typeson().register([sparseUndefined]);\n            const a = [undefined, {b: undefined, c: [3, null, , undefined]}]; // eslint-disable-line no-sparse-arrays\n            const json = typeson.stringify(a);\n            const a2 = typeson.parse(json);\n            expect(a2.length).to.equal(2);\n            expect(a2[0]).to.equal(null);\n            expect('b' in a2[1]).to.be.false;\n            expect(a2[1].c[0]).to.equal(3);\n            expect(a2[1].c[1]).to.equal(null);\n            expect(a2[1].c[2]).to.equal(undefined);\n            expect('2' in a2[1].c).to.be.false;\n            expect(a2[1].c[3]).to.equal(null);\n        });\n    });\n});\n\nmocha.run();\n"],"names":["keys","Object","isArray","Array","toString","getProto","getPrototypeOf","hasOwn","hasOwnProperty","fnToString","internalStateObjPropsToIgnore","isThenable","v","catchCheck","Typeson","isObject","then","catch","toStringTag","val","call","slice","hasConstructorOf","a","b","proto","Ctor","constructor","isPlainObject","options","plainObjectReplacers","nonplainObjectReplacers","revivers","regTypes","this","types","stringify","obj","replacer","space","opts","assign","stringification","encapsulated","encapsulate","JSON","res","stringifySync","throwOnBadSyncType","sync","stringifyAsync","parse","text","reviver","revive","parseSync","parseAsync","specialTypeNames","stateObj","returnTypeNames","rootTypeName","iterateNone","refObjs","cyclic","encapsulateObserver","ret","_encapsulate","promisesDataRoot","finish","typeNames","values","length","getJSONType","Set","$types","$","TypeError","Promise","resolve","checkPromises","promisesData","all","map","pd","p","promResults","promResult","newPromisesData","prData","splice","keyPath","parentObj","key","detectedType","encaps","isTypesonPromise","TypesonPromise","encaps2","_adaptBuiltinStateObjectProperties","ownKeysObj","cb","vals","prop","tmp","forEach","i","keypath","value","resolvingTypesonPromise","observerData","$typeof","runObserver","type","undefined","string","boolean","number","isNaN","Infinity","replace","replaced","iterateIn","iterateUnsetNumeric","refIndex","indexOf","refKeys","push","isPlainObj","isArr","clone","ownKeys","kp","escapeKeyPathComponent","endIterateIn","end","endIterateOwn","vl","endIterateUnsetNumeric","plainObject","replacers","test","existing","concat","replaceAsync","replacing","typeDetected","encapsulateSync","encapsulateAsync","ignore$Types","keyPathResolutions","_revive","target","Undefined","getByKeyPath","substr","reduce","Error","reviveAsync","reviveSync","register","typeSpecSets","R","typeSpec","typeId","JSON_TYPES","includes","spec","testPlainObjects","existingReplacer","filter","r","Class","x","create","prototype","replacerObj","bind","start","fallback","reviverObj","t","s","k","keyPathComponent","unescapeKeyPathComponent","period","innerObj","f","onFulfilled","onRejected","typesonResolve","typesonReject","reject","meth","promArr","prom","isUserObject","chars","lookup","Uint8Array","charCodeAt","encode","arraybuffer","byteOffset","bytes","len","base64","substring","decode","bufferLength","encoded1","encoded2","encoded3","encoded4","ArrayBuffer","buffers","index","b64","buffer","string2arraybuffer","str","array","Uint16Array","req","XMLHttpRequest","open","URL","createObjectURL","TextEncoder","overrideMimeType","status","send","responseText","stringContents","Blob","isClosed","reader","FileReader","addEventListener","result","error","readAsText","cloneableObjectsByUUID","Symbol","for","cloneable","uuid","generateUUID","d","Date","getTime","performance","now","c","Math","random","floor","byteLength","b64Obj","encoded","DataView","date","time","NaN","name","message","e","_global","self","global","exportObj","errName","toLowerCase","lastModified","File","file","fl","arr","item","o","FileList","_files","arguments","dataset","bm","canvas","document","createElement","getContext","drawImage","toDataURL","ctx","img","onload","src","createImageBitmap","from","data","width","height","ImageData","Uint8ClampedArray","n","Intl","Collator","resolvedOptions","locale","DateTimeFormat","dtf","NumberFormat","nf","entries","Map","rexp","String","Boolean","Number","source","ignoreCase","multiline","sticky","unicode","flags","RegExp","resurrectableObjectsByUUID","resurrectable","serializedResurrectable","set","typeName","arrType","TypedArray","buf","sparseUndefined","undef","expObj","presetUndefined","primitiveObjects","specialNumbers","errors","regexp","typedArrays","dataview","intlTypes","typedArraysSocketIO","userObject","imagedata","imagebitmap","filelist","blob","structuredCloning","checkDataCloneException","stringTag","nodeType","insertBefore","DOMException","builtin","infinity","nan","negativeInfinity","presets","postMessage","socketio","undef2","universal","mod","module","require","whatwgURL","utils","serializeURLOrigin","parseURL","blobURLs","impl","implSymbol","_xhropen","blobURL","location","href","xmlHttpRequestOpen","method","url","async","_buffer","mocha","setup","ui","timeout","glob","window","Person","age","dob","isMarried","SimulatedNonBuiltIn","aaa","MyCloneable","nonpersistentStateInfo","defineProperty","HTMLInputElement","expect","chai","assert","bbb","encapsulatedMyCloneable","prototypeProperty","MyResurrectable","nonbuiltinIgnore","structuredCloningThrowing","undefPreset","ErrorAndErrors","preset","typeson","json","RangeError","SyntaxError","ReferenceError","e1","to","be","an","instanceOf","equal","e2","e3","e4","e5","SpecialNumbers","tson","back","a2","true","false","not","BuiltIn","strObj","valueOf","regex","map1","m","set1","add","buf1","buf2","Float64Array","copy","ch","fromCharCode","apply","Int8Array","shared","dataView","wrapper1","wrapper2","obj2","dataView1","dataView2","dataView3","optsClone","collator","expectedLocale","deep","describe","imageData","done","imageBitmap","err","imageTestFileNode","blob1","largeValue","size","seed","state","b5","t5","tback","b6","t6","currTime","file1","anotherTime","input","files","john","util","simulatedNonBuiltInObject","bob","nonbuiltin","toJSON","objArg","mc","originalNonpersistentStateInfo","mr","mr2","resurrectableFunction","mr3","mr4","mr5","caught","log","clonedData","have","same","members","run"],"mappings":"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"}