{"version":3,"file":"createObjectURL-polyglot.js","sources":["createObjectURL.js"],"sourcesContent":["/* eslint-env node */\n// Imperfectly polyfill jsdom for testing `Blob`/`File`\n// Todo: This can be removed once `URL.createObjectURL` may\n//    be implemented in jsdom: https://github.com/tmpvar/jsdom/issues/1721\n\n// These are not working well with Rollup as imports\nconst mod = typeof module !== 'undefined';\nconst uuid = mod && require('uuid/v4');\nconst whatwgURL = (mod && require('whatwg-url')) || {};\n// We also need to tweak `XMLHttpRequest` which our types\n//    rely on to obtain the Blob/File content\nconst utils = (mod && require('jsdom/lib/jsdom/living/generated/utils')) || {};\n\nconst {serializeURLOrigin, parseURL} = whatwgURL;\n\nconst blobURLs = {};\nconst createObjectURL = function (blob) {\n    // https://github.com/tmpvar/jsdom/issues/1721#issuecomment-282465529\n    const blobURL = 'blob:' + serializeURLOrigin(parseURL(location.href)) + '/' + uuid();\n    blobURLs[blobURL] = blob;\n    return blobURL;\n};\n\nconst impl = utils.implSymbol;\nconst _xhropen = XMLHttpRequest.prototype.open;\n\n// Add to XMLHttpRequest.prototype.open\nfunction xmlHttpRequestOpen (method, url, async) {\n    if ((/^blob:/).test(url)) {\n        const blob = blobURLs[url];\n        const type = 'text/plain'; // blob.type;\n        const encoded = blob[impl]._buffer.toString('binary'); // utf16le and base64 both convert lone surrogates\n        url = 'data:' + type + ',' + encodeURIComponent(encoded);\n    }\n    return _xhropen.call(this, method, url, async);\n};\n\nexport {createObjectURL, xmlHttpRequestOpen};\n"],"names":["mod","module","uuid","require","whatwgURL","utils","serializeURLOrigin","parseURL","blobURLs","impl","implSymbol","_xhropen","XMLHttpRequest","prototype","open","createObjectURL","blob","blobURL","location","href","xmlHttpRequestOpen","method","url","async","test","encoded","_buffer","toString","encodeURIComponent","call","this"],"mappings":"kMAMA,IAAMA,EAAwB,oBAAXC,OACbC,EAAOF,GAAOG,QAAQ,WACtBC,EAAaJ,GAAOG,QAAQ,eAAkB,GAG9CE,EAASL,GAAOG,QAAQ,2CAA8C,GAErEG,EAAgCF,EAAhCE,mBAAoBC,EAAYH,EAAZG,SAErBC,EAAW,GAQXC,EAAOJ,EAAMK,WACbC,EAAWC,eAAeC,UAAUC,uBARlB,SAAlBC,gBAA4BC,OAExBC,EAAU,QAAUX,EAAmBC,EAASW,SAASC,OAAS,IAAMjB,WAC9EM,EAASS,GAAWD,EACbC,wBAOX,SAASG,mBAAoBC,EAAQC,EAAKC,MACjC,SAAUC,KAAKF,GAAM,KAGhBG,EAFOjB,EAASc,GAEDb,GAAMiB,QAAQC,SAAS,UAC5CL,EAAM,mBAAuBM,mBAAmBH,UAE7Cd,EAASkB,KAAKC,KAAMT,EAAQC,EAAKC"}