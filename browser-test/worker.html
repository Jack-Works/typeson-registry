<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Worker test</title>
        <script src="../index.js"></script>
    </head>
    <body>
    <pre id="log" style="width: 100%; height: 500px;"></pre>
    <script type="module">
        function log (msg) {
            console.log(msg);
            document.getElementById('log').textContent += msg + '\n';
        }
        const TSON = new Typeson().register(Typeson.presets.postMessage);
        const worker = new Worker('worker.js');
        worker.postMessage(TSON.encapsulate({
            a: NaN,
            b: Infinity,
            c: -Infinity,
            d: new Error("oops")
        }));
        worker.onmessage = function (ev) {
            if (typeof ev.data === 'string') {
                log(ev.data);
                return;
            }
            log("Got back: " + ev.data.a);
            log("Got back: " + ev.data.b);
            log("Got back: " + ev.data.c);
            log("Main thread revival of original error is an `Error`: " + (TSON.revive(ev.data).d instanceof Error));
        };
    </script>
    </body>
</html>
